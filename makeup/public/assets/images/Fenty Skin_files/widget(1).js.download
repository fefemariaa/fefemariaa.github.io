!function(){function t(t,e,o,n){Object.defineProperty(t,e,{get:o,set:n,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},n={},s=e.parcelRequire08f6;null==s&&((s=function(t){if(t in o)return o[t].exports;if(t in n){var e=n[t];delete n[t];var s={id:t,exports:{}};return o[t]=s,e.call(s.exports,s,s.exports),s.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){n[t]=e},e.parcelRequire08f6=s),s.register("dG3SA",(function(e,o){var n,s;t(e.exports,"register",(function(){return n}),(function(t){return n=t})),t(e.exports,"resolve",(function(){return s}),(function(t){return s=t}));var r={};n=function(t){for(var e=Object.keys(t),o=0;o<e.length;o++)r[e[o]]=t[e[o]]},s=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),s.register("80wBz",(function(e,o){t(e.exports,"sendAnalyticsToExternalSource",(function(){return S})),t(e.exports,"setImpressionByPublishId",(function(){return y})),t(e.exports,"registerSiteActivityListenerIfNeeded",(function(){return _}));var n=s("lbxk9"),r=s("dvoXB"),i=s("eBCiO"),a=s("5B0S4"),l=s("k3SOX"),d=s("9RMxa"),c=s("eczm3"),u=s("enlHc"),E=s("lxnwr"),p=s("dqsbU"),T=s("kUoFQ");const g=t=>`tolstoy${(0,l.uppercaseFirstChar)(t)}`,S=t=>{I(t),f(t)},f=t=>{const{data:{name:e,text:o,facebookAnalyticsID:s,playlist:r,collectInfoType:i}}=t;if(!window.fbq||!s||!r)return;const a=`tolstoy-${r}`;switch(e){case n.PLAYER_EVENT_NAMES.sessionStart:h(s,`${a}-click`,{value:"Start Tolstoy"});break;case n.PLAYER_EVENT_NAMES.clickCta:h(s,`${a}-click`,{value:o});break;case n.PLAYER_EVENT_NAMES.submitInput:h(s,`${a}-input`,{value:o});break;case n.PLAYER_EVENT_NAMES.collectInfo:h(s,`${a}-${n.PLAYER_EVENTS.collectInfo}`,{value:i});break;case n.PLAYER_EVENT_NAMES.videoResponse:h(s,`${a}-${n.PLAYER_EVENTS.videoResponse}`);break;case n.PLAYER_EVENT_NAMES.imageResponse:h(s,`${a}-${n.PLAYER_EVENTS.imageResponse}`);break;case n.PLAYER_EVENT_NAMES.audioResponse:h(s,`${a}-${n.PLAYER_EVENTS.audioResponse}`);break;case n.PLAYER_EVENTS.sessionEnd:h(s,`${a}-${n.PLAYER_EVENTS.sessionEnd}`)}},h=(t,e,o)=>{window.fbq("trackSingleCustom",t,e,o)},I=t=>{const{data:{name:e,text:o,googleAnalyticsID:s,playlist:r,collectInfoType:i,productNames:l,totalTime:d,videoName:c,type:u,direction:E}}=t;if(!window.gtag&&!window.dataLayer&&!window.ga||!s||!r)return;const p=`tolstoy-${r}`;switch(e){case a.EVENT_NAMES.pageView:(t=>{window.gtag||window.dataLayer||window.ga("create",{trackingId:t,name:"clientTracker",cookieDomain:"auto",cookieFlags:"max-age=7200;secure;samesite=none"})})(s),m(s,p,"tolstoyPageView");break;case n.PLAYER_EVENT_NAMES.sessionStart:m(s,p,e),m(s,p,"click","Start Tolstoy");break;case n.PLAYER_EVENT_NAMES.clickCta:m(s,p,e,o);break;case n.PLAYER_EVENT_NAMES.collectInfo:m(s,p,e,i);break;case n.PLAYER_EVENT_NAMES.submitInput:case n.PLAYER_EVENT_NAMES.imageResponse:case n.PLAYER_EVENT_NAMES.audioResponse:case n.PLAYER_EVENT_NAMES.videoResponse:case n.PLAYER_EVENT_NAMES.sessionEnd:m(s,p,e);break;case a.EVENT_NAMES.tolstoyModalClose:m(s,p,a.EVENT_NAMES.tolstoyModalClose,d);break;case a.EVENT_NAMES.videoLoaded:l&&m(s,p,"tolstoyVideoLoaded-products",l),m(s,p,"tolstoyVideoLoaded-videoName",c);break;case a.EVENT_NAMES.feedProductModalOpen:case a.EVENT_NAMES.feedProductModalClose:case a.EVENT_NAMES.clickViewProduct:case a.EVENT_NAMES.openProductPageClick:m(s,p,g(e),l);break;case a.EVENT_NAMES.feedPlay:case a.EVENT_NAMES.feedPause:case a.EVENT_NAMES.videoMuted:case a.EVENT_NAMES.videoUnmuted:case a.EVENT_NAMES.videoWatched:m(s,p,g(e),c);break;case a.EVENT_NAMES.openShareLink:m(s,p,g("openShareLink"),u);break;case a.EVENT_NAMES.feedNavigationArrowClick:case a.EVENT_NAMES.feedScroll:m(s,p,g(e),E);break;default:m(s,p,g(e),o)}},m=(t,e,o,n)=>{w()&&(window.gtag?window.gtag("event",o,{event_category:e,event_label:n,send_to:t}):window.dataLayer?window.dataLayer.push({event:o,event_category:e,event_label:n,send_to:t}):window.ga("clientTracker.send","event",e,o,n))},v={},y=(t,e)=>{v[t]=v[t]||e};let N=!1;const _=()=>{if(!N)try{const t=(0,T.getAppKey)();b({appKey:t}),N=!0}catch(o){var t,e;console.error(o),null===(t=(e=window).tolstoyCaptureError)||void 0===t||t.call(e,o)}},w=()=>{var t,e,o,n;return null===(t=window.Shopify)||void 0===t||null===(e=t.customerPrivacy)||void 0===e||!e.shouldShowBanner()||"yes"===(null===(o=window.Shopify)||void 0===o||null===(n=o.customerPrivacy)||void 0===n?void 0:n.currentVisitorConsent().analytic)},b=({appKey:t}={})=>{let e=0;(0,p.setNotVisibileOpenedTolstoyPublishId)(null),(0,d.validateUUID)(t)&&document.addEventListener("visibilitychange",(()=>{try{const n=Date.now(),s=window.performance.now();if("visible"===document.visibilityState&&(e=s,C(n)),"hidden"===document.visibilityState){var o;let r=(0,p.getTolstoysActivity)();L(n,r),r=(0,p.getTolstoysActivity)();const a=Math.round(s-e),l=(0,p.getSessionUniqueId)(),d=A(r),c=window.location.href.split("?")[0],T=(0,u.getCurrentPageProductId)(),g={appKey:t,sessionUniqueId:l,timestamp:(new Date).toISOString(),anonymousId:(0,p.getAndSetAnonymousId)(),storeUrl:null===(o=window.Shopify)||void 0===o?void 0:o.shop,siteActivity:d,eventName:i.SITE_ACTIVTY_EVENT_NAME,timeOnPage:a,pageUrl:c,currentPageProductId:T};(0,E.createSiteActivityEvent)(g),(0,p.clearTolstoyActivity)()}}catch(t){var n,s;console.error(t),null===(n=(s=window).tolstoyCaptureError)||void 0===n||n.call(s,t)}}))},A=t=>{const e={};for(const[o,n]of Object.entries(v)){const s=t[o];null!=s&&s.length||e[o]||(e[o]={activity:{},totalTime:0,impression:n});const r=R({publishId:o,activities:s});let i=0;for(const t of Object.values(r))i+=t;e[o]={activity:r,totalTime:i,impression:n}}return e},R=({publishId:t,activities:e})=>{if(!t||null==e||!e.length)return{};const o=Date.now(),n={},s={};for(const{timeStamp:t,type:o,sessionId:r}of e)s[r]=s[r]||0,void 0===n[r]&&(n[r]=!1),(0,c.getIsActiveWidgetEvent)(o)&&!n[r]&&(n[r]=!0,s[r]-=t),(0,c.getIsInactiveWidgetEvent)(o)&&n[r]&&(n[r]=!1,s[r]+=t);for(const[t,e]of Object.entries(n))e&&(s[t]+=o),(s[t]<=0||s[t]>864e5)&&delete s[t];return s},C=t=>{const e=(0,p.getNotVisibleOpenedTolstoyPublishId)(),o=(0,p.getSessionId)();e&&o&&((0,p.pushTolstoyActivity)({publishId:e,timeStamp:t,type:r.WIDGET_MESSAGES_EVENTS.OPEN,sessionId:o}),(0,p.setNotVisibileOpenedTolstoyPublishId)(null))},L=(t,e)=>{const o=(t=>{var e;return null===(e=Object.entries(t).find((([t,e])=>{if(0===e.length)return;const o=e[e.length-1].type;return(0,c.getIsActiveWidgetEvent)(o)})))||void 0===e?void 0:e[0]})(e),n=(0,p.getSessionId)();o&&n&&((0,p.pushTolstoyActivity)({publishId:o,timeStamp:t,type:r.WIDGET_MESSAGES_EVENTS.CLOSE,sessionId:n}),(0,p.setNotVisibileOpenedTolstoyPublishId)(o))}})),s.register("lbxk9",(function(e,o){t(e.exports,"PLAYER_EVENTS",(function(){return n})),t(e.exports,"PLAYER_EVENT_NAMES",(function(){return s}));const n={pageView:"pageView",sessionStart:"sessionStart",sessionEnd:"sessionEnd",videoPause:"videoPause",videoStart:"videoStart",videoResume:"videoResume",videoReplay:"videoReplay",clickCta:"clickCta",submitInput:"submitInput",collectInfo:"collectInfo",videoResponse:"videoResponse",audioResponse:"audioResponse",imageResponse:"imageResponse",tolstoyClick:"tolstoyClick",chapterSelected:"chapterSelected",chapterPickerOpened:"chapterPickerOpened",videoSeeked:"videoSeeked",shareClick:"shareClick",quizResult:"quizResult",autoplayStart:"autoplayStart"},s={sessionStart:"tolstoyStarted",sessionEnd:"tolstoyReachedEnd",clickCta:"tolstoyAnswerClicked",submitInput:"tolstoyInputSubmit",collectInfo:"tolstoyLeadFormSubmit",videoResponse:"tolstoyVideoSubmit",audioResponse:"tolstoyAudioSubmit",imageResponse:"tolstoyImageSubmit",openGorgias:"tolstoyOpenGorgias",hideGorgias:"tolstoyHideGorgias",openIntercom:"tolstoyOpenIntercom",hideIntercom:"tolstoyHideIntercom",openTawkTo:"tolstoyOpenTawkTo",hideTawkTo:"tolstoyHideTawkTo",openLiveChat:"tolstoyOpenLiveChat",hideLiveChat:"tolstoyHideLiveChat",openHubSpot:"tolstoyOpenHubSpot",hideHubSpot:"tolstoyHideHubSpot",openHelpScout:"tolstoyOpenHelpScout",hideHelpScout:"tolstoyHideHelpScout",openDrift:"tolstoyOpenDrift",hideDrift:"tolstoyHideDrift",openZendesk:"tolstoyOpenZendesk",hideZendesk:"tolstoyHideZendesk"}})),s.register("dvoXB",(function(e,o){t(e.exports,"TOLSTOY_ESCAPE_KEY_PRESSED_MESSAGE",(function(){return n})),t(e.exports,"TOLSTOY_WATCHED_PRODUCT_IDS_MESSAGE",(function(){return s})),t(e.exports,"SHOW_FEED_PRODUCT_MODAL_MESSAGE",(function(){return r})),t(e.exports,"WIDGETS_MESSAGES",(function(){return i})),t(e.exports,"SHOW_FEED_CART_MOBILE_MESSAGE",(function(){return a})),t(e.exports,"TOLSTOY_MOVE_TO_URL",(function(){return l})),t(e.exports,"TOLSTOY_CLOSE_MODAL_MESSAGE",(function(){return d})),t(e.exports,"TOLSTOY_PLAYER_READY_MESSAGE",(function(){return c})),t(e.exports,"WIDGET_MESSAGES_EVENTS",(function(){return u})),t(e.exports,"ACTIVE_WIDGET_MESSAGES_EVENTS",(function(){return E})),t(e.exports,"INACTIVE_WIDGET_MESSAGES_EVENTS",(function(){return p})),t(e.exports,"PRE_CONFIG_MESSAGES",(function(){return T})),t(e.exports,"RECHARGE_MESSAGING",(function(){return g})),t(e.exports,"RECHARGE_WIDGET_DATA_MESSAGE",(function(){return S})),t(e.exports,"REQUEST_RECHARGE_WIDGET_DATA_MESSAGE",(function(){return f})),t(e.exports,"REQUEST_RECHARGE_ADD_TO_CART_MESSAGE",(function(){return h}));const n="tolstoyEscapeKeyPressed",s="tolstoyWatchedProductIds",r="showFeedProductModal",i="tolstoyWidgets",a="showFeedCartMobile",l="tolstoyMoveToUrl",d="tolstoyCloseModalMessage",c="tolstoyPlayerReady",u={OPEN:"open",CLOSE:"close",PLAY:"play",PAUSE:"pause"},E=[u.OPEN,u.PLAY],p=[u.CLOSE,u.PAUSE],T={ready:"tolstoyPreConfigMessengerReady",vodAssetIds:"tolstoyVodAssetIds"},g="rechargeMessaging",S="tolstoyRechargeWidgetData",f="tolstoyRequestRechargeWidgetData",h="tolstoyRequestRechargeAddToCart"})),s.register("eBCiO",(function(e,o){t(e.exports,"CAROUSEL_EMBED_WIDGET",(function(){return a})),t(e.exports,"IN_TILE_CAROUSEL_EMBED_WIDGET",(function(){return l})),t(e.exports,"BUBBLE_WIDGET",(function(){return d})),t(e.exports,"STORY_EMBED_WIDGET",(function(){return c})),t(e.exports,"EMBED_WIDGET",(function(){return u})),t(e.exports,"CENTERED_MODAL_WIDGET",(function(){return E})),t(e.exports,"STOP_SHOWING_WIDGET_TO",(function(){return p})),t(e.exports,"EMBED_WIDGETS_CLASSNAMES",(function(){return T})),t(e.exports,"SITE_ACTIVTY_EVENT_NAME",(function(){return g})),t(e.exports,"DOM_EXCEPTION_ERRORS",(function(){return S})),t(e.exports,"DEFAULT_CART_QUANTITY",(function(){return f})),t(e.exports,"WIDGET_SCRIPT_PARAMETERS",(function(){return h})),t(e.exports,"URL_PARAMETERS",(function(){return I})),t(e.exports,"PLACEHOLDER_PRODUCT_ID",(function(){return m}));var n=s("koLqL"),r=s("623S6"),i=s("2fxlU");const a="carousel",l="inTileCarousel",d="bubble",c="stories",u="embed",E="centeredModal",p={clickedX:"stopShowingWidgetToClickedX",viewed:"stopShowingWidgetToViewed"},T={[a]:n.PUBLIC_CLASSES.carousel,[c]:i.PUBLIC_CLASSES.story,[u]:r.PUBLIC_CLASSES.embed},g="siteActivity",S={notAllowedError:"NotAllowedError"},f=1,h={shop:"shop",appKey:"app-key",productId:"product-id"},I={tolstoyAutoOpen:"tolstoyAutoOpen",tolstoyStartVideo:"tolstoyStartVideo"},m="PRODUCT_ID"})),s.register("koLqL",(function(e,o){t(e.exports,"EMBED_CAROUSEL_MOTION",(function(){return n})),t(e.exports,"CAROUSEL_TILE_NAME_LOCATION_TYPES",(function(){return s})),t(e.exports,"PUBLIC_CLASSES",(function(){return r})),t(e.exports,"MAX_TILE_NUMBER",(function(){return i})),t(e.exports,"MIN_TILE_NUMBER",(function(){return a})),t(e.exports,"MIN_WIDTH_FOR_TILE",(function(){return l})),t(e.exports,"DEFAULT_DOT_OPACITY",(function(){return d})),t(e.exports,"TILE_NAME_HEIGHT",(function(){return c})),t(e.exports,"SPACING_HORIZONTAL",(function(){return u})),t(e.exports,"DEFAULT_TILE_HEIGHT",(function(){return E})),t(e.exports,"CAROUSEL_TYPE",(function(){return p})),t(e.exports,"SPOTLIGHT_CAROUSEL_CONTENT_TILE_TYPE",(function(){return T})),t(e.exports,"CAROUSEL_TITLE",(function(){return g}));const n={static:"static",dynamic:"dynamic",hoverOver:"hoverOver"},s={under:"under",over:"over"},r={carousel:"tolstoy-carousel",carouselContainer:"tolstoy-carousel-container",title:"tolstoy-carousel-title",videoCarouselContainer:"tolstoy-video-carousel-container",previousButton:"tolstoy-previous-button",nextButton:"tolstoy-next-button",videosContainer:"tolstoy-carousel-videos-container",videoContainer:"tolstoy-carousel-video-container",video:"tolstoy-carousel-video",image:"tolstoy-carousel-image",dotsContainer:"tolstoy-dots-container",dot:"tolstoy-dot",playButtonContainer:"tolstoy-play-button-container",controlsContainer:"tolstoy-carousel-controls-container",expandButton:"tolstoy-carousel-expand-button",muteButton:"tolstoy-carousel-mute-button",tileContainer:"tolstoy-carousel-tile-container",tile:"tolstoy-carousel-tile",tileNameContainer:"tolstoy-tile-name-container",tileNameText:"tolstoy-carousel-tile-name-text",arrowButtonContainer:"tolstoy-carousel-arrow-button-container",arrowButton:"tolstoy-carousel-arrow-button",tileNameHeightPlaceholder:"tolstoy-tile-name-height-placeholder",productTile:"tolstoy-product-tile",productTileImage:"tolstoy-product-tile-image",productTileTitle:"tolstoy-product-tile-title",variantTitle:"tolstoy-product-variant-tile-title",productTilePrice:"tolstoy-product-tile-price",productTileButton:"tolstoy-product-tile-button",descriptionTile:"tolstoy-description-tile",descriptionTileContent:"tolstoy-description-tile-content",descriptionTileButton:"tolstoy-description-tile-button"},i=6,a=2,l=80,d=.3,c=80,u=12,E=416,p={DEFAULT:"default",SPOTLIGHT:"spotlight"},T={product:"product",videoName:"videoName"},g={shoppableVideoCarousel:"Shoppable Video Carousel"}})),s.register("623S6",(function(e,o){t(e.exports,"PUBLIC_CLASSES",(function(){return n})),t(e.exports,"ASPECT_RATIO_9_16",(function(){return s}));const n={embed:"tolstoy-embed",iframe:"tolstoy-embed-iframe",videoPreview:"tolstoy-embed-video-preview",videoContainer:"tolstoy-embed-video-container",playButtonContainer:"tolstoy-embed-play-button-container",startText:"tolstoy-embed-start-text",startButtonContainer:"tolstoy-embed-start-button-container",startButton:"tolstoy-embed-start-button",embedContainer:"tolstoy-embed-container"},s=9/16})),s.register("2fxlU",(function(e,o){t(e.exports,"PUBLIC_CLASSES",(function(){return r})),t(e.exports,"POSTER_SUFFIX",(function(){return i})),t(e.exports,"STORIES_IMAGE_EXTENSION",(function(){return a})),t(e.exports,"EMBED_STORY_MOTION",(function(){return l})),t(e.exports,"STORIES_ITEMS_SIZE_TYPES",(function(){return d})),t(e.exports,"DEFAULT_STORIES_ITEMS_SIZE_TYPE",(function(){return c})),t(e.exports,"DEFAULT_STORIES_ITEMS_PER_ROW",(function(){return u})),t(e.exports,"DEFAULT_STORIES_SIZE",(function(){return E})),t(e.exports,"DEFAULT_STORIES_SPACING",(function(){return p})),t(e.exports,"STORIES_ITEM_MAX_FIXED_SIZE",(function(){return T}));var n=s("koLqL");const r={story:"tolstoy-stories",storiesContainer:"tolstoy-stories-container",tilesContainer:"tolstoy-stories-tiles-container",tileName:"tolstoy-stories-tile-name",storyTile:"tolstoy-stories-tile",storyImage:"tolstoy-stories-story-image",storyVideo:"tolstoy-stories-story-video",plusTile:"tolstoy-stories-plus-tile",storyName:"tolstoy-stories-story-name",titleContainer:"tolstoy-stories-title",plusTileContainer:"tolstoy-stories-plus-tile-container",previousButton:"tolstoy-stories-previous-button",nextButton:"tolstoy-stories-next-button"},i=".0000000.jpg",a=`.avatar${i}`,l={static:n.EMBED_CAROUSEL_MOTION.static,dynamic:n.EMBED_CAROUSEL_MOTION.dynamic},d={responsive:"responsive",fixed:"fixed"},c=d.fixed,u=8,E=80,p=8,T=256})),s.register("5B0S4",(function(e,o){t(e.exports,"EVENT_NAMES",(function(){return n}));const n={embedView:"embedView",embedPlay:"embedPlay",embedPause:"embedPause",embedMute:"embedMute",embedUnmute:"embedUnmute",embedExpand:"embedExpand",tolstoyModalClose:"tolstoyModalClose",feedProductModalOpen:"feedProductModalOpen",feedProductModalClose:"feedProductModalClose",videoLoaded:"videoLoaded",pageView:"pageView",clickViewProduct:"clickViewProduct",openProductPageClick:"openProductPageClick",feedPlay:"feedPlay",feedPause:"feedPause",videoMuted:"videoMuted",videoUnmuted:"videoUnmuted",videoWatched:"videoWatched",openShareLink:"Open Share Link",feedNavigationArrowClick:"feedNavigationArrowClick",feedScroll:"feedScroll",sessionStart:"sessionStart"}})),s.register("k3SOX",(function(e,o){t(e.exports,"uppercaseFirstChar",(function(){return i})),t(e.exports,"getRandomNumberBetweenTwoIntegers",(function(){return a})),t(e.exports,"generateUUID",(function(){return l})),t(e.exports,"logDevelopmentMessage",(function(){return c})),t(e.exports,"logDevelopmentError",(function(){return u})),t(e.exports,"getIsIOS",(function(){return E})),t(e.exports,"debounce",(function(){return p})),t(e.exports,"sleep",(function(){return T})),t(e.exports,"safeRoundNumber",(function(){return g})),t(e.exports,"removeHtmlTags",(function(){return S}));var n=s("3TKJr"),r=s("8jyX0");const i=t=>{var e;return null!=t&&t.length?`${null===(e=t[0])||void 0===e?void 0:e.toUpperCase()}${null==t?void 0:t.slice(1)}`:""},a=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,l=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=Math.floor(16*Math.random());return("x"===t?e:3&e|8).toString(16)})),d=()=>"development"===n.NODE_ENV||"true"===(0,r.getSafeParameter)("td"),c=t=>{d()&&console.log(t)},u=t=>{d()&&console.error(t)},E=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,p=(t,e=300)=>{let o;return(...n)=>{clearTimeout(o),o=setTimeout((()=>{t(...n)}),e)}},T=async(t=0)=>new Promise((e=>{setTimeout(e,t)})),g=(t,e=1)=>{const o=Number(t);return Number.isNaN(o)?0:Number.isInteger(o)?o:Number.parseFloat(o.toFixed(e))},S=t=>t.replace(/<[^>]*>?/gm,"")})),s.register("3TKJr",(function(e,o){t(e.exports,"API_BASE_URL",(function(){return n})),t(e.exports,"PLAYER_URL",(function(){return s})),t(e.exports,"WIDGET_DOMAIN",(function(){return r})),t(e.exports,"VIDEO_OUTPUT",(function(){return i})),t(e.exports,"CREATE_VIDEO_RESOLUTIONS",(function(){return a})),t(e.exports,"SITE_ACTIVITY_EVENT_URL",(function(){return l})),t(e.exports,"NODE_ENV",(function(){return d}));const n="https://api.gotolstoy.com",s="https://player.gotolstoy.com",r="widget.gotolstoy.com",i="https://videos.gotolstoy.com",a="https://api.gotolstoy.com/migrations/recreate-video",l="https://api.gotolstoy.com/site-activity/site-activity",d="production"})),s.register("8jyX0",(function(e,o){t(e.exports,"getSafeParameter",(function(){return E})),t(e.exports,"getCustomerId",(function(){return T})),t(e.exports,"getEmailFromParams",(function(){return g})),t(e.exports,"getIframeSource",(function(){return S}));var n=s("3TKJr"),r=s("eBCiO"),i=s("iL0w4"),a=s("iUVXd"),l=s("91LvR"),d=s("jWnd9"),c=s("l15kz");const u=()=>Boolean(window.Shopify),E=t=>{if(!("URLSearchParams"in window))return null;try{var e;return new URLSearchParams(null===(e=window.location)||void 0===e?void 0:e.search).get(t)}catch(t){if(t)return null}},p=t=>t.playerLazy||E("pl"),T=()=>{var t,e,o,n;return(null===(t=window._st)||void 0===t?void 0:t.cid)||(null===(e=window.ShopifyAnalytics)||void 0===e||null===(o=e.meta)||void 0===o||null===(n=o.page)||void 0===n?void 0:n.customerId)||""},g=()=>{var t;return(null===(t=window.tolstoyUserInfo)||void 0===t?void 0:t.email)||window.tolstoyUser},S=({data:t,isFeed:e,email:o,isDynamic:s,modalId:S,tolstoyStartVideo:f})=>{var h,I,m,v;const y=`${window.location.origin}${window.location.pathname}`.slice(0,1999),N=(null===(h=window.Shopify)||void 0===h?void 0:h.shop)||"",_=Boolean(u()&&N);let w=`${((t,e)=>{const o=(0,a.getPlayerOrigin)(t);if(o){const e=E("td"),n=p(t);return e&&n?o.replace("2.0.0","2.0.0-ls"):n?o.replace("2.0.0","2.0.0-l"):e?o.replace("2.0.0","2.0.0-s"):o}let s=`${n.PLAYER_URL}`;return e&&(s+="/feed"),t.publishId&&(s+=`/${t.publishId}`),s})(t,e)}?host&url=${y}&safari=${Boolean(null===(I=window)||void 0===I?void 0:I.safari)}&dontDownload=${Boolean(t.dontDownload)}&playerType=${t.playerType}&isShopifyStore=${_}&shopifyStoreUrl=${N}&modalId=${S}`;if(u()){var b;const t=null===(b=window.Shopify.routes)||void 0===b?void 0:b.root;t&&(w+=`&shopifyRootRoute=${t}`);(0,c.getIsNonDefaultCurrencyRate)()&&(w+="&isShopifyNonDefaultCurrencyRate=true")}var A,R;null!==(m=window.tolstoyUserInfo)&&void 0!==m&&m.name&&(w+=`&name=${null===(A=window.tolstoyUserInfo)||void 0===A?void 0:A.name}`);null!==(v=window.tolstoyUserInfo)&&void 0!==v&&v.phone&&(w+=`&phone=${null===(R=window.tolstoyUserInfo)||void 0===R?void 0:R.phone}`);f&&(w+=`&tolstoyStartVideo=${f}`);const C=o||g();C&&(w+=`&email=${C}`),t.productId&&(w+=`&productId=${t.productId}`),t.currentProductDbId&&(w+=`&currentPageDbProductId=${t.currentProductDbId}`),t.testGroup&&(w+=`&group=${t.testGroup}`),t.sneakpeek&&(w+="&sneakpeek"),t.sneakpeek_hidden&&(w+="&sneakpeek_hidden"),t.token&&(w+=`&token=${t.token}`),t.gclid&&(w+=`&gclid=${t.gclid}`),t.widgetDelay&&(w+="&delay"),t.abTestId&&(w+=`&abTestId=${t.abTestId}`),!1===t.isShoppable&&(w+=`&isShoppable=${null==t?void 0:t.isShoppable}`),t.si&&(w+=`&si=${t.si}`),t.ai&&(w+=`&ai=${t.ai}`);const L=E("td");L&&(w+=`&td=${L}`);const O=p(t);O&&(w+=`&pl=${O}`);const P=null==(M=t)||null===(x=M.featureSettings)||void 0===x||null===(U=x[i.FEATURE_PLAYER_VERSION])||void 0===U?void 0:U.version;var M,x,U;P&&(w+=`&pv=${P}`);const D=(t=>{var e;return null!=t&&null!==(e=t.carouselEmbed)&&void 0!==e&&e.carouselPlayInTileFirst?r.IN_TILE_CAROUSEL_EMBED_WIDGET:""})(t);D&&(w+=`&playerVariant=${D}`),s&&(w+="&isDynamic=true");const V=T();V&&(w+=`&customerId=${V}`);const k=(0,l.getUrlCustomParams)();k.size>0&&(w+=`&${k.toString()}`);return(0,d.getIsTapcart)()&&(w+="&isTapcart=true"),(0,a.getPlayerOrigin)(t)&&(e&&(w+="&isFeed=true"),t.publishId&&(w+=`&publishId=${t.publishId}`)),w}})),s.register("iL0w4",(function(e,o){t(e.exports,"FEATURE_PLAYER_VERSION",(function(){return n}));const n="player-version"})),s.register("iUVXd",(function(e,o){t(e.exports,"getFeatureIsEnabled",(function(){return i})),t(e.exports,"getIsPlayerLazy",(function(){return a})),t(e.exports,"getPlayerOrigin",(function(){return l})),t(e.exports,"getIsFallbackVideoDisabled",(function(){return d}));var n=s("r0IUh");const r=({config:t,featureKey:e})=>{var o;return null==t||null===(o=t.featureSettings)||void 0===o?void 0:o[e]},i=({config:t,featureKey:e})=>{var o;return Boolean(null==t||null===(o=t.featureSettings)||void 0===o?void 0:o[e])},a=(t={})=>{const e=r({config:t,featureKey:n.FEATURE_WIDGET_LOADING});return null==e?void 0:e.playerLazy},l=(t={})=>{const e=r({config:t,featureKey:n.FEATURE_WIDGET_LOADING});return null==e?void 0:e.playerOrigin},d=(t={})=>{const e=r({config:t,featureKey:n.FEATURE_WIDGET_FALLBACK_VIDEO});return null==e?void 0:e.dontUseFallback}})),s.register("r0IUh",(function(e,o){t(e.exports,"FEATURE_WIDGET_LOADING",(function(){return n})),t(e.exports,"FEATURE_WIDGET_FALLBACK_VIDEO",(function(){return s})),t(e.exports,"FEATURE_CAROUSEL_SHOW_DOTS",(function(){return r})),t(e.exports,"FEATURE_CAROUSEL_VIDEOS",(function(){return i})),t(e.exports,"FEATURE_HIDE_SPOTLIGHT_PLUS_BUTTON",(function(){return a})),t(e.exports,"FEATURE_SPOTLIGHT_AUTO_RESIZE",(function(){return l})),t(e.exports,"FEATURE_APP_USE_CREATOR_PROFILE",(function(){return d}));const n="widget-loading",s="widget-video-fallback",r="carousel-show-dots",i="carousel-videos",a="hide-spotlight-plus-button",l="spotlight-auto-resize",d="app-use-creator-profile"})),s.register("91LvR",(function(e,o){t(e.exports,"getIsTheSameURL",(function(){return i})),t(e.exports,"getUrlCustomParams",(function(){return a})),t(e.exports,"getFilteredSearchParams",(function(){return l})),t(e.exports,"isUrl",(function(){return d}));const n=new RegExp("^((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)","i"),s=t=>!!t&&(Boolean(n.test(t))||t.startsWith("tel:")||t.startsWith("mailto:")||t.startsWith("_self:")),r=t=>{const e=t.replace("www.",""),o=new URL(e);return`${o.origin}${o.pathname}${o.search}`},i=(t,e)=>!(!s(t)||!s(e))&&r(t)===r(e),a=()=>{const t=new URLSearchParams(window.location.search),e=new URLSearchParams;for(const[o,n]of t){const t=o.toLowerCase();o.length<50&&n.length<100&&(t.startsWith("custom_")||t.startsWith("utm_"))&&e.append(o,n)}return e},l=(t={})=>{const e=new URLSearchParams;for(const[o,n]of Object.entries(t))null!=n&&""!==n&&e.append(o,n);return e.toString()},d=t=>n.test(t)})),s.register("jWnd9",(function(e,o){t(e.exports,"getIsTapcart",(function(){return n})),t(e.exports,"getTapcartDeviceId",(function(){return s}));const n=()=>{var t,e,o,n;return!(null===(t=window)||void 0===t||null===(e=t.Tapcart)||void 0===e||!e.isInitialized)||!(null===(o=document.location)||void 0===o||null===(n=o.host)||void 0===n||!n.includes("custom-blocks.tapcart.com"))},s=()=>{var t,e,o,n;const s=null===(t=window)||void 0===t||null===(e=t.Tapcart)||void 0===e||null===(o=e.variables)||void 0===o||null===(n=o.device)||void 0===n?void 0:n.id;return null==s?void 0:s.toLowerCase()}})),s.register("l15kz",(function(e,o){t(e.exports,"getIsNonDefaultCurrencyRate",(function(){return n})),t(e.exports,"getIsNonDefaultRootRoute",(function(){return s}));const n=()=>{var t,e;return 1!==Number(null===(t=window.Shopify)||void 0===t||null===(e=t.currency)||void 0===e?void 0:e.rate)},s=()=>{var t,e;return"/"!==(null===(t=window.Shopify)||void 0===t||null===(e=t.routes)||void 0===e?void 0:e.root)}})),s.register("9RMxa",(function(e,o){t(e.exports,"validateUUID",(function(){return n}));const n=t=>null==t?void 0:t.match(/^[\da-f]{8}-[\da-f]{4}-[0-5][\da-f]{3}-[089ab][\da-f]{3}-[\da-f]{12}$/i)})),s.register("eczm3",(function(e,o){t(e.exports,"getIsActiveWidgetEvent",(function(){return r})),t(e.exports,"getIsInactiveWidgetEvent",(function(){return i}));var n=s("dvoXB");const r=t=>n.ACTIVE_WIDGET_MESSAGES_EVENTS.includes(t),i=t=>n.INACTIVE_WIDGET_MESSAGES_EVENTS.includes(t)})),s.register("enlHc",(function(e,o){t(e.exports,"getPublicId",(function(){return E})),t(e.exports,"getEmbedPublishId",(function(){return p})),t(e.exports,"getEmbedProductId",(function(){return T})),t(e.exports,"getCurrentPageProductId",(function(){return g})),t(e.exports,"reloadFontIfNeeded",(function(){return S})),t(e.exports,"getVideoBaseUrl",(function(){return f})),t(e.exports,"getAllElements",(function(){return h})),t(e.exports,"stopAllVideos",(function(){return I})),t(e.exports,"stopDynamicVideos",(function(){return m})),t(e.exports,"onViewPortChangeHandler",(function(){return v})),t(e.exports,"getConfig",(function(){return y}));var n=s("kUoFQ"),r=s("dqsbU"),i=s("bjVW9"),a=s("lxnwr"),l=s("eBCiO"),d=s("kzUTo"),c=s("gDuGE"),u=s("koLqL");const E=(t,e)=>`${t}-${e}`,p=t=>t.dataset.publishId?t.dataset.publishId:t.id?t.id.split("_")[0]:"",T=t=>{var e;const o=null==t||null===(e=t.dataset)||void 0===e?void 0:e.productId;return"{{ product.id }}"===o?null:o},g=()=>{const{stories:t,carousel:e,embed:o}=l.EMBED_WIDGETS_CLASSNAMES,n=document.querySelectorAll(`.${t}, .${e}, .${o}`);for(const t of n){const e=T(t);if(e)return e}},S=t=>{var e,o,n;const s=null==t||null===(e=t.design)||void 0===e||null===(o=e.branding)||void 0===o||null===(n=o.typography)||void 0===n?void 0:n.font;null!=s&&s.family&&(0,i.reloadFont)(s)},f=({step:t,embedMotion:e,isStory:o,loadAll:n=!1,isCarouselPlayInTileFirst:s})=>{if(e===u.EMBED_CAROUSEL_MOTION.static||s)return null;const r=window.innerWidth<=450,i=e===u.EMBED_CAROUSEL_MOTION.hoverOver,a=e===u.EMBED_CAROUSEL_MOTION.dynamic;return a&&n?(0,c.getBaseUrl)({step:t,isStory:o}):i&&r||a?null:(0,c.getBaseUrl)({step:t,isStory:o})},h=(t,e)=>window.document.querySelectorAll(`[data-tolstoy-element="${E(t,e)}"]`),I=({videoClass:t,publishId:e,removeEventListenerFunction:o})=>{const n=h(t,e);for(const t of n)t.pause(),null==o||o(t)},m=({videoClass:t,publishId:e,setIsDynamicVideoRunning:o,onVideoEnd:n})=>{o(!1),I({videoClass:t,publishId:e,removeEventListenerFunction:t=>{t.removeEventListener("ended",n)}})},v=({videoClass:t,isDynamicVideoRunning:e,setIsDynamicVideoRunning:o,dynamicVideoHandler:n,publishId:s,onVideoEnd:r})=>{const i=h(t,s);if(0===i.length)return;const a=(t=>{const e=t.getBoundingClientRect();return e.top>=-e.height&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)})(i[0]);!a&&e?(m({videoClass:t,publishId:s,setIsDynamicVideoRunning:o,onVideoEnd:r}),o(!1)):a&&!e&&(n(),o(!0))},y=async({publishId:t,productId:e,widgetType:o,tags:s,appUrl:i,variantId:c})=>{const u=e&&e!==l.PLACEHOLDER_PRODUCT_ID?a.getConfigByProductId:a.getConfigByUrl,E=window.tolstoyAppKey||(0,n.getAppKey)()||"",p=new URLSearchParams(window.location.search),T=c||p.get("variant"),g=JSON.stringify((0,r.getTolstoyViewers)()),S=await u({tolstoyViewers:g,productId:e,defaultPublishId:t,widgetType:o,appKey:E,tags:s,appUrl:i,variantId:T});if(S){new(0,d.default)(o).init(S)}if(null!=S&&S.disabled&&!S.abTestId)throw new Error("couldn't find product page ");return S}})),s.register("kUoFQ",(function(e,o){t(e.exports,"getAppKey",(function(){return i}));var n=s("eBCiO"),r=s("1S4OJ");function i(){return window.tolstoyAppKey?window.tolstoyAppKey:(0,r.getParameterFromWidgetScripts)(n.WIDGET_SCRIPT_PARAMETERS.appKey)}})),s.register("1S4OJ",(function(e,o){t(e.exports,"getParameterFromWidgetScripts",(function(){return a}));var n=s("3TKJr");const r=(t,e)=>{const o=t.src;return new URL(o).searchParams.get(e)},i=(t,e)=>t.getAttribute(`data-${e}`),a=t=>{const e=document.querySelectorAll(`script[src*="${n.WIDGET_DOMAIN}"]`);for(const o of e){const e=i(o,t)||r(o,t);if(e)return e}}})),s.register("dqsbU",(function(e,o){t(e.exports,"setAnonymousId",(function(){return v})),t(e.exports,"getAndSetAnonymousId",(function(){return y})),t(e.exports,"getTestGroup",(function(){return N})),t(e.exports,"setTestGroup",(function(){return _})),t(e.exports,"setPublishId",(function(){return w})),t(e.exports,"getTolstoysActivity",(function(){return b})),t(e.exports,"pushTolstoyActivity",(function(){return A})),t(e.exports,"pushTolstoyViewedProducts",(function(){return R})),t(e.exports,"clearTolstoyActivity",(function(){return C})),t(e.exports,"setIsReply",(function(){return L})),t(e.exports,"setTolstoyProductRecommendation",(function(){return O})),t(e.exports,"getTolstoyViewers",(function(){return P})),t(e.exports,"getTolstoyAbTest",(function(){return M})),t(e.exports,"setTolstoyAbTest",(function(){return x})),t(e.exports,"setTolstoyViewers",(function(){return V})),t(e.exports,"setIdentifyInfoId",(function(){return k})),t(e.exports,"getIdentifyInfoId",(function(){return B})),t(e.exports,"removeIdentifyInfoId",(function(){return F})),t(e.exports,"setSessionCounter",(function(){return G})),t(e.exports,"getSessionCounter",(function(){return $})),t(e.exports,"setFirstSeenAt",(function(){return W})),t(e.exports,"getFirstSeenAt",(function(){return Y})),t(e.exports,"setTolstoyInteractionDate",(function(){return j})),t(e.exports,"getTolstoyHideWidget",(function(){return K})),t(e.exports,"setTolstoyHideWidget",(function(){return H})),t(e.exports,"removeTolstoyHideWidget",(function(){return q})),t(e.exports,"getSessionId",(function(){return Q})),t(e.exports,"setSessionId",(function(){return X})),t(e.exports,"removeSessionId",(function(){return z})),t(e.exports,"getSessionUniqueId",(function(){return J})),t(e.exports,"getNotVisibleOpenedTolstoyPublishId",(function(){return tt})),t(e.exports,"setNotVisibileOpenedTolstoyPublishId",(function(){return et})),t(e.exports,"updateTolstoyActivitySessionIdByPublishId",(function(){return ot})),t(e.exports,"getIsShopifyCartAnonymousIdSet",(function(){return nt})),t(e.exports,"setIsShopifyCartAnonymousIdSet",(function(){return st})),t(e.exports,"setTolstoyRecreateResolution",(function(){return rt})),t(e.exports,"getTolstoyRecreateResolution",(function(){return it})),t(e.exports,"setShowNotificationBadge",(function(){return at})),t(e.exports,"getShowNotificationBadge",(function(){return lt})),t(e.exports,"setShowBubbleText",(function(){return dt})),t(e.exports,"getShowBubbleText",(function(){return ct})),t(e.exports,"setRecreateNewResolution",(function(){return ut})),t(e.exports,"getRecreateNewResolution",(function(){return Et}));var n=s("KwGJG"),r=s("lFmQM"),i=s("b1G1l");const{TOLSTOY_HIDE_WIDGET_STORAGE_KEY:a,TOLSTOY_SESSION_ID_KEY:l,TOLSTOY_SESSION_UNIQUE_ID_KEY:d,TOLSTOY_PRODUCT_RECOMMENDATIONS:c,TOLSTOY_ANONYMOUS_ID:u,TOLSTOY_REPLY:E,TOLSTOY_GROUP:p,TOLSTOY_PUBLISH_ID:T,TOLSTOY_ACTIVITY_KEY:g,TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:S,TOLSTOY_INTERACTION_DATE:f,IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:h,TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:I}=n.TOLSTOY_CACHE_KEYS;function m(t){return t?`${f}-${t}`:f}function v(t){t&&!["undefined","false"].includes(t)&&(0,r.setToCache)(u,t)}function y(){let t=(0,r.getFromCache)(u)||(0,r.uuidv4)();return"false"===t&&(t=(0,r.uuidv4)()),v(t),t}function N(){return(0,r.getFromCache)(p)}function _(t){(0,r.setToCache)(p,t,!0)}function w(t){(0,r.setToCache)(T,t,!0)}function b(){return JSON.parse((0,r.getFromSessionStorage)(g)||"{}")}function A({publishId:t,timeStamp:e,type:o,sessionId:n}){const s=b()||{},i=s[t]||[];s[t]=[...i,{timeStamp:e,type:o,sessionId:n}],(0,r.setToSessionStorage)(g,JSON.stringify(s),!0)}const R=({publishId:t,productId:e})=>{const o=U(),n=o[e]||[],s={interactionDate:(new Date).toISOString(),publishId:t,productId:e};n.push(s),o[e]=n,D(o)},C=()=>{(0,r.setToSessionStorage)(g,"{}",!0)};function L(t){(0,r.setToCache)(E,t)}function O(){(0,r.setToCache)(c,!0)}const P=()=>JSON.parse((0,r.getFromLocalStorage)(i.Keys.TOLSTOY_VIEWERS_KEY)||"{}"),M=()=>P().abTest||{},x=t=>{const e=P();e.abTest=t,V(e)},U=()=>JSON.parse((0,r.getFromCache)(i.Keys.TOLSTOY_VIEWED_PRODUCTS)||"{}"),D=t=>{(0,r.setToCache)(i.Keys.TOLSTOY_VIEWED_PRODUCTS,JSON.stringify(t))},V=t=>{(0,r.setLocalStorage)(i.Keys.TOLSTOY_VIEWERS_KEY,JSON.stringify(t))};function k(t){(0,r.setLocalStorage)(i.Keys.IDENTIFY_INFO_ID_KEY,t)}function B(){return(0,r.getFromLocalStorage)(i.Keys.IDENTIFY_INFO_ID_KEY)}function F(){localStorage.removeItem(i.Keys.IDENTIFY_INFO_ID_KEY)}const G=t=>{(0,r.setLocalStorage)(i.Keys.SESSION_COUNTER_KEY,t)},$=()=>Number((0,r.getFromLocalStorage)(i.Keys.SESSION_COUNTER_KEY)),W=t=>{(0,r.setLocalStorage)(i.Keys.FIRST_SEEN_AT_KEY,t)},Y=()=>(0,r.getFromLocalStorage)(i.Keys.FIRST_SEEN_AT_KEY);function j(t){const e=(new Date).toISOString();(0,r.setToCache)(m(t),e)}const K=t=>(0,r.getFromSessionStorage)(`${a}-${t}`),H=t=>(0,r.setToSessionStorage)(`${a}-${t}`,"true",!0),q=t=>window.sessionStorage.removeItem(`${a}-${t}`),Q=()=>(0,r.getFromSessionStorage)(l),X=t=>(0,r.setToSessionStorage)(l,t,!0),z=()=>(0,r.removeFromSessionStorage)(l),J=()=>{const t=(0,r.getFromSessionStorage)(d);return t||Z()},Z=()=>{const t=(0,r.uuidv4)();return(0,r.setToSessionStorage)(d,t,!0),t},tt=()=>{const t=(0,r.getFromSessionStorage)(S);return t&&"null"!==t?t:null},et=t=>(0,r.setToSessionStorage)(S,t,!0),ot=(t,e)=>{const o=b()||{},n=o[t]||[];if(null==n||!n.length)return;n[n.length-1].sessionId=e,(0,r.setToSessionStorage)(g,JSON.stringify(o),!0)},nt=()=>(0,r.getFromSessionStorage)(h),st=t=>(0,r.setToSessionStorage)(h,t),rt=t=>(0,r.setLocalStorage)(`${I}-${t}`,"true",!0),it=t=>(0,r.getFromLocalStorage)(`${I}-${t}`),at=(t,e)=>(0,r.setLocalStorage)(`${i.Keys.NOTIFICATION_BADGE_PREFIX}-${t}`,e,!0),lt=t=>(0,r.getFromLocalStorage)(`${i.Keys.NOTIFICATION_BADGE_PREFIX}-${t}`),dt=(t,e,o)=>(0,r.setLocalStorage)(`${i.Keys.BUBBLE_TEXT_PREFIX}-${t}-${e}`,o,!0),ct=(t,e)=>(0,r.getFromLocalStorage)(`${i.Keys.BUBBLE_TEXT_PREFIX}-${t}-${e}`),ut=(t,e)=>(0,r.setLocalStorage)(`${i.Keys.RECREATE_NEW_RESOLUTION_PREFIX}-${t}`,e,!0),Et=t=>(0,r.getFromLocalStorage)(`${i.Keys.RECREATE_NEW_RESOLUTION_PREFIX}-${t}`)})),s.register("KwGJG",(function(e,o){t(e.exports,"TOLSTOY_CACHE_KEYS",(function(){return n})),t(e.exports,"COOKIE_POLICIES",(function(){return s}));const n={TOLSTOY_HIDE_WIDGET_STORAGE_KEY:"tolstoy-hide-widget",TOLSTOY_SESSION_ID_KEY:"tolstoy-session-id",TOLSTOY_SESSION_UNIQUE_ID_KEY:"tolstoy-session-unique-id",TOLSTOY_PRODUCT_RECOMMENDATIONS:"tolstoy-product-recommendation",TOLSTOY_ANONYMOUS_ID:"tolstoy-anonymousId",TOLSTOY_REPLY:"tolstoy-reply",TOLSTOY_GROUP:"tolstoy-group",TOLSTOY_PUBLISH_ID:"tolstoy-publishId",TOLSTOY_ACTIVITY_KEY:"tolstoy-activity",TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:"tolstoy-not-visible-opened-publish-id",TOLSTOY_INTERACTION_DATE:"tolstoy-interaction-date",IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:"tolstoy-is-shopify-cart-anonymous-id-set",TOLSTOY_COOKIE_POLICY:"tolstoy-cookie-policy",TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:"tolstoy-recreate-resolutions"},s={accepted:"accepted",rejected:"rejected"}})),s.register("lFmQM",(function(e,o){t(e.exports,"uuidv4",(function(){return a})),t(e.exports,"getFromSessionStorage",(function(){return d})),t(e.exports,"getFromLocalStorage",(function(){return c})),t(e.exports,"getFromCache",(function(){return u})),t(e.exports,"setToSessionStorage",(function(){return E})),t(e.exports,"setLocalStorage",(function(){return p})),t(e.exports,"setToCache",(function(){return T})),t(e.exports,"removeFromSessionStorage",(function(){return g})),t(e.exports,"setCookiePolicy",(function(){return f})),t(e.exports,"removeAllTolstoyKeysFromStorage",(function(){return m}));var n=s("KwGJG"),r=s("b1G1l");const{TOLSTOY_COOKIE_POLICY:i}=n.TOLSTOY_CACHE_KEYS;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=Math.trunc(16*Math.random());return("x"===t?e:3&e|8).toString(16)}))}function l(t){try{return t()}catch(t){var e,o;return null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t),null}}function d(t){return l((()=>window.sessionStorage.getItem(t)))}function c(t){return l((()=>localStorage.getItem(t)))||d(t)}function u(t){return c(t)||d(t)}function E(t,e,o=!1){l((()=>{if(S()!==n.COOKIE_POLICIES.rejected||o)return window.sessionStorage.setItem(t,e)}))}function p(t,e,o=!1){l((()=>S()!==n.COOKIE_POLICIES.rejected?localStorage.setItem(t,e):o?window.sessionStorage.setItem(t,e):void 0))}function T(t,e,o=!1){l((()=>S()!==n.COOKIE_POLICIES.rejected?localStorage.setItem(t,e):o?window.sessionStorage.setItem(t,e):void 0))}function g(t){return l((()=>window.sessionStorage.removeItem(t)))}const S=()=>u(i),f=t=>{T(i,t,!0)},h=t=>{const e=window.location.host;document.cookie=`${t}=; path=/; domain=.${e}; expires=Thu, 01 Jan 1970 00:00:00 UTC;`,document.cookie=`${t}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`},I=t=>[...Object.values(n.TOLSTOY_CACHE_KEYS),...Object.values(r.Keys)].some((e=>t.includes(e)));function m(){const t=document.cookie.split("; ");for(const e of t){const[t]=e.split("=");I(t.trim())&&h(t)}for(const t in localStorage)I(t)&&localStorage.removeItem(t);for(const t in sessionStorage)I(t)&&sessionStorage.removeItem(t)}(()=>{const t=document.cookie.split("; ");for(const e of t){const[t]=e.split("=");I(t.trim())&&h(t)}})()})),s.register("b1G1l",(function(e,o){t(e.exports,"Keys",(function(){return n}));const n={IDENTIFY_INFO_ID_KEY:"identifyInfoId",SESSION_COUNTER_KEY:"tolstoySessionCounter",LAST_SEEN_AT_KEY:"tolstoyLastSeenAtKey",FIRST_SEEN_AT_KEY:"tolstoyFirstSeenAtKey",TOLSTOY_VIEWERS_KEY:"tolstoyViewers",TOLSTOY_VIEWED_PRODUCTS:"tolstoyViewedProducts",CURRENT_CUSTOMER_EMAIL_KEY:"tolstoyCurrentCustomer",BUBBLE_TEXT_PREFIX:"bubbleText",NOTIFICATION_BADGE_PREFIX:"notificationBadge",RECREATE_NEW_RESOLUTION_PREFIX:"reCreateNewResolution"}})),s.register("bjVW9",(function(e,o){t(e.exports,"reloadFont",(function(){return s}));const n=(t,e=1)=>{3!==e&&(document.querySelector("#tolstoyWidgetElement")?document.querySelector("#tolstoyWidgetElement").style.fontFamily=t:setTimeout((()=>{n(t,e+1)}),1e3))};function s(t){if(!t)return;const{sources:e}=t,o="tolstoy-custom-font-family";!function(t,e){const o="italic",n="normal",s=document.createElement("style");for(const r of Object.keys(t)){const i=t[r],a=r.includes(o),l=r.replace(o,"")||n,d=a?o:n,c=i.includes(".otf")?"opentype":"truetype",u=i.replace("http://","https://");s.append(document.createTextNode(`@font-face { font-family: '${e}'; src: url("${u}") format("${[c]}"); font-weight: ${l}; font-style: ${d};}`))}document.head.append(s)}(e,o),n(o)}})),s.register("lxnwr",(function(e,o){t(e.exports,"getProjectConfig",(function(){return a})),t(e.exports,"getConfigByUrl",(function(){return l})),t(e.exports,"getConfigByProductId",(function(){return d})),t(e.exports,"sendEvent",(function(){return c})),t(e.exports,"createResolutions",(function(){return u})),t(e.exports,"createSiteActivityEvent",(function(){return E}));var n=s("91LvR"),r=s("3TKJr"),i=s("5RRgB");const a=async(t,e)=>{const o=(0,i.getProductId)(),s=(0,n.getFilteredSearchParams)({widgetType:e,productId:o});try{return(await fetch(`${r.API_BASE_URL}/settings/${t}/widget?${s}`)).json()}catch(t){var a,l;null===(a=(l=window).tolstoyCaptureError)||void 0===a||a.call(l,t,"Error loading config:")}},l=async t=>{try{return(await fetch(`${r.API_BASE_URL}/settings/product-by-url?${new URLSearchParams({...t,url:`${window.location.origin}${window.location.pathname}`})}`)).json()}catch(t){var e,o;null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t,"Error getting product page config:")}},d=async({productId:t,...e})=>{try{return(await fetch(`${r.API_BASE_URL}/settings/product/${t}?${new URLSearchParams(e)}`)).json()}catch(t){var o,n;null===(o=(n=window).tolstoyCaptureError)||void 0===o||o.call(n,t,"Error getting product page config:")}},c=async t=>{if(void 0!==window.location.origin)try{return await fetch(`${r.API_BASE_URL}/events/event`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){var e,o;null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t,"Error sending page view:")}},u=async t=>{try{return await fetch(`${r.CREATE_VIDEO_RESOLUTIONS}?publishId=${t}`)}catch(t){var e,o;null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t)}},E=t=>{try{window.navigator.sendBeacon(r.SITE_ACTIVITY_EVENT_URL,JSON.stringify(t))}catch(t){var e,o;const n="Error occured in createSiteActivityEvent";console.error(n,t),null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t,n)}}})),s.register("5RRgB",(function(e,o){t(e.exports,"getProductId",(function(){return i})),t(e.exports,"getShop",(function(){return a}));var n=s("eBCiO"),r=s("1S4OJ");function i(){return(0,r.getParameterFromWidgetScripts)(n.WIDGET_SCRIPT_PARAMETERS.productId)}function a(){return(0,r.getParameterFromWidgetScripts)(n.WIDGET_SCRIPT_PARAMETERS.shop)}})),s.register("kzUTo",(function(e,o){t(e.exports,"default",(function(){return a}));var n=s("lFmQM"),r=s("dqsbU"),i=s("lxnwr");var a=class{sendEmptyPublishIdPageView(t,e,o,s){const a={publishId:t,abTestId:e,appKey:o,anonymousId:(0,r.getAndSetAnonymousId)(),eventName:"pageView",isMobile:window.screen.width<=450||window.screen.height<=450,timestamp:(new Date).toISOString(),parentUrl:window.location.href,sessionId:(0,n.uuidv4)(),playerType:this.widgetType,storeUrl:s};(0,i.sendEvent)(a)}removeAbTestIfFinished(){const t=(0,r.getTolstoyAbTest)();for(const[e,o]of Object.entries(t)){if(null==o||!o.endAt)continue;new Date(null==o?void 0:o.endAt)<new Date&&delete t[e]}(0,r.setTolstoyAbTest)(t)}updateAbTest(t,e){var o;const n=t.publishId,s=t.abTestId,i=t.abTestEndAt;if(!s||s===this.abTestId)return void(this.abTestId=s);if(!n){const o=t.appKey;this.sendEmptyPublishIdPageView(n,s,o,e)}const a=(0,r.getTolstoyAbTest)();null!==(o=a[s])&&void 0!==o&&o.publishId||(a[s]={publishId:n,endAt:i},(0,r.setTolstoyAbTest)(a))}init(t,e){this.removeAbTestIfFinished(),this.updateAbTest(t,e)}constructor(t="bubble"){this.abTestId=null,this.widgetType=t}}})),s.register("gDuGE",(function(e,o){t(e.exports,"getBaseUrl",(function(){return a})),t(e.exports,"getImageUrlByStep",(function(){return l})),t(e.exports,"setVideoSourceOnEnd",(function(){return d}));var n=s("3TKJr"),r=s("lzAu9"),i=s("koLqL");const a=({step:t,isStory:e,isPlayInTileFirst:o,height:s=i.DEFAULT_TILE_HEIGHT})=>{const{videoOwner:r,stockAsset:a,videoId:l}=t,d=(({isMobile:t,isStory:e,isPlayInTileFirst:o})=>o?"_640.mp4":t||e?"_preview.mp4":"_preview_embed.mp4")({isMobile:window.innerWidth<=450,isStory:e,isPlayInTileFirst:o}),c=null==a?void 0:a.videoUrl,u=Boolean(null==a?void 0:a.shopifyFileId),E=null==a?void 0:a.previewUrl,p=null==a?void 0:a.hasOriginal,T=null==a?void 0:a.gifUrl,g=u&&!p;if(E&&!o&&s<480)return E;if(c&&u)return c;if(c&&!u){if(null!=c&&c.includes("vimeo"))return c;return`${c.split(".mp4")[0]}${d}`}if(T&&g){return`${T.split(".mp4")[0]}${d}`}return`${n.VIDEO_OUTPUT}/public/${r}/${l}/${l}${d}`},l=t=>(({videoOwner:t,stockAsset:e,videoId:o},s)=>{if(!o)return"";const r=null==e?void 0:e.posterUrl,i=null==e?void 0:e.hasOriginal;return null!=r&&r.endsWith(s)||r&&!i?r:`${n.VIDEO_OUTPUT}/public/${t}/${o}/${o}${s}`})(t,window.innerWidth<=450?r.WEBP_AVATAR_EXTENSION:r.WEBP_EXTENSION),d=(t,e)=>{t.addEventListener("ended",(()=>{t.autoplay?t.src="":t.src=e}),{once:!0})}})),s.register("lzAu9",(function(e,o){t(e.exports,"WEBP_AVATAR_EXTENSION",(function(){return n})),t(e.exports,"WEBP_EXTENSION",(function(){return s})),t(e.exports,"JPG_AVATAR_EXTENSION",(function(){return r})),t(e.exports,"JPG_EXTENSION",(function(){return i}));const n=".avatar.0000000.webp",s=".401.0000000.webp",r=".avatar.0000000.jpg",i=".0000000.jpg"})),s.register("hTSLX",(function(e,o){t(e.exports,"tolstoyWidgetReady",(function(){return r})),t(e.exports,"tolstoyPlayerReady",(function(){return i}));var n=s("dvoXB");const r=()=>{const t=new CustomEvent("tolstoyWidgetReady");window.dispatchEvent(t)},i=()=>{const t=new CustomEvent(n.TOLSTOY_PLAYER_READY_MESSAGE);window.dispatchEvent(t)}})),s.register("IT65M",(function(e,o){function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}t(e.exports,"default",(function(){return n}))})),s.register("94S9O",(function(e,o){t(e.exports,"createElement",(function(){return n})),t(e.exports,"createScript",(function(){return s})),t(e.exports,"createIframe",(function(){return r})),t(e.exports,"registerDomUpdatesListener",(function(){return a})),t(e.exports,"safePlayVideo",(function(){return l})),t(e.exports,"stringToHTML",(function(){return d})),t(e.exports,"getPublicId",(function(){return c})),t(e.exports,"getElementSelector",(function(){return u})),t(e.exports,"getElement",(function(){return E})),t(e.exports,"getCustomElementSelector",(function(){return p})),t(e.exports,"getCustomElement",(function(){return T}));const n=({tagName:t,src:e,container:o,attributes:n,style:s,styleString:r,classNames:i,eventListeners:a})=>{const l=document.createElement(t);if(a)for(const[t,e]of Object.entries(a))l.addEventListener(t,e);if(e&&(l.src=e),n)for(const[t,e]of Object.entries(n))l.setAttribute(t,e);if(r&&(l.style.cssText=r),s)for(const[t,e]of Object.entries(s))l.style[t]=e;return i&&l.classList.add(...i),o&&o.append(l),l},s=({src:t,container:e,attributes:o})=>n({tagName:"script",src:t,container:e,attributes:o}),r=({src:t,container:e,attributes:o,style:s})=>n({tagName:"iframe",src:t,container:e,attributes:o,style:s}),i=({callback:t,classNames:e})=>{const o=t=>e.includes(t),n=t=>!!t.classList&&((t=>[...t.classList].some(o))(t)||(t=>e.some((e=>t.getElementsByClassName(e).length>0)))(t)),s=t=>{if("childList"!==t.type||0===t.addedNodes.length)return!1;return[...t.addedNodes].some(n)};new window.MutationObserver((e=>{e.some(s)&&t()})).observe(document.body,{subtree:!0,childList:!0})},a=({callback:t,classNames:e})=>{(({callback:t})=>{window.addEventListener("DOMContentLoaded",t),window.addEventListener("load",t)})({callback:t}),"MutationObserver"in window&&i({callback:t,classNames:e})},l=({video:t,onError:e})=>null==t?void 0:t.play().catch(e),d=t=>{const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild},c=(t,e)=>`${t}-${e}`,u=(t,e)=>`[data-tolstoy-element="${c(t,e)}"]`,E=(t,e)=>window.document.querySelector(u(t,e)),p=(t,e)=>`[${t}="${e}"]`,T=(t,e)=>window.document.querySelector(`[${t}="${e}"]`)})),s.register("jlRmE",(function(e,o){t(e.exports,"default",(function(){return d}));var n=s("IT65M"),r=s("iKqHk"),i=s("k3SOX");class a extends r.default{constructor(){if(a.instance)return a.instance;super({shouldArchivePastEvents:!0}),(0,n.default)(this,"eventHandler",(t=>{const{data:e={}}=t,{eventName:o}=e;if(this.eventCallbacks[o])for(const e of this.eventCallbacks[o])e(t)})),(0,n.default)(this,"postMessage",(t=>{const e=t.transmissionId||(0,i.generateUUID)();return super.postMessage({...t,transmissionId:e}),e})),(0,n.default)(this,"init",(()=>{this.initListener(this.eventHandler)})),a.instance=this}}const l=new a;Object.freeze(l);var d=l})),s.register("iKqHk",(function(e,o){t(e.exports,"default",(function(){return i}));var n=s("IT65M"),r=s("iFHzg");var i=class{logMessage(t){this.shouldIncludeLogs&&console.log(t)}throwError(t){if(this.shouldIncludeLogs)throw new Error(t)}archivePastEvent(t){if(!this.shouldArchivePastEvents)return;const{eventName:e}=t;this.pastEvents[e]||(this.pastEvents[e]=[]),this.pastEvents[e].push(t)}postMessage(t){this.archivePastEvent(t),this.broadcastHub.postMessage(t)}postPastEvents({eventName:t,callback:e}){if(this.pastEvents[t])for(const o of this.pastEvents[t])e({...o,isPastEvent:!0})}subscribe({eventName:t,callback:e,shouldIncludePastEvents:o}){this.eventCallbacks[t]||(this.eventCallbacks[t]=new Set),this.eventCallbacks[t].has(e)?this.throwError(`Already subscribed to event ${t} with this callback`):(this.eventCallbacks[t].add(e),o&&this.postPastEvents({eventName:t,callback:e}))}unsubscribe({eventName:t,callback:e}){if(!this.eventCallbacks[t])return void this.throwError(`Not subscribed to event ${t}`);if(!this.eventCallbacks[t].has(e))return void this.throwError("Callback is not subscribed");this.eventCallbacks[t].delete(e)?this.logMessage(`Unsubscribed from event ${t}`):this.logMessage(`Not subscribed to event ${t} with this callback`)}initListener(t){this.broadcastHub.addEventListener("message",t)}constructor({shouldIncludeLogs:t=!1,shouldArchivePastEvents:e=!1}={}){(0,n.default)(this,"subscribeMultipleEvents",(({eventNames:t,callback:e})=>{for(const o of t)this.subscribe({eventName:o,callback:e})})),(0,n.default)(this,"unsubscribeMultipleEvents",(({eventNames:t,callback:e})=>{for(const o of t)this.unsubscribe({eventName:o,callback:e})})),this.broadcastHub=new(0,r.default),this.eventCallbacks={},this.pastEvents={},this.shouldIncludeLogs=t,this.shouldArchivePastEvents=e}}})),s.register("iFHzg",(function(e,o){t(e.exports,"default",(function(){return i}));var n=s("IT65M"),r=s("k3SOX");var i=class{constructor(t){(0,n.default)(this,"postMessage",(t=>{var e;null===(e=this.broadcaster)||void 0===e||e.postMessage(t)})),(0,n.default)(this,"addEventListener",((...t)=>{var e;null===(e=this.receiver)||void 0===e||e.addEventListener(...t)})),this.name=t||(0,r.generateUUID)();try{"BroadcastChannel"in self&&(this.broadcaster=new BroadcastChannel(this.name),this.receiver=new BroadcastChannel(this.name))}catch(t){console.error("self is not defined",t)}}}})),s.register("7UrTD",(function(e,o){t(e.exports,"INTERNAL_EVENTS",(function(){return n}));const n={modalOpen:"tolstoyModalOpen",playerReady:"tolstoyPlayerReady",toggleFeedCloseButton:"toggleFeedCloseButton",isRebuyAppInstalled:"tolstoyIsRebuyAppInstalled",openRebuyCart:"tolstoyOpenRebuyCart",rebuyCartShown:"rebuyCartShown",rebuyCartHidden:"rebuyCartHidden",openKendoModal:"tolstoyOpenKendoModal",changeZIndex:"tolstoyChangeZIndex",isAfterpayAppInstalled:"tolstoyIsAfterpayAppInstalled",getProductsMetafields:"getProductsMetafields",returnProductsMetafields:"returnProductsMetafields",productCardClick:"tolstoyProductCardClick",spotlightCarouselQuickShopClick:"tolstoySpotlightCarouselQuickShopClick",externalEventSubscribed:"tolstoyExternalEventSubscribed",productCardClickSubscribed:"tolstoyProductCardClickSubscribed",isTapcart:"tolstoyIsTapcart",openTapcartProduct:"tolstoyOpenTapcartProduct",shopifyUrlRootPathUpdate:"tolstoyShopifyUrlRootPathUpdate",requestShopifyProductsUpdate:"tolstoyRequestShopifyProductsUpdate",shopifyProductUpdateResponse:"tolstoyShopifyProductUpdateResponse",setAnonymousIdToCart:"tolstoySetAnonymousIdToCart",addToCart:"tolstoyAddToCart",addToCartSuccess:"tolstoyAddToCartSuccess",addToCartError:"tolstoyAddToCartError",addToCartSoldOut:"tolstoyAddToCartSoldOut",addToCartDisableDefault:"tolstoyAddToCartDisableDefault",cartItemQuantityChange:"tolstoyCartItemQuantityChange",cartItemQuantityChangeSuccess:"tolstoyCartItemQuantityChangeSuccess",cartItemQuantityChangeError:"tolstoyCartItemQuantityChangeError",cartDataRequest:"tolstoyCartDataRequest",cartDataResponse:"tolstoyCartDataResponse",loginWithMultipassUrlRequest:"tolstoyLoginWithMultipassUrl",loginWithMultipassUrlResponse:"tolstoyLoginWithMultipassUrlResponseMessage",productRecommendationsRequest:"tolstoyProductRecommendationsRequest",productRecommendationsResponse:"tolstoyProductRecommendationsResponse",redirectToUrl:"tolstoyRedirectToUrl",urlChange:"urlChange",rejectCookiePolicy:"rejectCookiePolicy"}})),s.register("gRLfh",(function(t,e){t.exports=s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("fFRFR")).then((()=>s("7qcKo")))})),s.register("4ls7A",(function(t,e){"use strict";var o=s("kKIdi");t.exports=o((function(t){return new Promise((function(e,o){var n=document.getElementsByTagName("script");if([].concat(n).some((function(e){return e.src===t})))e();else{var s=document.createElement("link");s.href=t,s.rel="preload",s.as="script",document.head.appendChild(s);var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.src=t,r.onerror=function(e){var n=new TypeError("Failed to fetch dynamically imported module: ".concat(t,". Error: ").concat(e.message));r.onerror=r.onload=null,r.remove(),o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)}}))}))})),s.register("kKIdi",(function(t,e){"use strict";var o={},n={},s={};function r(t){switch(t){case"preload":return n;case"prefetch":return s;default:return o}}t.exports=function(t,e){return function(o){var n=r(e);return n[o]?n[o]:n[o]=t.apply(null,arguments).catch((function(t){throw delete n[o],t}))}}})),s.register("jkvoc",(function(e,o){var n;t(e.exports,"getBundleURL",(function(){return n}),(function(t){return n=t}));var s={};function r(t){return(""+t).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(t){var e=s[t];return e||(e=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return r(t[2])}return"/"}(),s[t]=e),e}})),s.register("liZgT",(function(t,e){t.exports=Promise.all([s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("afLhw")),s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("flP3Y")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("2NwkO"))]).then((()=>s("30d2H")))})),s.register("7R8ub",(function(t,e){"use strict";var o=s("kKIdi");t.exports=o((function(t){return new Promise((function(e,o){var n=document.getElementsByTagName("link");if([].concat(n).some((function(e){return e.href===t&&e.rel.indexOf("stylesheet")>-1})))e();else{var s=document.createElement("link");s.rel="stylesheet",s.href=t,s.onerror=function(t){s.onerror=s.onload=null,s.remove(),o(t)},s.onload=function(){s.onerror=s.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(s)}}))}))})),s.register("cxBMi",(function(t,e){t.exports=Promise.all([s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("flP3Y")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("afLhw")),s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("kTNC2")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("8pwlZ"))]).then((()=>s("5CISG")))})),s.register("lCzfm",(function(t,e){t.exports=Promise.all([s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("flP3Y")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("afLhw")),s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("jRYDX")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("aqBLd"))]).then((()=>s("cR5EJ")))})),s.register("cijz4",(function(e,o){t(e.exports,"default",(function(){return s}));class n{static isValidUrl(t){if(!t)return!1;if(t.startsWith("tel:")||t.startsWith("mailto:"))return!0;return null!==t.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)}static isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}static isInIframe(){try{return window.self!==window.top}catch(t){return!0}}static isIos(){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1}static getMobileOperatingSystem(){const t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?"iOS":navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"ipad":null}static isMobile(){return null!=n.getMobileOperatingSystem()}static isSafari(){return void 0!==window.safari}static enforceProtocol(t,e="https"){return t.startsWith("http")||t.startsWith("//")||t.startsWith("tel:")||t.startsWith("mailto:")?t:`${e}://${t}`}static removeProtocol(t){return t.replace(/(^\w+:|^)\/\//,"")}static stripUrl(t){return n.removeProtocol(t).replace(/^www./,"").replace(/\/$/,"")}}var s=n})),s.register("lLTou",(function(e,o){t(e.exports,"default",(function(){return r}));var n=s("dqsbU");var r=class{addHours(t,e=new Date){return e.setTime(e.getTime()+36e5*t),e}getTolstoyViewers(){const t=(0,n.getTolstoyViewers)();for(const[e,o]of Object.entries(t)){const n=o.restrictionLimits;if(!n)continue;!(null==n||!n.time)&&new Date(null==n?void 0:n.time)<=new Date&&delete t[e].restrictionLimits}const e=JSON.stringify(t);return(0,n.setTolstoyViewers)(t),e}updateRestrictions(t,e){var o;const s=(0,n.getTolstoyViewers)(),r=null===(o=s[e])||void 0===o?void 0:o.restrictionLimits;if(!r||(null==r?void 0:r.type)!==t)return;const i=r[t];r[t]=i?i+1:1,r.limit&&r.clickLimit===r[t]&&(r.time=this.addHours(null==r?void 0:r.limit)),s[e].restrictionLimits=r,(0,n.setTolstoyViewers)(s)}updateRules(t){var e;const o=(null==t?void 0:t.publishId)||void 0,s=null==t?void 0:t.limit,r=(0,n.getTolstoyViewers)();let i=r[o];const a=null===(e=i)||void 0===e?void 0:e.restrictionLimits;i?i.impressionCount+=1:i={impressionCount:1,playCount:0};let l=r.undefined;if(l?l.impressionCount+=1:l={impressionCount:1,playCount:0},s){let t={limit:Number(s.timeLimit),type:s.type,clickLimit:Number(s.clickLimit)};a&&(t={...a,...t}),i.restrictionLimits=t}else a&&(i.restrictionLimits=null);r[o]=i,r.undefined=l,(0,n.setTolstoyViewers)(r)}}})),s.register("cd4ez",(function(t,e){t.exports=Promise.all([s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("flP3Y")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("afLhw")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("5TFRd"))]).then((()=>s("bUT1B")))})),s.register("1GnUc",(function(t,e){t.exports=Promise.all([s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("flP3Y")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("afLhw")),s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("f2Df8")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("9Qmue"))]).then((()=>s("2svAm")))})),s.register("GOQG7",(function(e,o){t(e.exports,"PUBLIC_CLASSES",(function(){return n})),t(e.exports,"TOLSTOY_TV_CONTAINER_ID",(function(){return s})),t(e.exports,"TOLSTOY_TV_ID",(function(){return r})),t(e.exports,"AB_TEST_PUBLISH_IDS",(function(){return i}));const n={tvContainer:"tolstoy-video-page"},s="tolstoy-tv-container",r="tolstoy-tv",i={}})),s.register("8JgtY",(function(t,e){t.exports=Promise.all([s("7R8ub")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("adPaZ")),s("4ls7A")(s("jkvoc").getBundleURL("Q2FGl")+s("dG3SA").resolve("7E11g"))]).then((()=>s("gb7CH")))})),s.register("aKjoa",(function(e,o){t(e.exports,"EXTERNAL_EVENTS_TO_SUBSCRIBE",(function(){return n})),t(e.exports,"EXTERNAL_EVENTS_TO_POST",(function(){return s})),t(e.exports,"ALLOWED_EXTERNAL_EVENTS_TO_SUBSCRIBE",(function(){return r})),t(e.exports,"ALLOWED_EXTERNAL_EVENTS_TO_POST",(function(){return i}));const n={addToCart:"tolstoy_add_to_cart",spotlightCarouselQuickShopClick:"tolstoy_spotlight_carousel_quick_shop_click",productCardClick:"tolstoy_product_card_click"},s={addToCartSuccess:"tolstoy_add_to_cart_success",addToCartError:"tolstoy_add_to_cart_error",rejectCookiePolicy:"tolstoy_reject_cookie_policy",tolstoyZIndexChange:"tolstoy_z_index_change"},r=Object.values(n),i=new Set([s.addToCartSuccess,s.addToCartError,s.rejectCookiePolicy,s.tolstoyZIndexChange])})),s.register("dOd9O",(function(e,o){t(e.exports,"default",(function(){return g}));var n=s("IT65M"),r=s("7UrTD"),i=s("dvoXB"),a=s("jlRmE"),l=s("FQiOj");const d={},c={},u={},E=[];class p{registerIframe({modalId:t,modalIframe:e}){d[t]=e}postInternalMessage({modalId:t,data:e}){delete e.modalId;const o=a.default.postMessage(e);u[o]=t}handleModalReady({modalId:t}){c[t]=!0;const e=d[t];for(const o of E){const{transmissionId:n}=o,s=u[n],r=s===t;(!s||r)&&this.postMessageToIframe({iframe:e,message:o})}}postMessageToIframe({iframe:t,message:e}){var o;null===(o=t.contentWindow)||void 0===o||o.postMessage(e,"*")}postMessageToAllIframes({message:t}){E.push(t);for(const[e,o]of Object.entries(d)){c[e]&&this.postMessageToIframe({iframe:o,message:t})}}postMessageToModal(t){const{transmissionId:e,shouldEndTransmission:o=!0,...n}=t,s=u[e];if(!s)return this.postMessageToAllIframes({message:n});if(!c[s])return void E.push(t);const r=d[s];this.postMessageToIframe({iframe:r,message:n}),o&&delete u[e]}init(){this.initInternalMessagingSubscriptions(),window.addEventListener("message",this.eventHandler)}constructor(){if((0,n.default)(this,"eventHandler",(({data:t={}})=>{const{modalId:e,eventName:o}=t;if(e)switch(o){case r.INTERNAL_EVENTS.addToCart:case r.INTERNAL_EVENTS.openRebuyCart:case r.INTERNAL_EVENTS.openKendoModal:case r.INTERNAL_EVENTS.getProductsMetafields:case r.INTERNAL_EVENTS.productCardClick:case r.INTERNAL_EVENTS.loginWithMultipassUrlRequest:case r.INTERNAL_EVENTS.cartItemQuantityChange:case r.INTERNAL_EVENTS.cartDataRequest:case r.INTERNAL_EVENTS.productRecommendationsRequest:case r.INTERNAL_EVENTS.requestShopifyProductsUpdate:case r.INTERNAL_EVENTS.redirectToUrl:return this.postInternalMessage({modalId:e,data:t});case i.TOLSTOY_PLAYER_READY_MESSAGE:return this.postInternalMessage({modalId:e,data:t}),this.handleModalReady({modalId:e});case r.INTERNAL_EVENTS.toggleFeedCloseButton:return this.postInternalMessage({modalId:e,data:t});default:return null}})),(0,n.default)(this,"internalEventHandler",(({data:t})=>{this.postMessageToModal(t)})),(0,n.default)(this,"initInternalMessagingSubscriptions",(()=>{a.default.subscribeMultipleEvents({eventNames:l.INTERNAL_MESSAGES_TO_SUBSCRIBE,callback:this.internalEventHandler})})),p.instance)return p.instance;p.instance=this}}const T=new p;Object.freeze(T);var g=T})),s.register("FQiOj",(function(e,o){t(e.exports,"INTERNAL_MESSAGES_TO_SUBSCRIBE",(function(){return r}));var n=s("7UrTD");const r=[n.INTERNAL_EVENTS.addToCartError,n.INTERNAL_EVENTS.addToCartSuccess,n.INTERNAL_EVENTS.addToCartSoldOut,n.INTERNAL_EVENTS.isRebuyAppInstalled,n.INTERNAL_EVENTS.isAfterpayAppInstalled,n.INTERNAL_EVENTS.openRebuyCart,n.INTERNAL_EVENTS.returnProductsMetafields,n.INTERNAL_EVENTS.rejectCookiePolicy,n.INTERNAL_EVENTS.productCardClickSubscribed,n.INTERNAL_EVENTS.isTapcart,n.INTERNAL_EVENTS.shopifyUrlRootPathUpdate,n.INTERNAL_EVENTS.loginWithMultipassUrlResponse,n.INTERNAL_EVENTS.cartDataResponse,n.INTERNAL_EVENTS.cartItemQuantityChangeSuccess,n.INTERNAL_EVENTS.cartItemQuantityChangeError,n.INTERNAL_EVENTS.productRecommendationsResponse,n.INTERNAL_EVENTS.shopifyProductUpdateResponse]})),s("dG3SA").register(JSON.parse('{"Q2FGl":"widget.js","fFRFR":"widget.events.js","2NwkO":"carousel.js","flP3Y":"Carousel.83dcdbd1.css","afLhw":"Carousel.1bb7ff81.js","8pwlZ":"story.js","kTNC2":"Story.3ccadb5c.css","aqBLd":"embed.js","jRYDX":"Embed.943691e0.css","5TFRd":"centered-modal.js","9Qmue":"bubble.js","f2Df8":"Bubble.e66db9e3.css","7E11g":"t-v.js","adPaZ":"TV.cdafb98f.css"}'));var r=s("80wBz"),i=s("hTSLX"),a=s("3TKJr"),l=s("IT65M"),d=s("eBCiO"),c=s("94S9O");const u="data-status",E="loading",p="loaded";var T=class{async init(){const t=this.getElements();if(0!==t.length){for(const e of t)if(this.getShouldInitializeElement(e)){this.setElementStatus(e,E);try{const t=new this.Component;if(await t.init(e),!t.getIsInitialized()){this.deleteElementStatus(e);continue}this.widgets.push(t),this.initializeEvents({element:e,widget:t}),this.setElementStatus(e,p)}catch(t){console.log(`error starting tolstoy  ${this.name}`,e.id,t)}}this.widgets.length>0&&(this.initialized=!0)}}deleteElementStatus(t){t.removeAttribute(u)}getElementStatus(t){return t.getAttribute(u)}setElementStatus(t,e){return t.setAttribute(u,e)}getShouldInitializeElement(t){return!this.getElementStatus(t)}setComponent(t){this.Component=t}getElements(){return document.querySelectorAll(`.${this.elementClassname}`)}shouldLoad(){return this.getElements().length>0}initializeEvents({element:t,widget:e}){var o;null===(o=e.handlePageView)||void 0===o||o.call(e),this.registerEmbedViewListener({element:t,callback:e.handleView})}registerEmbedViewListener({element:t,callback:e}){(({element:t})=>{const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)})({element:t})?e():(({element:t,callback:e})=>{const o=new window.IntersectionObserver((n=>{!0===n[0].isIntersecting&&(o.unobserve(t),e())}),{threshold:[1]});o.observe(t)})({element:t,callback:e})}constructor({name:t,component:e,elementClassname:o}){this.name=t,this.Component=e,this.widgets=[],this.initialized=!1,this.elementClassname=o}},g=s("jlRmE"),S=s("7UrTD");let f=!1;const h=async()=>{if(f)return;(await s("gRLfh")).initializeWidgetEvents(),f=!0};var I=class{async init(){const t=[];for(const e of[d.CAROUSEL_EMBED_WIDGET,d.STORY_EMBED_WIDGET,d.EMBED_WIDGET]){const o=d.EMBED_WIDGETS_CLASSNAMES[e],n=new T({name:e,elementClassname:o});this.embedWidgetsMap[e]={embedWidget:n,loaded:!1},t.push(o)}this.registerDomUpdatesListenerIfNeeded(t),this.subscribeToUrlChange(),await this.loadEmbedWidgets()}async loadEmbedWidget({embedWidgetName:t,embedWidget:e}){let o;switch(this.embedWidgetsMap[t].loading=!0,t){case d.CAROUSEL_EMBED_WIDGET:o=await s("liZgT");break;case d.STORY_EMBED_WIDGET:o=await s("cxBMi");break;case d.EMBED_WIDGET:o=await s("lCzfm")}e.setComponent(o.default),await h(),this.embedWidgetsMap[t].loaded=!0,this.embedWidgetsMap[t].loading=!1}registerDomUpdatesListenerIfNeeded(t){if(this.domUpdatesListenerInitialized)return;(0,c.registerDomUpdatesListener)({classNames:t,callback:()=>this.loadEmbedWidgets()}),this.domUpdatesListenerInitialized=!0}subscribeToUrlChange(){g.default.subscribe({eventName:S.INTERNAL_EVENTS.urlChange,callback:this.handleUrlChange})}constructor(){(0,l.default)(this,"loadEmbedWidgets",(async()=>{const t=Object.entries(this.embedWidgetsMap).map((async([t,{embedWidget:e,loaded:o,loading:n}])=>{e.shouldLoad()&&(n?setTimeout((()=>this.loadEmbedWidgets()),2e3):(o||await this.loadEmbedWidget({embedWidgetName:t,embedWidget:e}),await e.init()))}));await Promise.all(t)})),(0,l.default)(this,"handleUrlChange",(()=>{for(const t of Object.keys(this.embedWidgetsMap))this.embedWidgetsMap[t].loaded=!1;this.loadEmbedWidgets()})),this.domUpdatesListenerInitialized=!1,this.widgets=[],this.embedWidgetsMap={}}},m=(l=s("IT65M"),s("kUoFQ")),v=s("dqsbU"),y=(d=s("eBCiO"),s("cijz4")),N=s("5RRgB"),_=(a=s("3TKJr"),s("kzUTo")),w=s("lLTou");v=s("dqsbU");const b=`${a.API_BASE_URL}/accounts/actions/accounts`;var A=class{async init(){return this.appKey?null:{}}async getWidgetId(){var t;const e=window.location.href;if(window.tolstoyWidgetId)return window.tolstoyWidgetId;const o=(null===(t=window.Shopify)||void 0===t?void 0:t.shop)||(0,N.getShop)();if(!this.appKey&&!o)return;const n=(0,v.getIdentifyInfoId)(),s=this.rules.getTolstoyViewers(),r=o||window.location.host,i={timestamp:Date.now(),url:e,sessionCount:Number((0,v.getSessionCounter)()||0),lastSeenAt:(new Date).toISOString(),firstSeenAt:(0,v.getFirstSeenAt)(),tolstoySeenCounter:s,isMobile:y.default.isMobile(),domain:r,appUrl:o};n&&(i.identifyInfoId=n);const a=this.appKey||"";try{var l;const t=await fetch(`${b}/${a}?`+new URLSearchParams(i));return this.config=200===t.status?await t.json():null,this.rules.updateRules(this.config),this.abTest.init(this.config,o),null===(l=this.config)||void 0===l?void 0:l.publishId}catch{return null}}constructor(t){this.appKey=t,this.config=null,this.rules=new(0,w.default),this.abTest=new(0,_.default)}};v=s("dqsbU");const R="groupA",C="groupB",L=new Set([]);var O=class{getGroup(){const t=(0,v.getTestGroup)();return t||this.calcGroup()}calcGroup(){return Math.random()<.5?R:C}saveGroupInCache(){(0,v.setTestGroup)(this.group)}changeGroupConfig(t){this.group&&(t.testGroup=this)}isGroupB(){return this.group===C}constructor(t){L.has(t)&&(this.group=this.getGroup(),this.saveGroupInCache())}};v=s("dqsbU"),a=s("3TKJr");const P=(d=s("eBCiO")).BUBBLE_WIDGET,M=new Set(["5bzilmwoe1fon","z7uu0kcyzumt0"]),x=t=>M.has(t)?d.CENTERED_MODAL_WIDGET:P,U=()=>{const t=window.location.href;return()=>t!==window.location.href};const D=(t,e)=>t.find((t=>t.name===e));var V=class{async init({account:t,widgetId:e,Component:o}){var n;this.account=t;const s=new o(t);await s.init(),this.widgets.push(s),this.updateViewerIdentifyAttributes(),null!==(n=window.tolstoySettings)&&void 0!==n&&n.noReload||this.registerEvents(t),await this.reloadWidget({account:t,widgetId:e})}updateViewerIdentifyAttributes(){const t=Number((0,v.getSessionCounter)()||0)+1;(0,v.setSessionCounter)(t.toString()),(0,v.getFirstSeenAt)()||(0,v.setFirstSeenAt)((new Date).toISOString())}handleMouseDown(){this.userInteracted=!0,document.removeEventListener("mousedown",this.handleMouseDown)}registerEvents(t){const e=window.history.pushState,o=window.history.replaceState;document.addEventListener("mousedown",(()=>{this.handleMouseDown()})),document.addEventListener("mouseout",(async e=>{var o;const n=null==t||null===(o=t.config)||void 0===o?void 0:o.exitIntentPublishId;n&&this.userInteracted&&!e.toElement&&!e.relatedTarget&&await this.recreate(n,{startPlayerImmediately:!0})})),window.history.pushState=function(){const t=U();e.apply(window.history,arguments),window.dispatchEvent(new window.Event("pushstate")),t()&&window.dispatchEvent(new window.Event("locationchange"))},window.history.replaceState=function(){const t=U();o.apply(window.history,arguments),window.dispatchEvent(new window.Event("replacestate")),t()&&window.dispatchEvent(new window.Event("locationchange"))},window.addEventListener("popstate",(()=>{window.dispatchEvent(new window.Event("locationchange"))})),window.addEventListener("locationchange",(async()=>{await this.reloadWidget({account:t})}))}async reloadWidget({account:t,settings:e,widgetId:o}){var n;o||(o=await t.getWidgetId()),console.debug("tolstoyWidgetId",o);new O(o).changeGroupConfig(t);if((null===(n=window.tolstoySettings)||void 0===n?void 0:n.alwaysShow)&&o||o&&"true"!==(0,v.getTolstoyHideWidget)(o)){const t=x(o);this.show(t),this.recreate(o,e,t)}else this.hide()}async identify(t){if(t)try{const{email:e,userId:o}=t;if(e&&(window.tolstoyUser=e,this.changeEmail(e)),!e&&!o)return void console.error("No email or userId");o&&(t.userId=o.toString()),t.appKey=this.account.appKey;const n=await fetch(`${a.API_BASE_URL}/identify/identify`,{method:"POST",body:JSON.stringify({data:t})}),s=await n.json();(0,v.setIdentifyInfoId)(null==s?void 0:s.id)}catch(t){var e,o;null===(e=(o=window).tolstoyCaptureError)||void 0===e||e.call(o,t,"Error occurred while updating identify info:"),(0,v.removeIdentifyInfoId)()}}start(t=P){const e=D(this.widgets,t);e&&e.start()}startPart(t,e=P){const o=D(this.widgets,e);o&&o.startPart(t)}closePlayer(t=P){const e=D(this.widgets,t);e&&e.closePlayer()}hide(t=P){const e=D(this.widgets,t);e&&e.hide()}show(t=P){const e=D(this.widgets,t);e&&e.show()}changeEmail(t,e=P){const o=D(this.widgets,e);o&&o.changeEmail(t)}on(t,e,o=P){const n=D(this.widgets,o);n&&n.eventChange(t,e)}recreate(t,e,o=P){const n=D(this.widgets,o);n&&n.recreate(t,e)}constructor({account:t}){this.initialized=!1,this.account=t,this.widgets=[],this.start=this.start.bind(this),this.startPart=this.startPart.bind(this),this.closePlayer=this.closePlayer.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.changeEmail=this.changeEmail.bind(this),this.on=this.on.bind(this),this.recreate=this.recreate.bind(this),this.identify=this.identify.bind(this),window.tolstoyWidget={...window.tolstoyWidget,identify:this.identify,start:this.start,startPart:this.startPart,closePlayer:this.closePlayer,show:this.show,hide:this.hide,changeEmail:this.changeEmail,on:this.on,recreate:this.recreate}}};S=s("7UrTD"),g=s("jlRmE");var k=class{subscribeToUrlChange(){g.default.subscribe({eventName:S.INTERNAL_EVENTS.urlChange,callback:this.handleUrlChange})}unsubscribeFromUrlChange(){g.default.unsubscribe({eventName:S.INTERNAL_EVENTS.urlChange,callback:this.handleUrlChange})}constructor(){(0,l.default)(this,"init",(async()=>{var t;const e=(0,m.getAppKey)(),o=new A(e),n=new V({account:o}),r=await o.getWidgetId();if(!r)return console.debug("tolstoyWidgetId",r),void this.subscribeToUrlChange();new O(r).changeGroupConfig(o);if(!(null===(t=window.tolstoySettings)||void 0===t?void 0:t.alwaysShow)&&"true"===(0,v.getTolstoyHideWidget)(r))return void this.subscribeToUrlChange();this.unsubscribeFromUrlChange();const i=x(r);let a;i===d.CENTERED_MODAL_WIDGET?a=await s("cd4ez"):i===d.BUBBLE_WIDGET&&(a=await s("1GnUc")),await h(),await n.init({account:o,widgetId:r,Component:a.default})})),(0,l.default)(this,"handleUrlChange",(()=>{this.unsubscribeFromUrlChange(),this.init()}))}},B=s("GOQG7");c=s("94S9O");var F=class{async init(){await this.loadVideo(),this.loaded||this.registerDomUpdatesListenerIfNeeded()}async loadVideo(){const t=document.querySelector(`#${B.TOLSTOY_TV_CONTAINER_ID}`);if(!t)return;new(0,(await s("8JgtY")).default)({tolstoyContainer:t}).init(),this.loaded=!0}registerDomUpdatesListenerIfNeeded(){if(this.domUpdatesListenerInitialized)return;const t=[B.PUBLIC_CLASSES.tvContainer];(0,c.registerDomUpdatesListener)({classNames:t,callback:()=>this.loadVideo()}),this.domUpdatesListenerInitialized=!0}constructor(){this.domUpdatesListenerInitialized=!1,this.loaded=!1}};m=s("kUoFQ");l=s("IT65M");var G=s("iKqHk"),$=s("aKjoa");S=s("7UrTD"),g=s("jlRmE"),$=s("aKjoa");const W=({eventName:t,callback:e})=>{if($.ALLOWED_EXTERNAL_EVENTS_TO_SUBSCRIBE.includes(t))if(e){if("function"==typeof e)return!0;console.error("Callback must be a function")}else console.error("Callback must be provided");else console.error(`Event ${t} is not a valid event`)};class Y extends G.default{init(){this.initInternalMessagingSubscriptions(),this.initListener(this.eventHandler)}constructor(){if(Y.instance)return Y.instance;super({shouldIncludeLogs:!0}),(0,l.default)(this,"eventHandler",(({data:t={}})=>{const{eventName:e}=t;if(this.eventCallbacks[e])for(const o of this.eventCallbacks[e])try{o(t)}catch(t){console.error(t)}})),(0,l.default)(this,"subscribe",((t,e,o={})=>{if(W({eventName:t,callback:e}))try{super.subscribe({eventName:t,callback:e}),g.default.postMessage({eventName:S.INTERNAL_EVENTS.externalEventSubscribed,subscribedEventName:t,payload:o}),console.log("Subscribed to event",t)}catch(t){console.error(t)}})),(0,l.default)(this,"unsubscribe",((t,e)=>super.unsubscribe({eventName:t,callback:e}))),(0,l.default)(this,"initInternalMessagingSubscriptions",(()=>{g.default.subscribeMultipleEvents({eventNames:$.ALLOWED_EXTERNAL_EVENTS_TO_SUBSCRIBE,callback:this.eventHandler})})),Y.instance=this}}const j=new Y;Object.freeze(j);var K=j;l=s("IT65M"),$=s("aKjoa"),g=s("jlRmE");const H=new class{constructor(){(0,l.default)(this,"postMessage",((t={})=>{(t=>{const{eventName:e}=t;if(e){if($.ALLOWED_EXTERNAL_EVENTS_TO_POST.has(e))return!0;console.error(`${e} is not a valid eventName`)}else console.error("eventName is required")})(t)&&g.default.postMessage(t)}))}};Object.freeze(H);var q=H;g=s("jlRmE"),S=s("7UrTD"),g=s("jlRmE");class Q{init(){const t=window.history.pushState,e=window.history.replaceState;let o=window.location.href;const n=()=>{window.location.href!==o&&(o=window.location.href,g.default.postMessage({eventName:S.INTERNAL_EVENTS.urlChange}))};window.history.pushState=function(){t.apply(window.history,arguments),n()},window.history.replaceState=function(){e.apply(window.history,arguments),n()}}constructor(){if(Q.instance)return Q.instance;Q.instance=this}}const X=new Q;Object.freeze(X);var z=X;l=s("IT65M"),S=s("7UrTD"),g=s("jlRmE");const J=[(S=s("7UrTD")).INTERNAL_EVENTS.modalOpen];const Z=new class{sendIsAfterpayAppInstalledMessage(){var t;g.default.postMessage({eventName:S.INTERNAL_EVENTS.isAfterpayAppInstalled,value:Boolean(null===(t=window)||void 0===t?void 0:t.Afterpay)})}initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:J,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}constructor(){(0,l.default)(this,"internalMessagingHandler",(t=>{if(t.data.eventName!==S.INTERNAL_EVENTS.modalOpen)return null;this.sendIsAfterpayAppInstalledMessage()}))}};Object.freeze(Z);var tt=Z,et=(l=s("IT65M"),$=s("aKjoa"),g=s("jlRmE"),s("lFmQM")),ot=s("KwGJG");S=s("7UrTD"),g=s("jlRmE");const nt=[$.EXTERNAL_EVENTS_TO_POST.rejectCookiePolicy];class st{init(){this.initExternalMessagingSubscriptions()}constructor(){if((0,l.default)(this,"externalMessagingHandler",(t=>t.data.eventName===$.EXTERNAL_EVENTS_TO_POST.rejectCookiePolicy?((0,et.removeAllTolstoyKeysFromStorage)(),(0,et.setCookiePolicy)(ot.COOKIE_POLICIES.rejected),void g.default.postMessage({eventName:S.INTERNAL_EVENTS.rejectCookiePolicy})):null)),(0,l.default)(this,"initExternalMessagingSubscriptions",(()=>{g.default.subscribeMultipleEvents({eventNames:nt,callback:this.externalMessagingHandler})})),st.instance)return st.instance;st.instance=this}}const rt=new st;Object.freeze(rt);var it=rt;l=s("IT65M"),$=s("aKjoa"),g=s("jlRmE"),S=s("7UrTD");const at={itemSoldOut:"itemSoldOut"},lt={tolstoyAnonymousId:"__tolstoyAnonymousId"};$=s("aKjoa"),S=s("7UrTD"),g=s("jlRmE");const dt=({data:t})=>{const{description:e}=t,o=(({description:t})=>t===at.itemSoldOut?S.INTERNAL_EVENTS.addToCartSoldOut:S.INTERNAL_EVENTS.addToCartError)({description:e});g.default.postMessage({...t,eventName:o})},ct=({data:t})=>{const{variantId:e,productId:o,transmissionId:n,quantity:s}=t;g.default.postMessage({variantId:e,productId:o,transmissionId:n,quantity:s,eventName:$.EXTERNAL_EVENTS_TO_SUBSCRIBE.addToCart})},ut=({data:t})=>{const{product:e,transmissionId:o}=t;g.default.postMessage({product:e,transmissionId:o,eventName:$.EXTERNAL_EVENTS_TO_SUBSCRIBE.spotlightCarouselQuickShopClick})},Et=({data:t})=>{const{subscribedEventName:e,payload:o={}}=t,{disableDefault:n}=o;switch(e){case $.EXTERNAL_EVENTS_TO_SUBSCRIBE.addToCart:case $.EXTERNAL_EVENTS_TO_SUBSCRIBE.spotlightCarouselQuickShopClick:n&&g.default.postMessage({eventName:S.INTERNAL_EVENTS.addToCartDisableDefault});break;default:return null}},pt=({data:t})=>{g.default.postMessage({...t,eventName:S.INTERNAL_EVENTS.addToCartSuccess})},Tt=[S.INTERNAL_EVENTS.addToCart,S.INTERNAL_EVENTS.spotlightCarouselQuickShopClick,S.INTERNAL_EVENTS.externalEventSubscribed],gt=[$.EXTERNAL_EVENTS_TO_POST.addToCartSuccess,$.EXTERNAL_EVENTS_TO_POST.addToCartError];class St{init(){this.initInternalMessagingSubscriptions(),this.initExternalMessagingSubscriptions()}constructor(){if((0,l.default)(this,"internalMessagingHandler",(t=>{switch(t.data.eventName){case S.INTERNAL_EVENTS.addToCart:return ct(t);case S.INTERNAL_EVENTS.spotlightCarouselQuickShopClick:return ut(t);case S.INTERNAL_EVENTS.externalEventSubscribed:return Et(t);default:return null}})),(0,l.default)(this,"externalMessagingHandler",(t=>{switch(t.data.eventName){case $.EXTERNAL_EVENTS_TO_POST.addToCartSuccess:return pt(t);case $.EXTERNAL_EVENTS_TO_POST.addToCartError:return dt(t);default:return null}})),(0,l.default)(this,"initInternalMessagingSubscriptions",(()=>{g.default.subscribeMultipleEvents({eventNames:Tt,callback:this.internalMessagingHandler})})),(0,l.default)(this,"initExternalMessagingSubscriptions",(()=>{g.default.subscribeMultipleEvents({eventNames:gt,callback:this.externalMessagingHandler})})),St.instance)return St.instance;St.instance=this}}const ft=new St;Object.freeze(ft);var ht=ft;g=s("jlRmE");const It=[(S=s("7UrTD")).INTERNAL_EVENTS.externalEventSubscribed,S.INTERNAL_EVENTS.productCardClick];$=s("aKjoa"),S=s("7UrTD"),g=s("jlRmE");const mt=({data:t})=>{const{eventName:e}=t;switch(e){case S.INTERNAL_EVENTS.externalEventSubscribed:{const{subscribedEventName:e,payload:o}=t;(({subscribedEventName:t,payload:e})=>{switch(t){case $.EXTERNAL_EVENTS_TO_SUBSCRIBE.productCardClick:{const{disableProductModal:t=!0}=e;g.default.postMessage({eventName:S.INTERNAL_EVENTS.productCardClickSubscribed,isDisableProductModal:t});break}default:;}})({subscribedEventName:e,payload:o});break}case S.INTERNAL_EVENTS.productCardClick:{const{variantId:e,productId:o,externalProductIds:n}=t;g.default.postMessage({eventName:$.EXTERNAL_EVENTS_TO_SUBSCRIBE.productCardClick,variantId:e,productId:o,taggedProductIds:n});break}default:return null}};const vt=new class{initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:It,callback:mt})}init(){this.initInternalMessagingSubscriptions()}};Object.freeze(vt);var yt=vt;l=s("IT65M"),g=s("jlRmE"),S=s("7UrTD");const Nt=[(S=s("7UrTD")).INTERNAL_EVENTS.getProductsMetafields];const _t=new class{getProductsMetafields(t=[]){const e={};for(const r of t){var o,n,s;e[r]=null===(o=window)||void 0===o||null===(n=o.metafields)||void 0===n||null===(s=n.products)||void 0===s?void 0:s[r]}return e}initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:Nt,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}constructor(){(0,l.default)(this,"internalMessagingHandler",(({data:t})=>{var e;if(t.eventName!==S.INTERNAL_EVENTS.getProductsMetafields)return null;null!=t&&null!==(e=t.productIds)&&void 0!==e&&e.length&&g.default.postMessage({productsExtraData:this.getProductsMetafields(t.productIds),modalId:t.modalId,eventName:S.INTERNAL_EVENTS.returnProductsMetafields})}))}};Object.freeze(_t);var wt=_t;l=s("IT65M"),S=s("7UrTD"),g=s("jlRmE");const bt=[(S=s("7UrTD")).INTERNAL_EVENTS.openRebuyCart],At={show:"rebuy:smartcart.show",hide:"rebuy:smartcart.hide",init:"rebuy:smartcart.init"};const Rt=new class{initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:bt,callback:this.internalMessagingHandler})}initRebuyEventListeners(){document.addEventListener(At.show,(()=>{g.default.postMessage({eventName:S.INTERNAL_EVENTS.rebuyCartShown})})),document.addEventListener(At.hide,(()=>{g.default.postMessage({eventName:S.INTERNAL_EVENTS.rebuyCartHidden})}))}init(){this.initInternalMessagingSubscriptions(),this.sendIsRebuyAppInstalledMessage()}constructor(){(0,l.default)(this,"sendIsRebuyAppInstalledMessage",(()=>{var t,e,o,n;null!==(t=window)&&void 0!==t&&null!==(e=t.Rebuy)&&void 0!==e&&e.SmartCart?(g.default.postMessage({eventName:S.INTERNAL_EVENTS.isRebuyAppInstalled,value:Boolean(null===(o=window)||void 0===o||null===(n=o.Rebuy)||void 0===n?void 0:n.SmartCart)}),this.initRebuyEventListeners()):document.addEventListener(At.init,this.sendIsRebuyAppInstalledMessage,{once:!0})})),(0,l.default)(this,"internalMessagingHandler",(t=>{var e,o,n;return t.data.eventName===S.INTERNAL_EVENTS.openRebuyCart?null===(e=window)||void 0===e||null===(o=e.Rebuy)||void 0===o||null===(n=o.SmartCart)||void 0===n?void 0:n.show():null}))}};Object.freeze(Rt);var Ct=Rt;l=s("IT65M"),S=s("7UrTD"),g=s("jlRmE");const Lt=[(S=s("7UrTD")).INTERNAL_EVENTS.openKendoModal];const Ot=new class{initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:Lt,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}constructor(){(0,l.default)(this,"internalMessagingHandler",(t=>{var e,o;if(t.data.eventName!==S.INTERNAL_EVENTS.openKendoModal)return null;{g.default.postMessage({eventName:S.INTERNAL_EVENTS.changeZIndex,zIndex:1e3}),null===(e=window.KENDO)||void 0===e||null===(o=e.openQuickModalByHandle)||void 0===o||o.call(e,t.data.productHandle);const n=t.data.quantity;if(n<=1)return;for(let t=1;t<n;t++)setTimeout((()=>{var t;const e=document.querySelector(".quantity-selector__action--increment");null==e||null===(t=e.click)||void 0===t||t.call(e)}),1e3+150*t)}}))}};Object.freeze(Ot);var Pt=Ot,Mt=(l=s("IT65M"),S=s("7UrTD"),g=s("jlRmE"),s("jWnd9")),xt=s("lxnwr");m=s("kUoFQ"),S=s("7UrTD"),g=s("jlRmE"),Mt=s("jWnd9");const Ut=[(S=s("7UrTD")).INTERNAL_EVENTS.addToCart,S.INTERNAL_EVENTS.playerReady,S.INTERNAL_EVENTS.productCardClick],Dt={cartUpdated:"cart/updated"},Vt=({productId:t,variantId:e})=>{const o={productId:String(t)};return e&&(o.variantId=String(e)),window.Tapcart.actions.openProduct(o)},kt=async t=>{const{variantId:e,productId:o}=t;try{(t=>{const e=setTimeout((()=>{g.default.postMessage({...t,eventName:S.INTERNAL_EVENTS.addToCartError})}),4e3);window.Tapcart.registerEventHandler(Dt.cartUpdated,(()=>{clearTimeout(e),g.default.postMessage({...t,eventName:S.INTERNAL_EVENTS.addToCartSuccess})}))})(t),window.Tapcart.actions.addToCart({lineItems:[{variantId:String(e||o),quantity:1}]})}catch(e){return g.default.postMessage({...t,error:e,eventName:S.INTERNAL_EVENTS.addToCartError})}},Bt=()=>{try{var t,e,o,n,s,r,i,a;const l=(0,Mt.getTapcartDeviceId)();if(!l)return;const d=[...(null===(t=window)||void 0===t||null===(e=t.Tapcart)||void 0===e||null===(o=e.variables)||void 0===o||null===(n=o.cart)||void 0===n?void 0:n.attributes)||[],{key:lt.tolstoyAnonymousId,value:l}];null===(s=window)||void 0===s||null===(r=s.Tapcart)||void 0===r||null===(i=r.actions)||void 0===i||null===(a=i.updateCartAttributes)||void 0===a||a.call(i,{attributes:d})}catch(t){(0,xt.sendEvent)({text:null==t?void 0:t.message,parentUrl:window.location.href,appKey:(0,m.getAppKey)(),source:"tapcart",eventName:"widgetError",timestamp:(new Date).toISOString()})}};const Ft=new class{disableCartDefault(){g.default.postMessage({eventName:S.INTERNAL_EVENTS.addToCartDisableDefault})}initInternalMessagingSubscriptions(){g.default.subscribeMultipleEvents({eventNames:Ut,callback:this.internalMessagingHandler})}init(){(0,Mt.getIsTapcart)()&&(this.initInternalMessagingSubscriptions(),Bt())}constructor(){(0,l.default)(this,"internalMessagingHandler",(t=>{switch(t.data.eventName){case S.INTERNAL_EVENTS.playerReady:return this.disableCartDefault();case S.INTERNAL_EVENTS.productCardClick:return Vt(t.data);case S.INTERNAL_EVENTS.addToCart:return kt(t.data);default:return null}}))}};Object.freeze(Ft);var Gt=Ft,$t=(c=s("94S9O"),s("8jyX0"));l=s("IT65M"),S=s("7UrTD");const Wt={USD:"$",CAD:"CA$",EUR:"",AED:"..",AFN:"",ALL:"Lek",AMD:".",ARS:"$",AUD:"AU$",AZN:".",BAM:"KM",BDT:"",BGN:".",BHD:"..",BIF:"FBu",BND:"$",BOB:"Bs",BRL:"R$",BWP:"P",BYN:".",BZD:"$",CDF:"FrCD",CHF:"CHF",CLP:"$",CNY:"CN",COP:"$",CRC:"",CVE:"CV$",CZK:"K",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"..",EEK:"kr",EGP:"..",ERN:"Nfk",ETB:"Br",GBP:"",GEL:"GEL",GHS:"GH",GNF:"FG",GTQ:"Q",HKD:"$",HNL:"L",HRK:"kn",HUF:"Ft",IDR:"Rp",ILS:"",INR:"",IQD:"..",IRR:"",ISK:"kr",JMD:"$",JOD:"..",JPY:"",KES:"Ksh",KHR:"",KMF:"FC",KRW:"",KWD:"..",KZT:".",LBP:"..",LKR:"SL Re",LTL:"Lt",LVL:"Ls",LYD:"..",MAD:"..",MDL:"MDL",MGA:"MGA",MKD:"MKD",MMK:"K",MOP:"MOP$",MUR:"MURs",MXN:"MX$",MYR:"RM",MZN:"MTn",NAD:"N$",NGN:"",NIO:"C$",NOK:"kr",NPR:"",NZD:"$",OMR:"..",PAB:"B/.",PEN:"S/.",PHP:"",PKR:"",PLN:"z",PYG:"",QAR:"..",RON:"RON",RSD:".",RUB:".",RWF:"FR",SAR:"..",SDG:"SDG",SEK:"kr",SGD:"$",SOS:"Ssh",SYP:"..",THB:"",TND:"..",TOP:"T$",TRY:"TL",TTD:"$",TWD:"NT$",TZS:"TSh",UAH:"",UGX:"USh",UYU:"$",UZS:"UZS",VEF:"Bs.F.",VND:"",XAF:"FCFA",XOF:"CFA",YER:"..",ZAR:"R",ZMK:"ZK",ZWL:"ZWL$"};v=s("dqsbU"),d=s("eBCiO"),g=s("jlRmE");var Yt=s("k3SOX");S=s("7UrTD");const jt={soldOut:"already sold out",sellingPlanRequired:"Variant can only be purchased with a selling plan."},Kt=[S.INTERNAL_EVENTS.addToCartDisableDefault,S.INTERNAL_EVENTS.setAnonymousIdToCart,S.INTERNAL_EVENTS.loginWithMultipassUrlRequest,S.INTERNAL_EVENTS.cartItemQuantityChange,S.INTERNAL_EVENTS.cartDataRequest,S.INTERNAL_EVENTS.productRecommendationsRequest,S.INTERNAL_EVENTS.requestShopifyProductsUpdate],Ht=[S.INTERNAL_EVENTS.addToCart,S.INTERNAL_EVENTS.spotlightCarouselQuickShopClick],qt=t=>({headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});let Qt=!1;const Xt={},zt={};class Jt{getIsProductSoldOutError(t){return t.includes(jt.soldOut)}getIsSellingPlanError(t){return t.includes(jt.sellingPlanRequired)}formatProduct(t){var e,o,n;if(!t)return null;const s=(null===(e=window.Shopify)||void 0===e||null===(o=e.currency)||void 0===o?void 0:o.active)||(null===(n=window.Shopify)||void 0===n?void 0:n.currency);return{...t,price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price,currencyCode:s,currencySymbol:Wt[s],variants:t.variants.map((t=>({...t,price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price})))}}async fetchRawProduct(t){const e=this.storeRootUrl+`products/${t}.js`;try{const t=await fetch(e),o=await t.json();return this.formatProduct(o)}catch{}}async getProduct(t){if(Xt[t])return Xt[t];if(zt[t])return zt[t];const e=this.fetchRawProduct(t);zt[t]=e;const o=await e;return Xt[t]=o,delete zt[t],o}async handleSellingPlanError(t,e){const o=await this.getProduct(e);if(!o)return;const{id:n}=o.selling_plan_groups[0].selling_plans[0];return this.shopifyAddToCart({variantId:t,productHandle:e,sellingPlanId:n})}handleAddToCartError({error:t,variantId:e,productHandle:o,transmissionId:n}){const{description:s}=t;if(!this.getIsProductSoldOutError(s))return this.getIsSellingPlanError(s)?this.handleSellingPlanError(e,o):void g.default.postMessage({eventName:S.INTERNAL_EVENTS.addToCartError,error:s,variantId:e,transmissionId:n});g.default.postMessage({eventName:S.INTERNAL_EVENTS.addToCartSoldOut,variantId:e,transmissionId:n})}handleUpdateItemQuantityError({error:t,variantId:e,transmissionId:o}){const{description:n}=t;g.default.postMessage({eventName:S.INTERNAL_EVENTS.cartItemQuantityChangeError,error:n,variantId:e,transmissionId:o})}async getCart({transmissionId:t}){const e=await fetch(`${this.storeRootUrl}cart.js`,{method:"GET"}),o=await e.json();g.default.postMessage({eventName:S.INTERNAL_EVENTS.cartDataResponse,cart:o,transmissionId:t})}triggerExternalCartUpdate(){var t,e,o,n,s,r,i,a,l,d,c,u;null===(t=window.VueMiniCart)||void 0===t||null===(e=t.$store)||void 0===e||null===(o=e._actions)||void 0===o||null===(n=o.initCart)||void 0===n||null===(s=n[0])||void 0===s||s.call(n),null===(r=window.slate)||void 0===r||null===(i=r.cart)||void 0===i||null===(a=i.reloadCart)||void 0===a||a.call(i),null===(l=(d=window).tolstoyCartRefresh)||void 0===l||l.call(d),null===(c=(u=window).monster_refresh)||void 0===c||c.call(u)}disableAddToCart(){Qt=!0,g.default.unsubscribeMultipleEvents({eventNames:Ht,callback:this.internalMessagingHandler})}postUrlRootPathIfNeeded(){"/"!==window.Shopify.routes.root&&g.default.postMessage({eventName:S.INTERNAL_EVENTS.shopifyUrlRootPathUpdate,urlRootPath:window.Shopify.routes.root})}shopifyQuickShopClick({product:t}){const{variants:e,handle:o,quantity:n=1}=t,s=e[0].id;return this.shopifyAddToCart({variantId:s,productHandle:o,quantity:n})}async getProductRecommendations({productId:t,transmissionId:e}){const o=`${this.storeRootUrl}recommendations/products.json?product_id=${t}`,n=await fetch(o,{method:"GET"}),{products:s}=await n.json();g.default.postMessage({eventName:S.INTERNAL_EVENTS.productRecommendationsResponse,productId:t,products:s,transmissionId:e})}async loginWithMultipassUrl({multipassUrl:t,transmissionId:e}){const o=await fetch(t);g.default.postMessage({eventName:S.INTERNAL_EVENTS.loginWithMultipassUrlResponse,statusCode:o.status,transmissionId:e})}async setAnonymousIdToCart({anonymousId:t}){if("true"===(0,v.getIsShopifyCartAnonymousIdSet)())return;const e=qt({attributes:{[lt.tolstoyAnonymousId]:t}});try{await fetch(`${this.storeRootUrl}cart/update.js`,e),(0,v.setIsShopifyCartAnonymousIdSet)(!0)}catch(t){console.error(t)}}postProductUpdateMessage(t,e){g.default.postMessage({eventName:S.INTERNAL_EVENTS.shopifyProductUpdateResponse,handle:t,product:e})}init(){this.isShopifyStore&&(this.initInternalMessagingSubscriptions(),this.postUrlRootPathIfNeeded())}constructor(){var t,e,o;if((0,l.default)(this,"onRequestProductsUpdateMessage",(t=>{const e=t.data.handles;for(const t of e)this.getProduct(t).then((e=>this.postProductUpdateMessage(t,e)))})),(0,l.default)(this,"shopifyAddToCart",(async({variantId:t,productHandle:e,sellingPlanId:o,quantity:n=d.DEFAULT_CART_QUANTITY,transmissionId:s})=>{const r={id:t,quantity:n,properties:{_isAddedFromTolstoy:!0}};o&&(r.selling_plan=o);const i=qt({items:[r]});try{const o=await fetch(`${this.storeRootUrl}cart/add.js`,i);if(!o.ok){const n=await o.json();return this.handleAddToCartError({error:n,variantId:t,productHandle:e,transmissionId:s})}this.triggerExternalCartUpdate(),g.default.postMessage({eventName:S.INTERNAL_EVENTS.addToCartSuccess,variantId:t,transmissionId:s,shouldEndTransmission:!1}),this.getCart({transmissionId:s})}catch(o){console.log(o),this.handleAddToCartError({error:o,variantId:t,productHandle:e,transmissionId:s})}})),(0,l.default)(this,"shopifyUpdateItemQuantity",(async({variantId:t,quantity:e,transmissionId:o})=>{const n=qt({updates:{[t]:e}});try{const e=await fetch(`${this.storeRootUrl}cart/update.js`,n);if(!e.ok){const n=await e.json();return this.handleUpdateItemQuantityError({error:n,variantId:t,transmissionId:o})}this.triggerExternalCartUpdate(),g.default.postMessage({eventName:S.INTERNAL_EVENTS.cartItemQuantityChangeSuccess,variantId:t,transmissionId:o,shouldEndTransmission:!1}),this.getCart({transmissionId:o})}catch(e){this.handleUpdateItemQuantityError({error:e,variantId:t,transmissionId:o})}})),(0,l.default)(this,"internalMessagingHandler",(t=>{switch(t.data.eventName){case S.INTERNAL_EVENTS.addToCart:return this.shopifyAddToCart(t.data);case S.INTERNAL_EVENTS.spotlightCarouselQuickShopClick:return this.shopifyQuickShopClick(t.data);case S.INTERNAL_EVENTS.addToCartDisableDefault:return this.disableAddToCart(t.data);case S.INTERNAL_EVENTS.setAnonymousIdToCart:return this.setAnonymousIdToCart(t.data);case S.INTERNAL_EVENTS.loginWithMultipassUrlRequest:return this.loginWithMultipassUrl(t.data);case S.INTERNAL_EVENTS.cartItemQuantityChange:return this.shopifyUpdateItemQuantity(t.data);case S.INTERNAL_EVENTS.cartDataRequest:return this.getCart(t.data);case S.INTERNAL_EVENTS.productRecommendationsRequest:return this.getProductRecommendations(t.data);case S.INTERNAL_EVENTS.requestShopifyProductsUpdate:return this.onRequestProductsUpdateMessage(t);default:return null}})),(0,l.default)(this,"initInternalMessagingSubscriptions",(()=>{g.default.subscribeMultipleEvents({eventNames:Kt,callback:this.internalMessagingHandler}),Qt?(0,Yt.logDevelopmentMessage)("Add to cart disabled"):g.default.subscribeMultipleEvents({eventNames:Ht,callback:this.internalMessagingHandler})})),Jt.instance)return Jt.instance;Jt.instance=this,this.isShopifyStore=Boolean(null===(t=window.Shopify)||void 0===t?void 0:t.shop),this.storeRootUrl=null===(e=window.Shopify)||void 0===e||null===(o=e.routes)||void 0===o?void 0:o.root}}const Zt=new Jt;Object.freeze(Zt);var te=Zt,ee=s("dOd9O"),oe=Object.assign(Object.create(null),{url:"file:///src/widgets/widgetloader.js"});const ne=async()=>{var t,e,o,n,s,l;window.tolstoyWidget||(window.navigator.userAgent.includes("bot")?console.debug("Bot user"):Boolean(document.body)?"true"!==(0,$t.getSafeParameter)("td")||null!==(t=document.currentScript)&&void 0!==t&&null!==(e=t.src)&&void 0!==e&&null!==(o=e.includes)&&void 0!==o&&o.call(e,"/ws/widget.js")||null!==(n=oe)&&void 0!==n&&null!==(s=n.url)&&void 0!==s&&null!==(l=s.includes)&&void 0!==l&&l.call(s,"/wes/widget.js")?((0,r.registerSiteActivityListenerIfNeeded)(),ae(),le(),de(),ce(),ue(),await Promise.all([se(),re(),ie()]),(0,i.tolstoyWidgetReady)()):(()=>{var t,e;const o=(null===(t=document.currentScript)||void 0===t?void 0:t.src)||(null===(e=oe)||void 0===e?void 0:e.url);null!=o&&o.includes("/we/widget.js")?(0,c.createScript)({src:`https://${a.WIDGET_DOMAIN}/wes/widget.js`,container:document.head,attributes:{type:"module"}}):(0,c.createScript)({src:`https://${a.WIDGET_DOMAIN}/ws/widget.js`,container:document.head})})():setTimeout(ne,50))},se=()=>(new k).init(),re=()=>(new F).init(),ie=()=>(new I).init(),ae=()=>(g.default.init(),g.default),le=()=>(ee.default.init(),ee.default),de=()=>{K.init();const{subscribe:t,unsubscribe:e}=K;return window.tolstoyWidget={...window.tolstoyWidget,subscribe:t,unsubscribe:e},K},ce=()=>{const{postMessage:t}=q;return window.tolstoyWidget={...window.tolstoyWidget,postMessage:t},q},ue=()=>{te.init(),z.init(),ht.init(),Ct.init(),Pt.init(),Gt.init(),tt.init(),it.init(),yt.init(),"8b32dacc-8f1d-4cce-b641-9f60e88f9414"===(0,m.getAppKey)()&&wt.init()};ne()}();