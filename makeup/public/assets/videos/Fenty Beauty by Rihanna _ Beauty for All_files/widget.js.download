var os=Object.defineProperty,ns=Object.defineProperties;var rs=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,Ht=Object.prototype.propertyIsEnumerable;var pt=(e,t,s)=>t in e?os(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,y=(e,t)=>{for(var s in t||(t={}))Yt.call(t,s)&&pt(e,s,t[s]);if(J)for(var s of J(t))Ht.call(t,s)&&pt(e,s,t[s]);return e},T=(e,t)=>ns(e,rs(t));var ht=(e,t)=>{var s={};for(var o in e)Yt.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(e!=null&&J)for(var o of J(e))t.indexOf(o)<0&&Ht.call(e,o)&&(s[o]=e[o]);return s};var h=(e,t,s)=>(pt(e,typeof t!="symbol"?t+"":t,s),s);var E=(e,t,s)=>new Promise((o,n)=>{var r=d=>{try{l(s.next(d))}catch(c){n(c)}},i=d=>{try{l(s.throw(d))}catch(c){n(c)}},l=d=>d.done?o(d.value):Promise.resolve(d.value).then(r,i);l((s=s.apply(e,t)).next())});const D={pageView:"pageView",sessionStart:"sessionStart",sessionEnd:"sessionEnd",videoPause:"videoPause",videoStart:"videoStart",videoResume:"videoResume",videoReplay:"videoReplay",clickCta:"clickCta",submitInput:"submitInput",collectInfo:"collectInfo",videoResponse:"videoResponse",audioResponse:"audioResponse",imageResponse:"imageResponse",tolstoyClick:"tolstoyClick",chapterSelected:"chapterSelected",chapterPickerOpened:"chapterPickerOpened",videoSeeked:"videoSeeked",shareClick:"shareClick",quizResult:"quizResult",autoplayStart:"autoplayStart"},w={sessionStart:"tolstoyStarted",sessionEnd:"tolstoyReachedEnd",clickCta:"tolstoyAnswerClicked",submitInput:"tolstoyInputSubmit",collectInfo:"tolstoyLeadFormSubmit",videoResponse:"tolstoyVideoSubmit",audioResponse:"tolstoyAudioSubmit",imageResponse:"tolstoyImageSubmit",openGorgias:"tolstoyOpenGorgias",hideGorgias:"tolstoyHideGorgias",openIntercom:"tolstoyOpenIntercom",hideIntercom:"tolstoyHideIntercom",openTawkTo:"tolstoyOpenTawkTo",hideTawkTo:"tolstoyHideTawkTo",openLiveChat:"tolstoyOpenLiveChat",hideLiveChat:"tolstoyHideLiveChat",openHubSpot:"tolstoyOpenHubSpot",hideHubSpot:"tolstoyHideHubSpot",openHelpScout:"tolstoyOpenHelpScout",hideHelpScout:"tolstoyHideHelpScout",openDrift:"tolstoyOpenDrift",hideDrift:"tolstoyHideDrift",openZendesk:"tolstoyOpenZendesk",hideZendesk:"tolstoyHideZendesk"},Cr="tolstoyEscapeKeyPressed",Rr="tolstoyWatchedProductIds",Or="showFeedProductModal",Ar="tolstoyWidgets",vr="showFeedCartMobile",Pr="tolstoyMoveToUrl",Mr="tolstoyCloseModalMessage",ce="tolstoyPlayerReady",k={OPEN:"open",CLOSE:"close",PLAY:"play",PAUSE:"pause"},is=[k.OPEN,k.PLAY],as=[k.CLOSE,k.PAUSE],Nr={ready:"tolstoyPreConfigMessengerReady",vodAssetIds:"tolstoyVodAssetIds"},Lr="rechargeMessaging",Ur="tolstoyRechargeWidgetData",Dr="tolstoyRequestRechargeWidgetData",$r="tolstoyRequestRechargeAddToCart",x={static:"static",dynamic:"dynamic",hoverOver:"hoverOver"},kr={under:"under",over:"over"},cs={carousel:"tolstoy-carousel",carouselContainer:"tolstoy-carousel-container",title:"tolstoy-carousel-title",videoCarouselContainer:"tolstoy-video-carousel-container",previousButton:"tolstoy-previous-button",nextButton:"tolstoy-next-button",videosContainer:"tolstoy-carousel-videos-container",videoContainer:"tolstoy-carousel-video-container",video:"tolstoy-carousel-video",image:"tolstoy-carousel-image",dotsContainer:"tolstoy-dots-container",dot:"tolstoy-dot",playButtonContainer:"tolstoy-play-button-container",controlsContainer:"tolstoy-carousel-controls-container",expandButton:"tolstoy-carousel-expand-button",muteButton:"tolstoy-carousel-mute-button",tileContainer:"tolstoy-carousel-tile-container",tile:"tolstoy-carousel-tile",tileNameContainer:"tolstoy-tile-name-container",tileNameText:"tolstoy-carousel-tile-name-text",arrowButtonContainer:"tolstoy-carousel-arrow-button-container",arrowButton:"tolstoy-carousel-arrow-button",tileNameHeightPlaceholder:"tolstoy-tile-name-height-placeholder",productTile:"tolstoy-product-tile",productTileImage:"tolstoy-product-tile-image",productTileTitle:"tolstoy-product-tile-title",variantTitle:"tolstoy-product-variant-tile-title",productTilePrice:"tolstoy-product-tile-price",productTileButton:"tolstoy-product-tile-button",descriptionTile:"tolstoy-description-tile",descriptionTileContent:"tolstoy-description-tile-content",descriptionTileButton:"tolstoy-description-tile-button"},Wr=6,Br=2,Vr=80,xr=.3,Fr=80,Gr=12,ls=416,Yr={DEFAULT:"default",SPOTLIGHT:"spotlight"},Hr={product:"product",videoName:"videoName"},Kr={shoppableVideoCarousel:"Shoppable Video Carousel"},ds={embed:"tolstoy-embed",iframe:"tolstoy-embed-iframe",videoPreview:"tolstoy-embed-video-preview",videoContainer:"tolstoy-embed-video-container",playButtonContainer:"tolstoy-embed-play-button-container",startText:"tolstoy-embed-start-text",startButtonContainer:"tolstoy-embed-start-button-container",startButton:"tolstoy-embed-start-button",embedContainer:"tolstoy-embed-container"},jr=9/16,us={story:"tolstoy-stories",storiesContainer:"tolstoy-stories-container",tilesContainer:"tolstoy-stories-tiles-container",tileName:"tolstoy-stories-tile-name",storyTile:"tolstoy-stories-tile",storyImage:"tolstoy-stories-story-image",storyVideo:"tolstoy-stories-story-video",plusTile:"tolstoy-stories-plus-tile",storyName:"tolstoy-stories-story-name",titleContainer:"tolstoy-stories-title",plusTileContainer:"tolstoy-stories-plus-tile-container",previousButton:"tolstoy-stories-previous-button",nextButton:"tolstoy-stories-next-button"},ps=".0000000.jpg",hs=".avatar",qr=`${hs}${ps}`,zr={static:x.static,dynamic:x.dynamic},Es={responsive:"responsive",fixed:"fixed"},Xr=Es.fixed,Qr=8,Zr=80,Jr=8,ti=256,wt="carousel",gs="inTileCarousel",le="bubble",It="stories",bt="embed",de="centeredModal",ei={clickedX:"stopShowingWidgetToClickedX",viewed:"stopShowingWidgetToViewed"},ue={[wt]:cs.carousel,[It]:us.story,[bt]:ds.embed},ys="siteActivity",si={notAllowedError:"NotAllowedError"},Ss=1,At={shop:"shop",appKey:"app-key",productId:"product-id"},oi={tolstoyAutoOpen:"tolstoyAutoOpen",tolstoyStartVideo:"tolstoyStartVideo"},fs="PRODUCT_ID",m={embedView:"embedView",embedPlay:"embedPlay",embedPause:"embedPause",embedMute:"embedMute",embedUnmute:"embedUnmute",embedExpand:"embedExpand",tolstoyModalClose:"tolstoyModalClose",feedProductModalOpen:"feedProductModalOpen",feedProductModalClose:"feedProductModalClose",videoLoaded:"videoLoaded",pageView:"pageView",clickViewProduct:"clickViewProduct",openProductPageClick:"openProductPageClick",feedPlay:"feedPlay",feedPause:"feedPause",videoMuted:"videoMuted",videoUnmuted:"videoUnmuted",videoWatched:"videoWatched",openShareLink:"Open Share Link",feedNavigationArrowClick:"feedNavigationArrowClick",feedScroll:"feedScroll",sessionStart:"sessionStart"},W="https://api.gotolstoy.com",ms="https://player.gotolstoy.com",_t="widget.gotolstoy.com",pe="https://videos.gotolstoy.com",Ts="https://api.gotolstoy.com/migrations/recreate-video",ws="https://api.gotolstoy.com/site-activity/site-activity",Is="player-version",he="widget-loading",bs="widget-video-fallback",ni="carousel-show-dots",ri="carousel-videos",ii="hide-spotlight-plus-button",ai="spotlight-auto-resize",ci="app-use-creator-profile",vt=({config:e,featureKey:t})=>{var s;return(s=e==null?void 0:e.featureSettings)==null?void 0:s[t]},li=({config:e,featureKey:t})=>{var s;return!!((s=e==null?void 0:e.featureSettings)!=null&&s[t])},di=(e={})=>{const t=vt({config:e,featureKey:he});return t==null?void 0:t.playerLazy},Ee=(e={})=>{const t=vt({config:e,featureKey:he});return t==null?void 0:t.playerOrigin},ui=(e={})=>{const t=vt({config:e,featureKey:bs});return t==null?void 0:t.dontUseFallback},_s="www.",ge=new RegExp("^((([A-Za-z]{3,9}:(?:\\/\\/)?)(?:[\\-;:&=\\+\\$,\\w]+@)?[A-Za-z0-9\\.\\-]+|(?:www\\.|[\\-;:&=\\+\\$,\\w]+@)[A-Za-z0-9\\.\\-]+)((?:\\/[\\+~%\\/\\.\\w\\-_]*)?\\??(?:[\\-\\+=&;%@\\.\\w_]*)#?(?:[\\.\\!\\/\\\\\\w]*))?)","i"),Kt=e=>e?!!ge.test(e)||e.startsWith("tel:")||e.startsWith("mailto:")||e.startsWith("_self:"):!1,jt=e=>{const t=e.replace(_s,""),s=new URL(t);return`${s.origin}${s.pathname}${s.search}`},pi=(e,t)=>!Kt(e)||!Kt(t)?!1:jt(e)===jt(t),Cs=()=>{const e=new URLSearchParams(window.location.search),t=new URLSearchParams;for(const[s,o]of e){const n=s.toLowerCase();s.length<50&&o.length<100&&(n.startsWith("custom_")||n.startsWith("utm_"))&&t.append(s,o)}return t},Rs=(e={})=>{const t=new URLSearchParams;for(const[s,o]of Object.entries(e))o!=null&&o!==""&&t.append(s,o);return t.toString()},hi=e=>ge.test(e),Os="custom-blocks.tapcart.com",ye=()=>{var e,t,s;return!!((e=window==null?void 0:window.Tapcart)!=null&&e.isInitialized||(s=(t=document.location)==null?void 0:t.host)!=null&&s.includes(Os))},As=()=>{var t,s,o;const e=(o=(s=(t=window==null?void 0:window.Tapcart)==null?void 0:t.variables)==null?void 0:s.device)==null?void 0:o.id;return e==null?void 0:e.toLowerCase()},vs=()=>{var e,t;return Number((t=(e=window.Shopify)==null?void 0:e.currency)==null?void 0:t.rate)!==1},Ei=()=>{var e,t;return((t=(e=window.Shopify)==null?void 0:e.routes)==null?void 0:t.root)!=="/"},Ps=(e,t)=>{const s=Ee(e);if(s){const n=z("td"),r=Se(e);return n&&r?s.replace("2.0.0","2.0.0-ls"):r?s.replace("2.0.0","2.0.0-l"):n?s.replace("2.0.0","2.0.0-s"):s}let o=`${ms}`;return t&&(o+="/feed"),e.publishId&&(o+=`/${e.publishId}`),o},qt=()=>!!window.Shopify,z=e=>{var s;if(!("URLSearchParams"in window))return null;try{return new URLSearchParams((s=window.location)==null?void 0:s.search).get(e)}catch(o){if(o)return null}},Se=e=>e.playerLazy||z("pl"),Ms=e=>{var t,s;return(s=(t=e==null?void 0:e.featureSettings)==null?void 0:t[Is])==null?void 0:s.version},Ns=e=>{var t;return(t=e==null?void 0:e.carouselEmbed)!=null&&t.carouselPlayInTileFirst?gs:""},Ls=()=>{var e,t,s,o;return((e=window._st)==null?void 0:e.cid)||((o=(s=(t=window.ShopifyAnalytics)==null?void 0:t.meta)==null?void 0:s.page)==null?void 0:o.customerId)||""},Us=()=>{var e;return((e=window.tolstoyUserInfo)==null?void 0:e.email)||window.tolstoyUser},gi=({data:e,isFeed:t,email:s,isDynamic:o,modalId:n,tolstoyStartVideo:r})=>{var kt,Wt,Bt,Vt,xt,Ft;const i=`${window.location.origin}${window.location.pathname}`.slice(0,1999),l=((kt=window.Shopify)==null?void 0:kt.shop)||"",d=!!(qt()&&l);let c=`${Ps(e,t)}?host&url=${i}&safari=${!!(window!=null&&window.safari)}&dontDownload=${!!e.dontDownload}&playerType=${e.playerType}&isShopifyStore=${d}&shopifyStoreUrl=${l}&modalId=${n}`;if(qt()){const Gt=(Wt=window.Shopify.routes)==null?void 0:Wt.root;Gt&&(c+=`&shopifyRootRoute=${Gt}`),vs()&&(c+="&isShopifyNonDefaultCurrencyRate=true")}(Bt=window.tolstoyUserInfo)!=null&&Bt.name&&(c+=`&name=${(Vt=window.tolstoyUserInfo)==null?void 0:Vt.name}`),(xt=window.tolstoyUserInfo)!=null&&xt.phone&&(c+=`&phone=${(Ft=window.tolstoyUserInfo)==null?void 0:Ft.phone}`),r&&(c+=`&tolstoyStartVideo=${r}`);const p=s||Us();p&&(c+=`&email=${p}`),e.productId&&(c+=`&productId=${e.productId}`),e.currentProductDbId&&(c+=`&currentPageDbProductId=${e.currentProductDbId}`),e.testGroup&&(c+=`&group=${e.testGroup}`),e.sneakpeek&&(c+="&sneakpeek"),e.sneakpeek_hidden&&(c+="&sneakpeek_hidden"),e.token&&(c+=`&token=${e.token}`),e.gclid&&(c+=`&gclid=${e.gclid}`),e.widgetDelay&&(c+="&delay"),e.abTestId&&(c+=`&abTestId=${e.abTestId}`),e.isShoppable===!1&&(c+=`&isShoppable=${e==null?void 0:e.isShoppable}`),e.si&&(c+=`&si=${e.si}`),e.ai&&(c+=`&ai=${e.ai}`);const g=z("td");g&&(c+=`&td=${g}`);const f=Se(e);f&&(c+=`&pl=${f}`);const C=Ms(e);C&&(c+=`&pv=${C}`);const Q=Ns(e);Q&&(c+=`&playerVariant=${Q}`),o&&(c+="&isDynamic=true");const Z=Ls();Z&&(c+=`&customerId=${Z}`);const $t=Cs();return $t.size>0&&(c+=`&${$t.toString()}`),ye()&&(c+="&isTapcart=true"),Ee(e)&&(t&&(c+="&isFeed=true"),e.publishId&&(c+=`&publishId=${e.publishId}`)),c},Ds=e=>{var t;return e!=null&&e.length?`${(t=e[0])==null?void 0:t.toUpperCase()}${e==null?void 0:e.slice(1)}`:""},yi=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,fe=()=>{const e=t=>{const s=Math.floor(Math.random()*16);return(t==="x"?s:s&3|8).toString(16)};return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e)},me=()=>z("td")==="true",$s=e=>{me()&&console.log(e)},Si=e=>{me()&&console.error(e)},fi=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,mi=(e,t=300)=>{let s;return(...o)=>{clearTimeout(s),s=setTimeout(()=>{e(...o)},t)}},Ti=(e=0)=>E(void 0,null,function*(){return new Promise(t=>{setTimeout(t,e)})}),wi=(e,t=1)=>{const s=Number(e);return Number.isNaN(s)?0:Number.isInteger(s)?s:Number.parseFloat(s.toFixed(t))},Ii=e=>e.replace(/<[^>]*>?/gm,""),ks=e=>{const t=/^[\da-f]{8}-[\da-f]{4}-[0-5][\da-f]{3}-[089ab][\da-f]{3}-[\da-f]{12}$/i;return e==null?void 0:e.match(t)},Te=e=>is.includes(e),Ws=e=>as.includes(e),Bs=(e,t)=>{const s=e.src;return new URL(s).searchParams.get(t)},Vs=(e,t)=>e.getAttribute(`data-${t}`),Pt=e=>{const t=document.querySelectorAll(`script[src*="${_t}"]`);for(const s of t){const o=Vs(s,e)||Bs(s,e);if(o)return o}};function X(){return window.tolstoyAppKey?window.tolstoyAppKey:Pt(At.appKey)}const Mt={TOLSTOY_HIDE_WIDGET_STORAGE_KEY:"tolstoy-hide-widget",TOLSTOY_SESSION_ID_KEY:"tolstoy-session-id",TOLSTOY_SESSION_UNIQUE_ID_KEY:"tolstoy-session-unique-id",TOLSTOY_PRODUCT_RECOMMENDATIONS:"tolstoy-product-recommendation",TOLSTOY_ANONYMOUS_ID:"tolstoy-anonymousId",TOLSTOY_REPLY:"tolstoy-reply",TOLSTOY_GROUP:"tolstoy-group",TOLSTOY_PUBLISH_ID:"tolstoy-publishId",TOLSTOY_ACTIVITY_KEY:"tolstoy-activity",TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:"tolstoy-not-visible-opened-publish-id",TOLSTOY_INTERACTION_DATE:"tolstoy-interaction-date",IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:"tolstoy-is-shopify-cart-anonymous-id-set",TOLSTOY_COOKIE_POLICY:"tolstoy-cookie-policy",TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:"tolstoy-recreate-resolutions"},lt={accepted:"accepted",rejected:"rejected"},S={IDENTIFY_INFO_ID_KEY:"identifyInfoId",SESSION_COUNTER_KEY:"tolstoySessionCounter",LAST_SEEN_AT_KEY:"tolstoyLastSeenAtKey",FIRST_SEEN_AT_KEY:"tolstoyFirstSeenAtKey",TOLSTOY_VIEWERS_KEY:"tolstoyViewers",TOLSTOY_VIEWED_PRODUCTS:"tolstoyViewedProducts",CURRENT_CUSTOMER_EMAIL_KEY:"tolstoyCurrentCustomer",BUBBLE_TEXT_PREFIX:"bubbleText",NOTIFICATION_BADGE_PREFIX:"notificationBadge",RECREATE_NEW_RESOLUTION_PREFIX:"reCreateNewResolution"},{TOLSTOY_COOKIE_POLICY:we}=Mt;function it(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.trunc(Math.random()*16);return(e==="x"?t:t&3|8).toString(16)})}function B(e){var t;try{return e()}catch(s){return(t=window.tolstoyCaptureError)==null||t.call(window,s),null}}function A(e){return B(()=>window.sessionStorage.getItem(e))}function v(e){return B(()=>localStorage.getItem(e))||A(e)}function dt(e){return v(e)||A(e)}function P(e,t,s=!1){B(()=>{if(!(Nt()===lt.rejected&&!s))return window.sessionStorage.setItem(e,t)})}function U(e,t,s=!1){B(()=>{if(Nt()!==lt.rejected)return localStorage.setItem(e,t);if(s)return window.sessionStorage.setItem(e,t)})}function M(e,t,s=!1){B(()=>{if(Nt()!==lt.rejected)return localStorage.setItem(e,t);if(s)return window.sessionStorage.setItem(e,t)})}function xs(e){return B(()=>window.sessionStorage.removeItem(e))}const Nt=()=>dt(we),Fs=e=>{M(we,e,!0)},Ie=e=>{const t=window.location.host;document.cookie=`${e}=; path=/; domain=.${t}; expires=Thu, 01 Jan 1970 00:00:00 UTC;`,document.cookie=`${e}=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;`},ot=e=>[...Object.values(Mt),...Object.values(S)].some(s=>e.includes(s));function Gs(){const e=document.cookie.split("; ");for(const t of e){const[s]=t.split("=");ot(s.trim())&&Ie(s)}for(const t in localStorage)ot(t)&&localStorage.removeItem(t);for(const t in sessionStorage)ot(t)&&sessionStorage.removeItem(t)}const Ys=()=>{const e=document.cookie.split("; ");for(const t of e){const[s]=t.split("=");ot(s.trim())&&Ie(s)}};Ys();const{TOLSTOY_HIDE_WIDGET_STORAGE_KEY:Lt,TOLSTOY_SESSION_ID_KEY:Ut,TOLSTOY_SESSION_UNIQUE_ID_KEY:be,TOLSTOY_PRODUCT_RECOMMENDATIONS:Hs,TOLSTOY_ANONYMOUS_ID:_e,TOLSTOY_REPLY:Ks,TOLSTOY_GROUP:Ce,TOLSTOY_PUBLISH_ID:js,TOLSTOY_ACTIVITY_KEY:ut,TOLSTOY_NOT_VISIBLE_OPENED_PUBLISH_ID_KEY:Re,TOLSTOY_INTERACTION_DATE:zt,IS_SHOPIFY_CART_ANONYMOUS_ID_SET_KEY:Oe,TOLSTOY_RECREATE_RESOLUTIONS_PREFIX:bi}=Mt;function qs(e){return e?`${zt}-${e}`:zt}function zs(){return dt(_e)}function Xs(e){!e||["undefined","false"].includes(e)||M(_e,e)}function Ae(){let e=zs()||it();return e==="false"&&(e=it()),Xs(e),e}function Qs(){return dt(Ce)}function Zs(e){M(Ce,e,!0)}function _i(e){M(js,e,!0)}function at(){return JSON.parse(A(ut)||"{}")}function ve({publishId:e,timeStamp:t,type:s,sessionId:o}){const n=at()||{},r=n[e]||[];n[e]=[...r,{timeStamp:t,type:s,sessionId:o}],P(ut,JSON.stringify(n),!0)}const Ci=({publishId:e,productId:t})=>{const s=to(),o=s[t]||[],n={interactionDate:new Date().toISOString(),publishId:e,productId:t};o.push(n),s[t]=o,eo(s)},Js=()=>{P(ut,"{}",!0)};function Ri(e){M(Ks,e)}function Oi(){M(Hs,!0)}const $=()=>JSON.parse(v(S.TOLSTOY_VIEWERS_KEY)||"{}"),Xt=()=>$().abTest||{},Qt=e=>{const t=$();t.abTest=e,nt(t)},to=()=>JSON.parse(dt(S.TOLSTOY_VIEWED_PRODUCTS)||"{}"),eo=e=>{M(S.TOLSTOY_VIEWED_PRODUCTS,JSON.stringify(e))},nt=e=>{U(S.TOLSTOY_VIEWERS_KEY,JSON.stringify(e))};function so(e){U(S.IDENTIFY_INFO_ID_KEY,e)}function oo(){return v(S.IDENTIFY_INFO_ID_KEY)}function no(){localStorage.removeItem(S.IDENTIFY_INFO_ID_KEY)}const ro=e=>{U(S.SESSION_COUNTER_KEY,e)},Pe=()=>Number(v(S.SESSION_COUNTER_KEY)),io=e=>{U(S.FIRST_SEEN_AT_KEY,e)},Me=()=>v(S.FIRST_SEEN_AT_KEY);function Ai(e){const t=new Date().toISOString();M(qs(e),t)}const Ne=e=>A(`${Lt}-${e}`),vi=e=>P(`${Lt}-${e}`,"true",!0),Pi=e=>window.sessionStorage.removeItem(`${Lt}-${e}`),Le=()=>A(Ut),Mi=e=>P(Ut,e,!0),Ni=()=>xs(Ut),ao=()=>{const e=A(be);return e||co()},co=()=>{const e=it();return P(be,e,!0),e},lo=()=>{const e=A(Re);return!e||e==="null"?null:e},Dt=e=>P(Re,e,!0),Li=(e,t)=>{const s=at()||{},o=s[e]||[];if(!(o!=null&&o.length))return;const n=o[o.length-1];n.sessionId=t,P(ut,JSON.stringify(s),!0)},uo=()=>A(Oe),po=e=>P(Oe,e),Ui=(e,t)=>U(`${S.NOTIFICATION_BADGE_PREFIX}-${e}`,t,!0),Di=e=>v(`${S.NOTIFICATION_BADGE_PREFIX}-${e}`),$i=(e,t,s)=>U(`${S.BUBBLE_TEXT_PREFIX}-${e}-${t}`,s,!0),ki=(e,t)=>v(`${S.BUBBLE_TEXT_PREFIX}-${e}-${t}`),Wi=(e,t)=>U(`${S.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`,t,!0),Bi=e=>v(`${S.RECREATE_NEW_RESOLUTION_PREFIX}-${e}`);function ho(e,t){const s="italic",o="normal",n=".otf",r=document.createElement("style");for(const i of Object.keys(e)){const l=e[i],d=i.includes(s),c=i.replace(s,"")||o,p=d?s:o,f=l.includes(n)?"opentype":"truetype",C=l.replace("http://","https://");r.append(document.createTextNode(`@font-face { font-family: '${t}'; src: url("${C}") format("${[f]}"); font-weight: ${c}; font-style: ${p};}`))}document.head.append(r)}const Ue=(e,t=1)=>{if(t!==3){if(!document.querySelector("#tolstoyWidgetElement")){setTimeout(()=>{Ue(e,t+1)},1e3);return}document.querySelector("#tolstoyWidgetElement").style.fontFamily=e}};function Eo(e){if(!e)return;const{sources:t}=e,s="tolstoy-custom-font-family";ho(t,s),Ue(s)}function go(){return Pt(At.productId)}function yo(){return Pt(At.shop)}const Vi=(e,t)=>E(void 0,null,function*(){var n;const s=go(),o=Rs({widgetType:t,productId:s});try{return(yield fetch(`${W}/settings/${e}/widget?${o}`)).json()}catch(r){(n=window.tolstoyCaptureError)==null||n.call(window,r,"Error loading config:")}}),So=e=>E(void 0,null,function*(){var t;try{return(yield fetch(`${W}/settings/product-by-url?${new URLSearchParams(T(y({},e),{url:`${window.location.origin}${window.location.pathname}`}))}`)).json()}catch(s){(t=window.tolstoyCaptureError)==null||t.call(window,s,"Error getting product page config:")}}),fo=s=>E(void 0,null,function*(){var o=s,{productId:e}=o,t=ht(o,["productId"]);var n;try{return(yield fetch(`${W}/settings/product/${e}?${new URLSearchParams(t)}`)).json()}catch(r){(n=window.tolstoyCaptureError)==null||n.call(window,r,"Error getting product page config:")}}),De=e=>E(void 0,null,function*(){var t;if(window.location.origin!=={}.VITE_BASE_URL)try{return yield fetch(`${W}/events/event`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})}catch(s){(t=window.tolstoyCaptureError)==null||t.call(window,s,"Error sending page view:")}}),xi=e=>E(void 0,null,function*(){var t;try{return yield fetch(`${Ts}?publishId=${e}`)}catch(s){(t=window.tolstoyCaptureError)==null||t.call(window,s)}}),mo=e=>{var t;try{window.navigator.sendBeacon(ws,JSON.stringify(e))}catch(s){const o="Error occured in createSiteActivityEvent";console.error(o,s),(t=window.tolstoyCaptureError)==null||t.call(window,s,o)}};class $e{constructor(t="bubble"){this.abTestId=null,this.widgetType=t}sendEmptyPublishIdPageView(t,s,o,n){const r=Ae(),i=window.screen.width<=450||window.screen.height<=450,l={publishId:t,abTestId:s,appKey:o,anonymousId:r,eventName:"pageView",isMobile:i,timestamp:new Date().toISOString(),parentUrl:window.location.href,sessionId:it(),playerType:this.widgetType,storeUrl:n};De(l)}removeAbTestIfFinished(){const t=Xt();for(const[s,o]of Object.entries(t)){if(!(o!=null&&o.endAt))continue;new Date(o==null?void 0:o.endAt)<new Date&&delete t[s]}Qt(t)}updateAbTest(t,s){var l;const o=t.publishId,n=t.abTestId,r=t.abTestEndAt;if(!n||n===this.abTestId){this.abTestId=n;return}if(!o){const d=t.appKey;this.sendEmptyPublishIdPageView(o,n,d,s)}const i=Xt();(l=i[n])!=null&&l.publishId||(i[n]={publishId:o,endAt:r},Qt(i))}init(t,s){this.removeAbTestIfFinished(),this.updateAbTest(t,s)}}const To=".avatar.0000000.webp",wo=".401.0000000.webp",Fi=".avatar.0000000.jpg",Gi=".0000000.jpg",Io=480,bo=({isMobile:e,isStory:t,isPlayInTileFirst:s})=>s?"_640.mp4":e||t?"_preview.mp4":"_preview_embed.mp4",Zt=({step:e,isStory:t,isPlayInTileFirst:s,height:o=ls})=>{const{videoOwner:n,stockAsset:r,videoId:i}=e,l=window.innerWidth<=450,d=bo({isMobile:l,isStory:t,isPlayInTileFirst:s}),c=r==null?void 0:r.videoUrl,p=!!(r!=null&&r.shopifyFileId),g=r==null?void 0:r.previewUrl,f=r==null?void 0:r.hasOriginal,C=r==null?void 0:r.gifUrl,Q=p&&!f;return g&&!s&&o<Io?g:c&&p?c:c&&!p?c!=null&&c.includes("vimeo")?c:`${c.split(".mp4")[0]}${d}`:C&&Q?`${C.split(".mp4")[0]}${d}`:`${pe}/public/${n}/${i}/${i}${d}`},_o=({videoOwner:e,stockAsset:t,videoId:s},o)=>{if(!s)return"";const n=t==null?void 0:t.posterUrl,r=t==null?void 0:t.hasOriginal;return n!=null&&n.endsWith(o)||n&&!r?n:`${pe}/public/${e}/${s}/${s}${o}`},Yi=e=>{const s=window.innerWidth<=450?To:wo;return _o(e,s)},Hi=(e,t)=>{const s=()=>{if(e.autoplay){e.src="";return}e.src=t};e.addEventListener("ended",s,{once:!0})},Co=(e,t)=>`${e}-${t}`,Ki=e=>e.dataset.publishId?e.dataset.publishId:e.id?e.id.split("_")[0]:"",Ro=e=>{var s;const t=(s=e==null?void 0:e.dataset)==null?void 0:s.productId;return t==="{{ product.id }}"?null:t},Oo=()=>{const{stories:e,carousel:t,embed:s}=ue,o=document.querySelectorAll(`.${e}, .${t}, .${s}`);for(const n of o){const r=Ro(n);if(r)return r}},ji=e=>{var s,o,n;const t=(n=(o=(s=e==null?void 0:e.design)==null?void 0:s.branding)==null?void 0:o.typography)==null?void 0:n.font;t!=null&&t.family&&Eo(t)},qi=({step:e,embedMotion:t,isStory:s,loadAll:o=!1,isCarouselPlayInTileFirst:n})=>{if(t===x.static||n)return null;const i=window.innerWidth<=450,l=t===x.hoverOver,d=t===x.dynamic;return d&&o?Zt({step:e,isStory:s}):l&&i||d?null:Zt({step:e,isStory:s})},Ao=e=>{const t=e.getBoundingClientRect();return t.top>=-t.height&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},ke=(e,t)=>window.document.querySelectorAll(`[data-tolstoy-element="${Co(e,t)}"]`),vo=({videoClass:e,publishId:t,removeEventListenerFunction:s})=>{const o=ke(e,t);for(const n of o)n.pause(),s==null||s(n)},Po=({videoClass:e,publishId:t,setIsDynamicVideoRunning:s,onVideoEnd:o})=>{s(!1),vo({videoClass:e,publishId:t,removeEventListenerFunction:n=>{n.removeEventListener("ended",o)}})},zi=({videoClass:e,isDynamicVideoRunning:t,setIsDynamicVideoRunning:s,dynamicVideoHandler:o,publishId:n,onVideoEnd:r})=>{const i=ke(e,n);if(i.length===0)return;const l=Ao(i[0]);!l&&t?(Po({videoClass:e,publishId:n,setIsDynamicVideoRunning:s,onVideoEnd:r}),s(!1)):l&&!t&&(o(),s(!0))},Xi=i=>E(void 0,[i],function*({publishId:e,productId:t,widgetType:s,tags:o,appUrl:n,variantId:r}){const l=t&&t!==fs?fo:So,d=window.tolstoyAppKey||X()||"",c=new URLSearchParams(window.location.search),p=r||c.get("variant"),g=JSON.stringify($()),f=yield l({tolstoyViewers:g,productId:t,defaultPublishId:e,widgetType:s,appKey:d,tags:o,appUrl:n,variantId:p});if(f&&new $e(s).init(f),f!=null&&f.disabled&&!f.abTestId)throw new Error("couldn't find product page ");return f}),Mo=1e3*60*60*24,V=e=>`tolstoy${Ds(e)}`,Qi=e=>{Uo(e),No(e)},No=e=>{const{data:{name:t,text:s,facebookAnalyticsID:o,playlist:n,collectInfoType:r}}=e;if(!window.fbq||!o||!n)return;const i=`tolstoy-${n}`;switch(t){case w.sessionStart:R(o,`${i}-click`,{value:"Start Tolstoy"});break;case w.clickCta:R(o,`${i}-click`,{value:s});break;case w.submitInput:R(o,`${i}-input`,{value:s});break;case w.collectInfo:R(o,`${i}-${D.collectInfo}`,{value:r});break;case w.videoResponse:R(o,`${i}-${D.videoResponse}`);break;case w.imageResponse:R(o,`${i}-${D.imageResponse}`);break;case w.audioResponse:R(o,`${i}-${D.audioResponse}`);break;case D.sessionEnd:R(o,`${i}-${D.sessionEnd}`);break}},R=(e,t,s)=>{window.fbq("trackSingleCustom",e,t,s)},Lo=e=>{!window.gtag&&!window.dataLayer&&window.ga("create",{trackingId:e,name:"clientTracker",cookieDomain:"auto",cookieFlags:"max-age=7200;secure;samesite=none"})},Uo=e=>{const{data:{name:t,text:s,googleAnalyticsID:o,playlist:n,collectInfoType:r,productNames:i,totalTime:l,videoName:d,type:c,direction:p}}=e;if(!window.gtag&&!window.dataLayer&&!window.ga||!o||!n)return;const g=`tolstoy-${n}`;switch(t){case m.pageView:Lo(o),I(o,g,"tolstoyPageView");break;case w.sessionStart:I(o,g,t),I(o,g,"click","Start Tolstoy");break;case w.clickCta:I(o,g,t,s);break;case w.collectInfo:I(o,g,t,r);break;case w.submitInput:case w.imageResponse:case w.audioResponse:case w.videoResponse:case w.sessionEnd:I(o,g,t);break;case m.tolstoyModalClose:I(o,g,m.tolstoyModalClose,l);break;case m.videoLoaded:i&&I(o,g,"tolstoyVideoLoaded-products",i),I(o,g,"tolstoyVideoLoaded-videoName",d);break;case m.feedProductModalOpen:case m.feedProductModalClose:case m.clickViewProduct:case m.openProductPageClick:I(o,g,V(t),i);break;case m.feedPlay:case m.feedPause:case m.videoMuted:case m.videoUnmuted:case m.videoWatched:I(o,g,V(t),d);break;case m.openShareLink:I(o,g,V("openShareLink"),c);break;case m.feedNavigationArrowClick:case m.feedScroll:I(o,g,V(t),p);break;default:I(o,g,V(t),s)}},I=(e,t,s,o)=>{$o()&&(window.gtag?window.gtag("event",s,{event_category:t,event_label:o,send_to:e}):window.dataLayer?window.dataLayer.push({event:s,event_category:t,event_label:o,send_to:e}):window.ga("clientTracker.send","event",t,s,o))},Ct={},Zi=(e,t)=>{Ct[e]=Ct[e]||t};let Jt=!1;const Do=()=>{var e;if(!Jt)try{const t=X();ko({appKey:t}),Jt=!0}catch(t){console.error(t),(e=window.tolstoyCaptureError)==null||e.call(window,t)}},$o=()=>{var e,t,s,o;return(t=(e=window.Shopify)==null?void 0:e.customerPrivacy)!=null&&t.shouldShowBanner()?((o=(s=window.Shopify)==null?void 0:s.customerPrivacy)==null?void 0:o.currentVisitorConsent().analytic)==="yes":!0},ko=({appKey:e}={})=>{let t=0;Dt(null),ks(e)&&document.addEventListener("visibilitychange",()=>{var s,o;try{const n=Date.now(),r=window.performance.now();if(document.visibilityState==="visible"&&(t=r,xo(n)),document.visibilityState==="hidden"){let i=at();Fo(n,i),i=at();const l=Math.round(r-t),d=ao(),c=Wo(i),p=window.location.href.split("?")[0],g=Oo(),f={appKey:e,sessionUniqueId:d,timestamp:new Date().toISOString(),anonymousId:Ae(),storeUrl:(s=window.Shopify)==null?void 0:s.shop,siteActivity:c,eventName:ys,timeOnPage:l,pageUrl:p,currentPageProductId:g};mo(f),Js()}}catch(n){console.error(n),(o=window.tolstoyCaptureError)==null||o.call(window,n)}})},Wo=e=>{const t={};for(const[s,o]of Object.entries(Ct)){const n=e[s];!(n!=null&&n.length)&&!t[s]&&(t[s]={activity:{},totalTime:0,impression:o});const r=Bo({publishId:s,activities:n});let i=0;for(const l of Object.values(r))i+=l;t[s]={activity:r,totalTime:i,impression:o}}return t},Bo=({publishId:e,activities:t})=>{if(!e||!(t!=null&&t.length))return{};const s=Date.now(),o={},n={};for(const{timeStamp:r,type:i,sessionId:l}of t)n[l]=n[l]||0,o[l]===void 0&&(o[l]=!1),Te(i)&&!o[l]&&(o[l]=!0,n[l]-=r),Ws(i)&&o[l]&&(o[l]=!1,n[l]+=r);for(const[r,i]of Object.entries(o))i&&(n[r]+=s),(n[r]<=0||n[r]>Mo)&&delete n[r];return n},Vo=e=>{var t;return(t=Object.entries(e).find(([s,o])=>{if(o.length===0)return;const n=o[o.length-1].type;return Te(n)}))==null?void 0:t[0]},xo=e=>{const t=lo(),s=Le();!t||!s||(ve({publishId:t,timeStamp:e,type:k.OPEN,sessionId:s}),Dt(null))},Fo=(e,t)=>{const s=Vo(t),o=Le();!s||!o||(ve({publishId:s,timeStamp:e,type:k.CLOSE,sessionId:o}),Dt(s))},Go=()=>{const e=new CustomEvent("tolstoyWidgetReady");window.dispatchEvent(e)},Ji=()=>{const e=new CustomEvent(ce);window.dispatchEvent(e)},Yo=function(){const t=typeof document!="undefined"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),Ho=function(e){return"https://widget.gotolstoy.com/we/"+e},te={},N=function(t,s,o){if(!s||s.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(s.map(r=>{if(r=Ho(r),r in te)return;te[r]=!0;const i=r.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!o)for(let p=n.length-1;p>=0;p--){const g=n[p];if(g.href===r&&(!i||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${l}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":Yo,i||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),i)return new Promise((p,g)=>{c.addEventListener("load",p),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t()).catch(r=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r})},We=({tagName:e,src:t,container:s,attributes:o,style:n,styleString:r,classNames:i,eventListeners:l})=>{const d=document.createElement(e);if(l)for(const[c,p]of Object.entries(l))d.addEventListener(c,p);if(t&&(d.src=t),o)for(const[c,p]of Object.entries(o))d.setAttribute(c,p);if(r&&(d.style.cssText=r),n)for(const[c,p]of Object.entries(n))d.style[c]=p;return i&&d.classList.add(...i),s&&s.append(d),d},ee=({src:e,container:t,attributes:s})=>We({tagName:"script",src:e,container:t,attributes:s}),ta=({src:e,container:t,attributes:s,style:o})=>We({tagName:"iframe",src:e,container:t,attributes:s,style:o}),Ko=({callback:e,classNames:t})=>{const s=c=>t.some(p=>c.getElementsByClassName(p).length>0),o=c=>t.includes(c),n=c=>[...c.classList].some(o),r=c=>c.classList?n(c)||s(c):!1,i=c=>c.type!=="childList"||c.addedNodes.length===0?!1:[...c.addedNodes].some(r),l=c=>{c.some(i)&&e()};new window.MutationObserver(l).observe(document.body,{subtree:!0,childList:!0})},jo=({callback:e})=>{window.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)},Be=({callback:e,classNames:t})=>{jo({callback:e}),"MutationObserver"in window&&Ko({callback:e,classNames:t})},ea=({video:e,onError:t})=>e==null?void 0:e.play().catch(t),sa=e=>{const t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},qo=(e,t)=>`${e}-${t}`,zo=(e,t)=>`[data-tolstoy-element="${qo(e,t)}"]`,oa=(e,t)=>window.document.querySelector(zo(e,t)),na=(e,t)=>`[${e}="${t}"]`,ra=(e,t)=>window.document.querySelector(`[${e}="${t}"]`),Et="data-status",se={loading:"loading",loaded:"loaded"},Xo=({element:e})=>{const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},Qo=({element:e,callback:t})=>{const s=new window.IntersectionObserver(o=>{o[0].isIntersecting===!0&&(s.unobserve(e),t())},{threshold:[1]});s.observe(e)};class Zo{constructor({name:t,component:s,elementClassname:o}){this.name=t,this.Component=s,this.widgets=[],this.initialized=!1,this.elementClassname=o}init(){return E(this,null,function*(){const t=this.getElements();if(t.length!==0){for(const s of t)if(this.getShouldInitializeElement(s)){this.setElementStatus(s,se.loading);try{const o=new this.Component;if(yield o.init(s),!o.getIsInitialized()){this.deleteElementStatus(s);continue}this.widgets.push(o),this.initializeEvents({element:s,widget:o}),this.setElementStatus(s,se.loaded)}catch(o){console.log(`error starting tolstoy  ${this.name}`,s.id,o)}}this.widgets.length>0&&(this.initialized=!0)}})}deleteElementStatus(t){delete t.removeAttribute(Et)}getElementStatus(t){return t.getAttribute(Et)}setElementStatus(t,s){return t.setAttribute(Et,s)}getShouldInitializeElement(t){return!this.getElementStatus(t)}setComponent(t){this.Component=t}getElements(){return document.querySelectorAll(`.${this.elementClassname}`)}shouldLoad(){return this.getElements().length>0}initializeEvents({element:t,widget:s}){var o;(o=s.handlePageView)==null||o.call(s),this.registerEmbedViewListener({element:t,callback:s.handleView})}registerEmbedViewListener({element:t,callback:s}){if(Xo({element:t})){s();return}Qo({element:t,callback:s})}}class Jo{constructor(t){h(this,"postMessage",t=>{var s;(s=this.broadcaster)==null||s.postMessage(t)});h(this,"addEventListener",(...t)=>{var s;(s=this.receiver)==null||s.addEventListener(...t)});this.name=t||fe();try{"BroadcastChannel"in self&&(this.broadcaster=new BroadcastChannel(this.name),this.receiver=new BroadcastChannel(this.name))}catch(s){console.error("self is not defined",s)}}}class Ve{constructor({shouldIncludeLogs:t=!1,shouldArchivePastEvents:s=!1}={}){h(this,"subscribeMultipleEvents",({eventNames:t,callback:s})=>{for(const o of t)this.subscribe({eventName:o,callback:s})});h(this,"unsubscribeMultipleEvents",({eventNames:t,callback:s})=>{for(const o of t)this.unsubscribe({eventName:o,callback:s})});this.broadcastHub=new Jo,this.eventCallbacks={},this.pastEvents={},this.shouldIncludeLogs=t,this.shouldArchivePastEvents=s}logMessage(t){this.shouldIncludeLogs&&console.log(t)}throwError(t){if(this.shouldIncludeLogs)throw new Error(t)}archivePastEvent(t){if(!this.shouldArchivePastEvents)return;const{eventName:s}=t;this.pastEvents[s]||(this.pastEvents[s]=[]),this.pastEvents[s].push(t)}postMessage(t){this.archivePastEvent(t),this.broadcastHub.postMessage(t)}postPastEvents({eventName:t,callback:s}){if(this.pastEvents[t])for(const o of this.pastEvents[t])s(T(y({},o),{isPastEvent:!0}))}subscribe({eventName:t,callback:s,shouldIncludePastEvents:o}){if(this.eventCallbacks[t]||(this.eventCallbacks[t]=new Set),this.eventCallbacks[t].has(s)){this.throwError(`Already subscribed to event ${t} with this callback`);return}this.eventCallbacks[t].add(s),o&&this.postPastEvents({eventName:t,callback:s})}unsubscribe({eventName:t,callback:s}){if(!this.eventCallbacks[t]){this.throwError(`Not subscribed to event ${t}`);return}if(!this.eventCallbacks[t].has(s)){this.throwError("Callback is not subscribed");return}if(!this.eventCallbacks[t].delete(s)){this.logMessage(`Not subscribed to event ${t} with this callback`);return}this.logMessage(`Unsubscribed from event ${t}`)}initListener(t){this.broadcastHub.addEventListener("message",t)}}class F extends Ve{constructor(){if(F.instance)return F.instance;super({shouldArchivePastEvents:!0});h(this,"eventHandler",s=>{const{data:o={}}=s,{eventName:n}=o;if(this.eventCallbacks[n])for(const r of this.eventCallbacks[n])r(s)});h(this,"postMessage",s=>{const o=s.transmissionId||fe();return super.postMessage(T(y({},s),{transmissionId:o})),o});h(this,"init",()=>{this.initListener(this.eventHandler)});F.instance=this}}const u=new F;Object.freeze(u);const tn={modalOpen:"tolstoyModalOpen",playerReady:"tolstoyPlayerReady",toggleFeedCloseButton:"toggleFeedCloseButton"},en={isRebuyAppInstalled:"tolstoyIsRebuyAppInstalled",openRebuyCart:"tolstoyOpenRebuyCart",rebuyCartShown:"rebuyCartShown",rebuyCartHidden:"rebuyCartHidden"},sn={openKendoModal:"tolstoyOpenKendoModal",changeZIndex:"tolstoyChangeZIndex"},on={isTapcart:"tolstoyIsTapcart",openTapcartProduct:"tolstoyOpenTapcartProduct"},nn={getProductsMetafields:"getProductsMetafields",returnProductsMetafields:"returnProductsMetafields"},rn={isAfterpayAppInstalled:"tolstoyIsAfterpayAppInstalled"},an={productCardClick:"tolstoyProductCardClick"},cn={spotlightCarouselQuickShopClick:"tolstoySpotlightCarouselQuickShopClick"},ln={externalEventSubscribed:"tolstoyExternalEventSubscribed",productCardClickSubscribed:"tolstoyProductCardClickSubscribed"},dn={shopifyUrlRootPathUpdate:"tolstoyShopifyUrlRootPathUpdate",requestShopifyProductsUpdate:"tolstoyRequestShopifyProductsUpdate",shopifyProductUpdateResponse:"tolstoyShopifyProductUpdateResponse"},un={setAnonymousIdToCart:"tolstoySetAnonymousIdToCart",addToCart:"tolstoyAddToCart",addToCartSuccess:"tolstoyAddToCartSuccess",addToCartError:"tolstoyAddToCartError",addToCartSoldOut:"tolstoyAddToCartSoldOut",addToCartDisableDefault:"tolstoyAddToCartDisableDefault",cartItemQuantityChange:"tolstoyCartItemQuantityChange",cartItemQuantityChangeSuccess:"tolstoyCartItemQuantityChangeSuccess",cartItemQuantityChangeError:"tolstoyCartItemQuantityChangeError",cartDataRequest:"tolstoyCartDataRequest",cartDataResponse:"tolstoyCartDataResponse"},pn={loginWithMultipassUrlRequest:"tolstoyLoginWithMultipassUrl",loginWithMultipassUrlResponse:"tolstoyLoginWithMultipassUrlResponseMessage"},hn={productRecommendationsRequest:"tolstoyProductRecommendationsRequest",productRecommendationsResponse:"tolstoyProductRecommendationsResponse"},En={redirectToUrl:"tolstoyRedirectToUrl"},a=T(y(y(y(y(y(y(y(y(y(y(y(y(y(y({},tn),en),sn),rn),nn),an),cn),ln),on),dn),un),pn),hn),En),{urlChange:"urlChange",rejectCookiePolicy:"rejectCookiePolicy"});let oe=!1;const xe=()=>E(void 0,null,function*(){if(oe)return;(yield N(()=>import("./496e5f904/widget.events.89bf7be4.js"),[])).initializeWidgetEvents(),oe=!0});class gn{constructor(){h(this,"loadEmbedWidgets",()=>E(this,null,function*(){const t=Object.entries(this.embedWidgetsMap).map(i=>E(this,[i],function*([s,{embedWidget:o,loaded:n,loading:r}]){if(o.shouldLoad()){if(r){setTimeout(()=>this.loadEmbedWidgets(),2e3);return}n||(yield this.loadEmbedWidget({embedWidgetName:s,embedWidget:o})),yield o.init()}}));yield Promise.all(t)}));h(this,"handleUrlChange",()=>{for(const t of Object.keys(this.embedWidgetsMap))this.embedWidgetsMap[t].loaded=!1;this.loadEmbedWidgets()});this.domUpdatesListenerInitialized=!1,this.widgets=[],this.embedWidgetsMap={}}init(){return E(this,null,function*(){const t=[];for(const s of[wt,It,bt]){const o=ue[s],n=new Zo({name:s,elementClassname:o});this.embedWidgetsMap[s]={embedWidget:n,loaded:!1},t.push(o)}this.registerDomUpdatesListenerIfNeeded(t),this.subscribeToUrlChange(),yield this.loadEmbedWidgets()})}loadEmbedWidget(o){return E(this,arguments,function*({embedWidgetName:t,embedWidget:s}){this.embedWidgetsMap[t].loading=!0;let n;switch(t){case wt:{n=yield N(()=>import("./496e5f904/carousel.e5df3afb.js"),["496e5f904/modal.f2eb2931.css","496e5f904/carousel.7450e707.css"]);break}case It:{n=yield N(()=>import("./496e5f904/story.c832dd56.js"),["496e5f904/modal.f2eb2931.css","496e5f904/story.d392e68a.css"]);break}case bt:{n=yield N(()=>import("./496e5f904/embed.1d652249.js"),["496e5f904/modal.f2eb2931.css","496e5f904/embed.550ffe5d.css"]);break}}s.setComponent(n.default),yield xe(),this.embedWidgetsMap[t].loaded=!0,this.embedWidgetsMap[t].loading=!1})}registerDomUpdatesListenerIfNeeded(t){if(this.domUpdatesListenerInitialized)return;Be({classNames:t,callback:()=>this.loadEmbedWidgets()}),this.domUpdatesListenerInitialized=!0}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}class ct{static isValidUrl(t){return t?t.startsWith("tel:")||t.startsWith("mailto:")?!0:t.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/g)!==null:!1}static isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}static isInIframe(){try{return window.self!==window.top}catch(t){return!0}}static isIos(){return/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}static getMobileOperatingSystem(){const t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)&&!window.MSStream?"iOS":navigator.userAgent.match(/Mac/)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2?"ipad":null}static isMobile(){return ct.getMobileOperatingSystem()!=null}static isSafari(){return window.safari!==void 0}static enforceProtocol(t,s="https"){return t.startsWith("http")||t.startsWith("//")||t.startsWith("tel:")||t.startsWith("mailto:")?t:`${s}://${t}`}static removeProtocol(t){return t.replace(/(^\w+:|^)\/\//,"")}static stripUrl(t){return ct.removeProtocol(t).replace(/^www./,"").replace(/\/$/,"")}}class yn{addHours(t,s=new Date){return s.setTime(s.getTime()+t*60*60*1e3),s}getTolstoyViewers(){const t=$();for(const[o,n]of Object.entries(t)){const r=n.restrictionLimits;!r||!(r!=null&&r.time&&new Date(r==null?void 0:r.time)<=new Date)||delete t[o].restrictionLimits}const s=JSON.stringify(t);return nt(t),s}updateRestrictions(t,s){var i;const o=$(),n=(i=o[s])==null?void 0:i.restrictionLimits;if(!n||(n==null?void 0:n.type)!==t)return;const r=n[t];n[t]=r?r+1:1,n.limit&&n.clickLimit===n[t]&&(n.time=this.addHours(n==null?void 0:n.limit)),o[s].restrictionLimits=n,nt(o)}updateRules(t){const s=(t==null?void 0:t.publishId)||void 0,o=t==null?void 0:t.limit,n=$();let r=n[s];const i=r==null?void 0:r.restrictionLimits;r?r.impressionCount+=1:r={impressionCount:1,playCount:0};let l=n.undefined;if(l?l.impressionCount+=1:l={impressionCount:1,playCount:0},o){let d={limit:Number(o.timeLimit),type:o.type,clickLimit:Number(o.clickLimit)};i&&(d=y(y({},i),d)),r.restrictionLimits=d}else i&&(r.restrictionLimits=null);n[s]=r,n.undefined=l,nt(n)}}const Sn=`${W}/accounts/actions/accounts`;class fn{constructor(t){this.appKey=t,this.config=null,this.rules=new yn,this.abTest=new $e}init(){return E(this,null,function*(){return this.appKey?null:{}})}getWidgetId(){return E(this,null,function*(){var d,c;const t=window.location.href;if(window.tolstoyWidgetId)return window.tolstoyWidgetId;const s=((d=window.Shopify)==null?void 0:d.shop)||yo();if(!this.appKey&&!s)return;const o=oo(),n=this.rules.getTolstoyViewers(),r=s||window.location.host,i={timestamp:Date.now(),url:t,sessionCount:Number(Pe()||0),lastSeenAt:new Date().toISOString(),firstSeenAt:Me(),tolstoySeenCounter:n,isMobile:ct.isMobile(),domain:r,appUrl:s};o&&(i.identifyInfoId=o);const l=this.appKey||"";try{const p=yield fetch(`${Sn}/${l}?`+new URLSearchParams(i));return this.config=p.status===200?yield p.json():null,this.rules.updateRules(this.config),this.abTest.init(this.config,s),(c=this.config)==null?void 0:c.publishId}catch(p){return null}})}}const gt={a:"groupA",b:"groupB"},mn=new Set([]);class Fe{constructor(t){mn.has(t)&&(this.group=this.getGroup(),this.saveGroupInCache())}getGroup(){const t=Qs();return t||this.calcGroup()}calcGroup(){return Math.random()<.5?gt.a:gt.b}saveGroupInCache(){Zs(this.group)}changeGroupConfig(t){this.group&&(t.testGroup=this)}isGroupB(){return this.group===gt.b}}const _=le,Tn=new Set(["5bzilmwoe1fon","z7uu0kcyzumt0"]),Ge=e=>Tn.has(e)?de:_,ne=()=>{const e=window.location.href;return()=>e!==window.location.href};class wn{constructor({account:t}){this.initialized=!1,this.account=t,this.widgets=[],this.start=this.start.bind(this),this.startPart=this.startPart.bind(this),this.closePlayer=this.closePlayer.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.changeEmail=this.changeEmail.bind(this),this.on=this.on.bind(this),this.recreate=this.recreate.bind(this),this.identify=this.identify.bind(this),window.tolstoyWidget=T(y({},window.tolstoyWidget),{identify:this.identify,start:this.start,startPart:this.startPart,closePlayer:this.closePlayer,show:this.show,hide:this.hide,changeEmail:this.changeEmail,on:this.on,recreate:this.recreate})}init(n){return E(this,arguments,function*({account:t,widgetId:s,Component:o}){var i;this.account=t;const r=new o(t);yield r.init(),this.widgets.push(r),this.updateViewerIdentifyAttributes(),(i=window.tolstoySettings)!=null&&i.noReload||this.registerEvents(t),yield this.reloadWidget({account:t,widgetId:s})})}updateViewerIdentifyAttributes(){const t=Number(Pe()||0)+1;ro(t.toString()),Me()||io(new Date().toISOString())}handleMouseDown(){this.userInteracted=!0,document.removeEventListener("mousedown",this.handleMouseDown)}registerEvents(t){const s=window.history.pushState,o=window.history.replaceState;document.addEventListener("mousedown",()=>{this.handleMouseDown()}),document.addEventListener("mouseout",n=>E(this,null,function*(){var l;const r=(l=t==null?void 0:t.config)==null?void 0:l.exitIntentPublishId;r&&this.userInteracted&&!n.toElement&&!n.relatedTarget&&(yield this.recreate(r,{startPlayerImmediately:!0}))})),window.history.pushState=function(){const n=ne();s.apply(window.history,arguments),window.dispatchEvent(new window.Event("pushstate")),n()&&window.dispatchEvent(new window.Event("locationchange"))},window.history.replaceState=function(){const n=ne();o.apply(window.history,arguments),window.dispatchEvent(new window.Event("replacestate")),n()&&window.dispatchEvent(new window.Event("locationchange"))},window.addEventListener("popstate",()=>{window.dispatchEvent(new window.Event("locationchange"))}),window.addEventListener("locationchange",()=>E(this,null,function*(){yield this.reloadWidget({account:t})}))}reloadWidget(n){return E(this,arguments,function*({account:t,settings:s,widgetId:o}){var l;if(o||(o=yield t.getWidgetId()),console.debug("tolstoyWidgetId",o),new Fe(o).changeGroupConfig(t),((l=window.tolstoySettings)==null?void 0:l.alwaysShow)&&o||o&&Ne(o)!=="true"){const d=Ge(o);this.show(d),this.recreate(o,s,d)}else this.hide()})}identify(t){return E(this,null,function*(){var s;if(t)try{const{email:o,userId:n}=t;if(o&&(window.tolstoyUser=o,this.changeEmail(o)),!o&&!n){console.error("No email or userId");return}n&&(t.userId=n.toString()),t.appKey=this.account.appKey;const i=yield(yield fetch(`${W}/identify/identify`,{method:"POST",body:JSON.stringify({data:t})})).json();so(i==null?void 0:i.id)}catch(o){(s=window.tolstoyCaptureError)==null||s.call(window,o,"Error occurred while updating identify info:"),no()}})}start(t=_){const s=O(this.widgets,t);s&&s.start()}startPart(t,s=_){const o=O(this.widgets,s);o&&o.startPart(t)}closePlayer(t=_){const s=O(this.widgets,t);s&&s.closePlayer()}hide(t=_){const s=O(this.widgets,t);s&&s.hide()}show(t=_){const s=O(this.widgets,t);s&&s.show()}changeEmail(t,s=_){const o=O(this.widgets,s);o&&o.changeEmail(t)}on(t,s,o=_){const n=O(this.widgets,o);n&&n.eventChange(t,s)}recreate(t,s,o=_){const n=O(this.widgets,o);n&&n.recreate(t,s)}}const O=(e,t)=>e.find(s=>s.name===t);class In{constructor(){h(this,"init",()=>E(this,null,function*(){var c;const t=X(),s=new fn(t),o=new wn({account:s}),n=yield s.getWidgetId();if(!n){console.debug("tolstoyWidgetId",n),this.subscribeToUrlChange();return}if(new Fe(n).changeGroupConfig(s),!((c=window.tolstoySettings)==null?void 0:c.alwaysShow)&&Ne(n)==="true"){this.subscribeToUrlChange();return}this.unsubscribeFromUrlChange();const l=Ge(n);let d;l===de?d=yield N(()=>import("./496e5f904/centered-modal.f3e3b9c3.js"),["496e5f904/modal.f2eb2931.css"]):l===le&&(d=yield N(()=>import("./496e5f904/bubble.7a201d31.js"),["496e5f904/modal.f2eb2931.css","496e5f904/bubble.4d99fbce.css"])),yield xe(),yield o.init({account:s,widgetId:n,Component:d.default})}));h(this,"handleUrlChange",()=>{this.unsubscribeFromUrlChange(),this.init()})}subscribeToUrlChange(){u.subscribe({eventName:a.urlChange,callback:this.handleUrlChange})}unsubscribeFromUrlChange(){u.unsubscribe({eventName:a.urlChange,callback:this.handleUrlChange})}}const bn={tvContainer:"tolstoy-video-page"},_n="tolstoy-tv-container",ia="tolstoy-tv",aa={};class Cn{constructor(){this.domUpdatesListenerInitialized=!1,this.loaded=!1}init(){return E(this,null,function*(){yield this.loadVideo(),!this.loaded&&this.registerDomUpdatesListenerIfNeeded()})}loadVideo(){return E(this,null,function*(){const t=document.querySelector(`#${_n}`);if(!t)return;const s=(yield N(()=>import("./496e5f904/tv.67a6d0b0.js"),["496e5f904/tv.cac47d94.css"])).default;new s({tolstoyContainer:t}).init(),this.loaded=!0})}registerDomUpdatesListenerIfNeeded(){if(this.domUpdatesListenerInitialized)return;const t=[bn.tvContainer];Be({classNames:t,callback:()=>this.loadVideo()}),this.domUpdatesListenerInitialized=!0}}const Rn=e=>e.includes("bot"),L={addToCart:"tolstoy_add_to_cart",spotlightCarouselQuickShopClick:"tolstoy_spotlight_carousel_quick_shop_click",productCardClick:"tolstoy_product_card_click"},b={addToCartSuccess:"tolstoy_add_to_cart_success",addToCartError:"tolstoy_add_to_cart_error",rejectCookiePolicy:"tolstoy_reject_cookie_policy",tolstoyZIndexChange:"tolstoy_z_index_change"},Ye=Object.values(L),On=new Set([b.addToCartSuccess,b.addToCartError,b.rejectCookiePolicy,b.tolstoyZIndexChange]),An=({eventName:e,callback:t})=>{if(!Ye.includes(e)){console.error(`Event ${e} is not a valid event`);return}if(!t){console.error("Callback must be provided");return}if(typeof t!="function"){console.error("Callback must be a function");return}return!0};class G extends Ve{constructor(){if(G.instance)return G.instance;super({shouldIncludeLogs:!0});h(this,"eventHandler",({data:s={}})=>{const{eventName:o}=s;if(this.eventCallbacks[o])for(const n of this.eventCallbacks[o])try{n(s)}catch(r){console.error(r)}});h(this,"subscribe",(s,o,n={})=>{if(An({eventName:s,callback:o}))try{super.subscribe({eventName:s,callback:o}),u.postMessage({eventName:a.externalEventSubscribed,subscribedEventName:s,payload:n}),console.log("Subscribed to event",s)}catch(r){console.error(r)}});h(this,"unsubscribe",(s,o)=>super.unsubscribe({eventName:s,callback:o}));h(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Ye,callback:this.eventHandler})});G.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initListener(this.eventHandler)}}const rt=new G;Object.freeze(rt);const vn=e=>{const{eventName:t}=e;if(!t){console.error("eventName is required");return}if(!On.has(t)){console.error(`${t} is not a valid eventName`);return}return!0};class Pn{constructor(){h(this,"postMessage",(t={})=>{vn(t)&&u.postMessage(t)})}}const Rt=new Pn;Object.freeze(Rt);class Y{constructor(){if(Y.instance)return Y.instance;Y.instance=this}init(){const t=window.history.pushState,s=window.history.replaceState;let o=window.location.href;const n=()=>{window.location.href!==o&&(o=window.location.href,u.postMessage({eventName:a.urlChange}))};window.history.pushState=function(){t.apply(window.history,arguments),n()},window.history.replaceState=function(){s.apply(window.history,arguments),n()}}}const He=new Y;Object.freeze(He);const Mn=[a.modalOpen];class Nn{constructor(){h(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.modalOpen:this.sendIsAfterpayAppInstalledMessage();return;default:return null}})}sendIsAfterpayAppInstalledMessage(){u.postMessage({eventName:a.isAfterpayAppInstalled,value:!!(window!=null&&window.Afterpay)})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Mn,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Ke=new Nn;Object.freeze(Ke);const Ln=()=>{Gs(),Fs(lt.rejected),u.postMessage({eventName:a.rejectCookiePolicy})},Un=[b.rejectCookiePolicy];class H{constructor(){h(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case b.rejectCookiePolicy:return Ln();default:return null}});h(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Un,callback:this.externalMessagingHandler})});if(H.instance)return H.instance;H.instance=this}init(){this.initExternalMessagingSubscriptions()}}const je=new H;Object.freeze(je);const Dn={itemSoldOut:"itemSoldOut"},qe={tolstoyAnonymousId:"__tolstoyAnonymousId"},$n=({description:e})=>{switch(e){case Dn.itemSoldOut:return a.addToCartSoldOut;default:return a.addToCartError}},kn=({data:e})=>{const{description:t}=e,s=$n({description:t});u.postMessage(T(y({},e),{eventName:s}))},Wn=({data:e})=>{const{variantId:t,productId:s,transmissionId:o,quantity:n}=e;u.postMessage({variantId:t,productId:s,transmissionId:o,quantity:n,eventName:L.addToCart})},Bn=({data:e})=>{const{product:t,transmissionId:s}=e;u.postMessage({product:t,transmissionId:s,eventName:L.spotlightCarouselQuickShopClick})},Vn=({data:e})=>{const{subscribedEventName:t,payload:s={}}=e,{disableDefault:o}=s;switch(t){case L.addToCart:case L.spotlightCarouselQuickShopClick:o&&u.postMessage({eventName:a.addToCartDisableDefault});break;default:return null}},xn=({data:e})=>{u.postMessage(T(y({},e),{eventName:a.addToCartSuccess}))},Fn=[a.addToCart,a.spotlightCarouselQuickShopClick,a.externalEventSubscribed],Gn=[b.addToCartSuccess,b.addToCartError];class K{constructor(){h(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return Wn(t);case a.spotlightCarouselQuickShopClick:return Bn(t);case a.externalEventSubscribed:return Vn(t);default:return null}});h(this,"externalMessagingHandler",t=>{switch(t.data.eventName){case b.addToCartSuccess:return xn(t);case b.addToCartError:return kn(t);default:return null}});h(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Fn,callback:this.internalMessagingHandler})});h(this,"initExternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:Gn,callback:this.externalMessagingHandler})});if(K.instance)return K.instance;K.instance=this}init(){this.initInternalMessagingSubscriptions(),this.initExternalMessagingSubscriptions()}}const ze=new K;Object.freeze(ze);const Yn=[a.externalEventSubscribed,a.productCardClick],Hn=({subscribedEventName:e,payload:t})=>{switch(e){case L.productCardClick:{const{disableProductModal:s=!0}=t;u.postMessage({eventName:a.productCardClickSubscribed,isDisableProductModal:s});break}default:return null}},Kn=({data:e})=>{const{eventName:t}=e;switch(t){case a.externalEventSubscribed:{const{subscribedEventName:s,payload:o}=e;Hn({subscribedEventName:s,payload:o});break}case a.productCardClick:{const{variantId:s,productId:o,externalProductIds:n}=e;u.postMessage({eventName:L.productCardClick,variantId:s,productId:o,taggedProductIds:n});break}default:return null}};class jn{initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Yn,callback:Kn})}init(){this.initInternalMessagingSubscriptions()}}const Xe=new jn;Object.freeze(Xe);const qn=[a.getProductsMetafields];class zn{constructor(){h(this,"internalMessagingHandler",({data:t})=>{var s;switch(t.eventName){case a.getProductsMetafields:if(!((s=t==null?void 0:t.productIds)!=null&&s.length))return;u.postMessage({productsExtraData:this.getProductsMetafields(t.productIds),modalId:t.modalId,eventName:a.returnProductsMetafields});return;default:return null}})}getProductsMetafields(t=[]){var o,n;const s={};for(const r of t)s[r]=(n=(o=window==null?void 0:window.metafields)==null?void 0:o.products)==null?void 0:n[r];return s}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:qn,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Qe=new zn;Object.freeze(Qe);const Xn=[a.openRebuyCart],yt={show:"rebuy:smartcart.show",hide:"rebuy:smartcart.hide",init:"rebuy:smartcart.init"};class Qn{constructor(){h(this,"sendIsRebuyAppInstalledMessage",()=>{var t,s;if(!((t=window==null?void 0:window.Rebuy)!=null&&t.SmartCart)){document.addEventListener(yt.init,this.sendIsRebuyAppInstalledMessage,{once:!0});return}u.postMessage({eventName:a.isRebuyAppInstalled,value:!!((s=window==null?void 0:window.Rebuy)!=null&&s.SmartCart)}),this.initRebuyEventListeners()});h(this,"internalMessagingHandler",t=>{var s,o;switch(t.data.eventName){case a.openRebuyCart:return(o=(s=window==null?void 0:window.Rebuy)==null?void 0:s.SmartCart)==null?void 0:o.show();default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Xn,callback:this.internalMessagingHandler})}initRebuyEventListeners(){document.addEventListener(yt.show,()=>{u.postMessage({eventName:a.rebuyCartShown})}),document.addEventListener(yt.hide,()=>{u.postMessage({eventName:a.rebuyCartHidden})})}init(){this.initInternalMessagingSubscriptions(),this.sendIsRebuyAppInstalledMessage()}}const Ze=new Qn;Object.freeze(Ze);const Zn=[a.openKendoModal];class Jn{constructor(){h(this,"internalMessagingHandler",t=>{var s,o;switch(t.data.eventName){case a.openKendoModal:u.postMessage({eventName:a.changeZIndex,zIndex:1e3}),(o=(s=window.KENDO)==null?void 0:s.openQuickModalByHandle)==null||o.call(s,t.data.productHandle);const n=t.data.quantity;if(n<=1)return;for(let r=1;r<n;r++)setTimeout(()=>{var l;const i=document.querySelector(".quantity-selector__action--increment");(l=i==null?void 0:i.click)==null||l.call(i)},1e3+r*150);return;default:return null}})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:Zn,callback:this.internalMessagingHandler})}init(){this.initInternalMessagingSubscriptions()}}const Je=new Jn;Object.freeze(Je);const tr=[a.addToCart,a.playerReady,a.productCardClick],er={cartUpdated:"cart/updated"},sr=({productId:e,variantId:t})=>{const s={productId:String(e)};return t&&(s.variantId=String(t)),window.Tapcart.actions.openProduct(s)},or=e=>{const s=setTimeout(()=>{u.postMessage(T(y({},e),{eventName:a.addToCartError}))},4e3);window.Tapcart.registerEventHandler(er.cartUpdated,()=>{clearTimeout(s),u.postMessage(T(y({},e),{eventName:a.addToCartSuccess}))})},nr=e=>E(void 0,null,function*(){const{variantId:t,productId:s}=e;try{or(e),window.Tapcart.actions.addToCart({lineItems:[{variantId:String(t||s),quantity:1}]})}catch(o){return u.postMessage(T(y({},e),{error:o,eventName:a.addToCartError}))}}),rr=()=>{var e,t,s,o,n,r;try{const i=As();if(!i)return;const d=[...((s=(t=(e=window==null?void 0:window.Tapcart)==null?void 0:e.variables)==null?void 0:t.cart)==null?void 0:s.attributes)||[],{key:qe.tolstoyAnonymousId,value:i}];(r=(n=(o=window==null?void 0:window.Tapcart)==null?void 0:o.actions)==null?void 0:n.updateCartAttributes)==null||r.call(n,{attributes:d})}catch(i){De({text:i==null?void 0:i.message,parentUrl:window.location.href,appKey:X(),source:"tapcart",eventName:"widgetError",timestamp:new Date().toISOString()})}};class ir{constructor(){h(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.playerReady:return this.disableCartDefault();case a.productCardClick:return sr(t.data);case a.addToCart:return nr(t.data);default:return null}})}disableCartDefault(){u.postMessage({eventName:a.addToCartDisableDefault})}initInternalMessagingSubscriptions(){u.subscribeMultipleEvents({eventNames:tr,callback:this.internalMessagingHandler})}init(){ye()&&(this.initInternalMessagingSubscriptions(),rr())}}const ts=new ir;Object.freeze(ts);const ar={USD:"$",CAD:"CA$",EUR:"",AED:"..",AFN:"",ALL:"Lek",AMD:".",ARS:"$",AUD:"AU$",AZN:".",BAM:"KM",BDT:"",BGN:".",BHD:"..",BIF:"FBu",BND:"$",BOB:"Bs",BRL:"R$",BWP:"P",BYN:".",BZD:"$",CDF:"FrCD",CHF:"CHF",CLP:"$",CNY:"CN",COP:"$",CRC:"",CVE:"CV$",CZK:"K",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"..",EEK:"kr",EGP:"..",ERN:"Nfk",ETB:"Br",GBP:"",GEL:"GEL",GHS:"GH",GNF:"FG",GTQ:"Q",HKD:"$",HNL:"L",HRK:"kn",HUF:"Ft",IDR:"Rp",ILS:"",INR:"",IQD:"..",IRR:"",ISK:"kr",JMD:"$",JOD:"..",JPY:"",KES:"Ksh",KHR:"",KMF:"FC",KRW:"",KWD:"..",KZT:".",LBP:"..",LKR:"SL Re",LTL:"Lt",LVL:"Ls",LYD:"..",MAD:"..",MDL:"MDL",MGA:"MGA",MKD:"MKD",MMK:"K",MOP:"MOP$",MUR:"MURs",MXN:"MX$",MYR:"RM",MZN:"MTn",NAD:"N$",NGN:"",NIO:"C$",NOK:"kr",NPR:"",NZD:"$",OMR:"..",PAB:"B/.",PEN:"S/.",PHP:"",PKR:"",PLN:"z",PYG:"",QAR:"..",RON:"RON",RSD:".",RUB:".",RWF:"FR",SAR:"..",SDG:"SDG",SEK:"kr",SGD:"$",SOS:"Ssh",SYP:"..",THB:"",TND:"..",TOP:"T$",TRY:"TL",TTD:"$",TWD:"NT$",TZS:"TSh",UAH:"",UGX:"USh",UYU:"$",UZS:"UZS",VEF:"Bs.F.",VND:"",XAF:"FCFA",XOF:"CFA",YER:"..",ZAR:"R",ZMK:"ZK",ZWL:"ZWL$"},re={soldOut:"already sold out",sellingPlanRequired:"Variant can only be purchased with a selling plan."},cr=[a.addToCartDisableDefault,a.setAnonymousIdToCart,a.loginWithMultipassUrlRequest,a.cartItemQuantityChange,a.cartDataRequest,a.productRecommendationsRequest,a.requestShopifyProductsUpdate],ie=[a.addToCart,a.spotlightCarouselQuickShopClick],St=e=>({headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});let ae=!1;const ft={},tt={};class j{constructor(){h(this,"onRequestProductsUpdateMessage",t=>{const s=t.data.handles;for(const o of s)this.getProduct(o).then(n=>this.postProductUpdateMessage(o,n))});h(this,"shopifyAddToCart",i=>E(this,[i],function*({variantId:t,productHandle:s,sellingPlanId:o,quantity:n=Ss,transmissionId:r}){const l={id:t,quantity:n,properties:{_isAddedFromTolstoy:!0}};o&&(l.selling_plan=o);const c=St({items:[l]});try{const p=yield fetch(`${this.storeRootUrl}cart/add.js`,c);if(!p.ok){const g=yield p.json();return this.handleAddToCartError({error:g,variantId:t,productHandle:s,transmissionId:r})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.addToCartSuccess,variantId:t,transmissionId:r,shouldEndTransmission:!1}),this.getCart({transmissionId:r})}catch(p){console.log(p),this.handleAddToCartError({error:p,variantId:t,productHandle:s,transmissionId:r})}}));h(this,"shopifyUpdateItemQuantity",n=>E(this,[n],function*({variantId:t,quantity:s,transmissionId:o}){const r={updates:{[t]:s}},i=St(r);try{const l=yield fetch(`${this.storeRootUrl}cart/update.js`,i);if(!l.ok){const d=yield l.json();return this.handleUpdateItemQuantityError({error:d,variantId:t,transmissionId:o})}this.triggerExternalCartUpdate(),u.postMessage({eventName:a.cartItemQuantityChangeSuccess,variantId:t,transmissionId:o,shouldEndTransmission:!1}),this.getCart({transmissionId:o})}catch(l){this.handleUpdateItemQuantityError({error:l,variantId:t,transmissionId:o})}}));h(this,"internalMessagingHandler",t=>{switch(t.data.eventName){case a.addToCart:return this.shopifyAddToCart(t.data);case a.spotlightCarouselQuickShopClick:return this.shopifyQuickShopClick(t.data);case a.addToCartDisableDefault:return this.disableAddToCart(t.data);case a.setAnonymousIdToCart:return this.setAnonymousIdToCart(t.data);case a.loginWithMultipassUrlRequest:return this.loginWithMultipassUrl(t.data);case a.cartItemQuantityChange:return this.shopifyUpdateItemQuantity(t.data);case a.cartDataRequest:return this.getCart(t.data);case a.productRecommendationsRequest:return this.getProductRecommendations(t.data);case a.requestShopifyProductsUpdate:return this.onRequestProductsUpdateMessage(t);default:return null}});h(this,"initInternalMessagingSubscriptions",()=>{if(u.subscribeMultipleEvents({eventNames:cr,callback:this.internalMessagingHandler}),ae){$s("Add to cart disabled");return}u.subscribeMultipleEvents({eventNames:ie,callback:this.internalMessagingHandler})});var t,s,o;if(j.instance)return j.instance;j.instance=this,this.isShopifyStore=!!((t=window.Shopify)!=null&&t.shop),this.storeRootUrl=(o=(s=window.Shopify)==null?void 0:s.routes)==null?void 0:o.root}getIsProductSoldOutError(t){return t.includes(re.soldOut)}getIsSellingPlanError(t){return t.includes(re.sellingPlanRequired)}formatProduct(t){var o,n,r;if(!t)return null;const s=((n=(o=window.Shopify)==null?void 0:o.currency)==null?void 0:n.active)||((r=window.Shopify)==null?void 0:r.currency);return T(y({},t),{price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price,currencyCode:s,currencySymbol:ar[s],variants:t.variants.map(i=>T(y({},i),{price:i.price/100,compare_at_price:i.compare_at_price?i.compare_at_price/100:i.compare_at_price}))})}fetchRawProduct(t){return E(this,null,function*(){const s=this.storeRootUrl+`products/${t}.js`;try{const n=yield(yield fetch(s)).json();return this.formatProduct(n)}catch(o){}})}getProduct(t){return E(this,null,function*(){if(ft[t])return ft[t];if(tt[t])return tt[t];const s=this.fetchRawProduct(t);tt[t]=s;const o=yield s;return ft[t]=o,delete tt[t],o})}handleSellingPlanError(t,s){return E(this,null,function*(){const o=yield this.getProduct(s);if(!o)return;const{id:n}=o.selling_plan_groups[0].selling_plans[0];return this.shopifyAddToCart({variantId:t,productHandle:s,sellingPlanId:n})})}handleAddToCartError({error:t,variantId:s,productHandle:o,transmissionId:n}){const{description:r}=t;if(this.getIsProductSoldOutError(r)){u.postMessage({eventName:a.addToCartSoldOut,variantId:s,transmissionId:n});return}if(this.getIsSellingPlanError(r))return this.handleSellingPlanError(s,o);u.postMessage({eventName:a.addToCartError,error:r,variantId:s,transmissionId:n})}handleUpdateItemQuantityError({error:t,variantId:s,transmissionId:o}){const{description:n}=t;u.postMessage({eventName:a.cartItemQuantityChangeError,error:n,variantId:s,transmissionId:o})}getCart(s){return E(this,arguments,function*({transmissionId:t}){const n=yield(yield fetch(`${this.storeRootUrl}cart.js`,{method:"GET"})).json();u.postMessage({eventName:a.cartDataResponse,cart:n,transmissionId:t})})}triggerExternalCartUpdate(){var t,s,o,n,r,i,l,d,c,p;(r=(n=(o=(s=(t=window.VueMiniCart)==null?void 0:t.$store)==null?void 0:s._actions)==null?void 0:o.initCart)==null?void 0:n[0])==null||r.call(n),(d=(l=(i=window.slate)==null?void 0:i.cart)==null?void 0:l.reloadCart)==null||d.call(l),(c=window.tolstoyCartRefresh)==null||c.call(window),(p=window.monster_refresh)==null||p.call(window)}disableAddToCart(){ae=!0,u.unsubscribeMultipleEvents({eventNames:ie,callback:this.internalMessagingHandler})}postUrlRootPathIfNeeded(){window.Shopify.routes.root!=="/"&&u.postMessage({eventName:a.shopifyUrlRootPathUpdate,urlRootPath:window.Shopify.routes.root})}shopifyQuickShopClick({product:t}){const{variants:s,handle:o,quantity:n=1}=t,r=s[0].id;return this.shopifyAddToCart({variantId:r,productHandle:o,quantity:n})}getProductRecommendations(o){return E(this,arguments,function*({productId:t,transmissionId:s}){const n=`${this.storeRootUrl}recommendations/products.json?product_id=${t}`,r=yield fetch(n,{method:"GET"}),{products:i}=yield r.json();u.postMessage({eventName:a.productRecommendationsResponse,productId:t,products:i,transmissionId:s})})}loginWithMultipassUrl(o){return E(this,arguments,function*({multipassUrl:t,transmissionId:s}){const n=yield fetch(t);u.postMessage({eventName:a.loginWithMultipassUrlResponse,statusCode:n.status,transmissionId:s})})}setAnonymousIdToCart(s){return E(this,arguments,function*({anonymousId:t}){if(uo()==="true")return;const o={attributes:{[qe.tolstoyAnonymousId]:t}},n=St(o);try{yield fetch(`${this.storeRootUrl}cart/update.js`,n),po(!0)}catch(r){console.error(r)}})}postProductUpdateMessage(t,s){u.postMessage({eventName:a.shopifyProductUpdateResponse,handle:t,product:s})}init(){this.isShopifyStore&&(this.initInternalMessagingSubscriptions(),this.postUrlRootPathIfNeeded())}}const es=new j;Object.freeze(es);const lr=[a.addToCartError,a.addToCartSuccess,a.addToCartSoldOut,a.isRebuyAppInstalled,a.isAfterpayAppInstalled,a.openRebuyCart,a.returnProductsMetafields,a.rejectCookiePolicy,a.productCardClickSubscribed,a.isTapcart,a.shopifyUrlRootPathUpdate,a.loginWithMultipassUrlResponse,a.cartDataResponse,a.cartItemQuantityChangeSuccess,a.cartItemQuantityChangeError,a.productRecommendationsResponse,a.shopifyProductUpdateResponse],et={},mt={},st={},Tt=[];class q{constructor(){h(this,"eventHandler",({data:t={}})=>{const{modalId:s,eventName:o}=t;if(s)switch(o){case a.addToCart:case a.openRebuyCart:case a.openKendoModal:case a.getProductsMetafields:case a.productCardClick:case a.loginWithMultipassUrlRequest:case a.cartItemQuantityChange:case a.cartDataRequest:case a.productRecommendationsRequest:case a.requestShopifyProductsUpdate:case a.redirectToUrl:return this.postInternalMessage({modalId:s,data:t});case ce:return this.postInternalMessage({modalId:s,data:t}),this.handleModalReady({modalId:s});case a.toggleFeedCloseButton:return this.postInternalMessage({modalId:s,data:t});default:return null}});h(this,"internalEventHandler",({data:t})=>{this.postMessageToModal(t)});h(this,"initInternalMessagingSubscriptions",()=>{u.subscribeMultipleEvents({eventNames:lr,callback:this.internalEventHandler})});if(q.instance)return q.instance;q.instance=this}registerIframe({modalId:t,modalIframe:s}){et[t]=s}postInternalMessage({modalId:t,data:s}){delete s.modalId;const o=u.postMessage(s);st[o]=t}handleModalReady({modalId:t}){mt[t]=!0;const s=et[t];for(const o of Tt){const{transmissionId:n}=o,r=st[n];(!r||r===t)&&this.postMessageToIframe({iframe:s,message:o})}}postMessageToIframe({iframe:t,message:s}){var o;(o=t.contentWindow)==null||o.postMessage(s,"*")}postMessageToAllIframes({message:t}){Tt.push(t);for(const[s,o]of Object.entries(et))mt[s]&&this.postMessageToIframe({iframe:o,message:t})}postMessageToModal(t){const d=t,{transmissionId:s,shouldEndTransmission:o=!0}=d,n=ht(d,["transmissionId","shouldEndTransmission"]),r=st[s];if(!r)return this.postMessageToAllIframes({message:n});if(!mt[r]){Tt.push(t);return}const l=et[r];this.postMessageToIframe({iframe:l,message:n}),o&&delete st[s]}init(){this.initInternalMessagingSubscriptions(),window.addEventListener("message",this.eventHandler)}}const Ot=new q;Object.freeze(Ot);const dr=50,ur="8b32dacc-8f1d-4cce-b641-9f60e88f9414",pr=()=>{var t,s;const e=((t=document.currentScript)==null?void 0:t.src)||((s=import.meta)==null?void 0:s.url);if(e!=null&&e.includes("/we/widget.js")){ee({src:`https://${_t}/wes/widget.js`,container:document.head,attributes:{type:"module"}});return}ee({src:`https://${_t}/ws/widget.js`,container:document.head})},hr=()=>!!document.body,ss=()=>E(void 0,null,function*(){var e,t,s,o,n,r;if(!window.tolstoyWidget){if(Rn(window.navigator.userAgent)){console.debug("Bot user");return}if(!hr()){setTimeout(ss,dr);return}if(z("td")==="true"&&!((s=(t=(e=document.currentScript)==null?void 0:e.src)==null?void 0:t.includes)!=null&&s.call(t,"/ws/widget.js"))&&!((r=(n=(o=import.meta)==null?void 0:o.url)==null?void 0:n.includes)!=null&&r.call(n,"/wes/widget.js"))){pr();return}Do(),Sr(),fr(),mr(),Tr(),wr(),yield Promise.all([Er(),gr(),yr()]),Go()}}),Er=()=>new In().init(),gr=()=>new Cn().init(),yr=()=>new gn().init(),Sr=()=>(u.init(),u),fr=()=>(Ot.init(),Ot),mr=()=>{rt.init();const{subscribe:e,unsubscribe:t}=rt;return window.tolstoyWidget=T(y({},window.tolstoyWidget),{subscribe:e,unsubscribe:t}),rt},Tr=()=>{const{postMessage:e}=Rt;return window.tolstoyWidget=T(y({},window.tolstoyWidget),{postMessage:e}),Rt},wr=()=>{es.init(),He.init(),ze.init(),Ze.init(),Je.init(),ts.init(),Ke.init(),je.init(),Xe.init(),X()===ur&&Qe.init()};ss();export{x as $,Kr as A,li as B,wt as C,ii as D,m as E,ai as F,ci as G,mi as H,a as I,Co as J,kr as K,ni as L,qi as M,We as N,Gr as O,cs as P,ri as Q,wo as R,Hr as S,Fr as T,ls as U,pe as V,k as W,jr as X,Hi as Y,Br as Z,Wr as _,qo as a,pi as a$,vo as a0,gs as a1,xr as a2,Po as a3,zi as a4,Ar as a5,To as a6,Gi as a7,Ki as a8,Ro as a9,yn as aA,Eo as aB,Di as aC,ki as aD,ce as aE,$ as aF,nt as aG,ei as aH,$i as aI,Ui as aJ,Ji as aK,vi as aL,Pi as aM,ui as aN,Ne as aO,ct as aP,Le as aQ,ve as aR,at as aS,D as aT,fe as aU,z as aV,oi as aW,Us as aX,gi as aY,Ot as aZ,Nr as a_,yo as aa,Xi as ab,Si as ac,Yr as ad,di as ae,Vr as af,si as ag,us as ah,X as ai,Zr as aj,zr as ak,Fi as al,Es as am,ps as an,qr as ao,ti as ap,It as aq,ke as ar,Xr as as,Qr as at,Jr as au,ds as av,bt as aw,de as ax,Vi as ay,le as az,Ti as b,Or as b0,vr as b1,Cr as b2,Mr as b3,Pr as b4,Ni as b5,Bi as b6,xi as b7,Wi as b8,b as b9,Mi as ba,Li as bb,ta as bc,_n as bd,ia as be,Ls as bf,ye as bg,As as bh,aa as bi,yi as bj,ms as bk,Ur as bl,Lr as bm,$r as bn,Dr as bo,Oi as bp,Ai as bq,Ri as br,_i as bs,Xs as bt,Rr as bu,Ci as bv,zo as c,na as d,fi as e,ea as f,oa as g,Yi as h,hi as i,Zt as j,wi as k,De as l,Qi as m,$s as n,ra as o,vs as p,Ei as q,Ii as r,sa as s,u as t,ji as u,it as v,Ae as w,Oo as x,w as y,Zi as z};
